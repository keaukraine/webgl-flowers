class e{enterFullScreen(){document.fullscreenElement||document.documentElement.requestFullscreen({navigationUI:"hide"})}exitFullScreen(){document.exitFullscreen&&document.exitFullscreen()}addFullScreenListener(e){document.addEventListener("fullscreenchange",e,!1)}isFullScreen(){return!!document.fullscreenElement}}class t{static async load(e){return(await fetch(e)).arrayBuffer()}}class i{static load(e,t,i=t.LINEAR,n=t.LINEAR,r=!1){return new Promise(((o,s)=>{const a=t.createTexture();if(null===a)return void s("Error creating WebGL texture");const l=new Image;l.src=e,l.onload=()=>{t.bindTexture(t.TEXTURE_2D,a),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,l),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,i),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,n),!0===r?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT)),t.bindTexture(t.TEXTURE_2D,null),l&&l.src&&console.log(`Loaded texture ${e} [${l.width}x${l.height}]`),o(a)},l.onerror=()=>s("Cannot load image")}))}static async loadCubemap(e,t){const i=t.createTexture();if(null===i)throw new Error("Error creating WebGL texture");t.bindTexture(t.TEXTURE_CUBE_MAP,i),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.NEAREST);const n=[{type:t.TEXTURE_CUBE_MAP_POSITIVE_X,suffix:"-posx.png"},{type:t.TEXTURE_CUBE_MAP_NEGATIVE_X,suffix:"-negx.png"},{type:t.TEXTURE_CUBE_MAP_POSITIVE_Y,suffix:"-posy.png"},{type:t.TEXTURE_CUBE_MAP_NEGATIVE_Y,suffix:"-negy.png"},{type:t.TEXTURE_CUBE_MAP_POSITIVE_Z,suffix:"-posz.png"},{type:t.TEXTURE_CUBE_MAP_NEGATIVE_Z,suffix:"-negz.png"}].map((n=>new Promise(((r,o)=>{const s=new Image;s.src=e+n.suffix,s.onload=()=>{t.bindTexture(t.TEXTURE_CUBE_MAP,i),t.texImage2D(n.type,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,s),s&&s.src&&console.log(`Loaded texture ${e}${n.suffix} [${s.width}x${s.height}]`),r()},s.onerror=()=>o("Cannot load image")}))));return await Promise.all(n),t.bindTexture(t.TEXTURE_2D,null),i}}class n{constructor(){this.numIndices=0}loadBuffer(e,t,i,n){var r=new Uint8Array(n,0,n.byteLength);e.bindBuffer(i,t),e.bufferData(i,r,e.STATIC_DRAW)}async load(e,i){const[n,r]=await Promise.all([t.load(`${e}-indices.bin`),t.load(`${e}-strides.bin`)]);console.log(`Loaded ${e}-indices.bin (${n.byteLength} bytes)`),console.log(`Loaded ${e}-strides.bin (${r.byteLength} bytes)`),this.bufferIndices=i.createBuffer(),this.loadBuffer(i,this.bufferIndices,i.ELEMENT_ARRAY_BUFFER,n),this.numIndices=n.byteLength/2/3,this.bufferStrides=i.createBuffer(),this.loadBuffer(i,this.bufferStrides,i.ARRAY_BUFFER,r)}bindBuffers(e){e.bindBuffer(e.ARRAY_BUFFER,this.bufferStrides),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.bufferIndices)}getNumIndices(){return this.numIndices}}class r{constructor(e){this.gl=e,this.vertexShaderCode="",this.fragmentShaderCode="",this.fillCode(),this.initShader()}getShader(e,t){const i=this.gl.createShader(e);if(i){if(this.gl.shaderSource(i,t),this.gl.compileShader(i),this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS))return i;console.warn(this.gl.getShaderInfoLog(i))}else console.warn("Error creating shader.")}getUniform(e){if(void 0===this.program)throw new Error("No program for shader.");const t=this.gl.getUniformLocation(this.program,e);if(null!==t)return t;throw new Error(`Cannot get uniform "${e}".`)}getAttrib(e){if(void 0===this.program)throw new Error("No program for shader.");return this.gl.getAttribLocation(this.program,e)}initShader(){const e=this.getShader(this.gl.FRAGMENT_SHADER,this.fragmentShaderCode),t=this.getShader(this.gl.VERTEX_SHADER,this.vertexShaderCode),i=this.gl.createProgram();void 0!==e&&void 0!==t&&null!==i&&(this.gl.attachShader(i,t),this.gl.attachShader(i,e),this.gl.linkProgram(i),this.gl.getProgramParameter(i,this.gl.LINK_STATUS)?console.log(this.constructor.name+": Initialised shader"):console.warn(this.constructor.name+": Could not initialise shader"),this.gl.useProgram(i),this.program=i,this.fillUniformsAttributes())}use(){this.program&&this.gl.useProgram(this.program)}deleteProgram(){this.program&&this.gl.deleteProgram(this.program)}}var o="undefined"!=typeof Float32Array?Float32Array:Array;function s(){var e=new o(16);return o!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function a(e,t,i){var n=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],d=t[6],h=t[7],u=t[8],c=t[9],m=t[10],f=t[11],_=t[12],v=t[13],g=t[14],x=t[15],p=i[0],A=i[1],T=i[2],b=i[3];return e[0]=p*n+A*a+T*u+b*_,e[1]=p*r+A*l+T*c+b*v,e[2]=p*o+A*d+T*m+b*g,e[3]=p*s+A*h+T*f+b*x,p=i[4],A=i[5],T=i[6],b=i[7],e[4]=p*n+A*a+T*u+b*_,e[5]=p*r+A*l+T*c+b*v,e[6]=p*o+A*d+T*m+b*g,e[7]=p*s+A*h+T*f+b*x,p=i[8],A=i[9],T=i[10],b=i[11],e[8]=p*n+A*a+T*u+b*_,e[9]=p*r+A*l+T*c+b*v,e[10]=p*o+A*d+T*m+b*g,e[11]=p*s+A*h+T*f+b*x,p=i[12],A=i[13],T=i[14],b=i[15],e[12]=p*n+A*a+T*u+b*_,e[13]=p*r+A*l+T*c+b*v,e[14]=p*o+A*d+T*m+b*g,e[15]=p*s+A*h+T*f+b*x,e}function l(){var e=new o(3);return o!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function d(e,t,i){var n=new o(3);return n[0]=e,n[1]=t,n[2]=i,n}function h(e,t,i){var n=t[0],r=t[1],o=t[2],s=i[0],a=i[1],l=i[2];return e[0]=r*l-o*a,e[1]=o*s-n*l,e[2]=n*a-r*s,e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var u,c=function(e){var t=e[0],i=e[1],n=e[2];return Math.hypot(t,i,n)};u=l();!function(){var e,t=(e=new o(4),o!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e)}();function m(){var e=new o(4);return o!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function f(e,t,i,n){var r,o,s,a,l,d=t[0],h=t[1],u=t[2],c=t[3],m=i[0],f=i[1],_=i[2],v=i[3];return(o=d*m+h*f+u*_+c*v)<0&&(o=-o,m=-m,f=-f,_=-_,v=-v),1-o>1e-6?(r=Math.acos(o),s=Math.sin(r),a=Math.sin((1-n)*r)/s,l=Math.sin(n*r)/s):(a=1-n,l=n),e[0]=a*d+l*m,e[1]=a*h+l*f,e[2]=a*u+l*_,e[3]=a*c+l*v,e}var _,v,g,x,p,A,T,b=function(e,t){var i=t[0],n=t[1],r=t[2],o=t[3],s=i*i+n*n+r*r+o*o;return s>0&&(s=1/Math.sqrt(s)),e[0]=i*s,e[1]=n*s,e[2]=r*s,e[3]=o*s,e};_=l(),v=d(1,0,0),g=d(0,1,0),x=m(),p=m(),A=new o(9),o!=Float32Array&&(A[1]=0,A[2]=0,A[3]=0,A[5]=0,A[6]=0,A[7]=0),A[0]=1,A[4]=1,A[8]=1,T=A;!function(){var e=function(){var e=new o(2);return o!=Float32Array&&(e[0]=0,e[1]=0),e}()}();class E extends r{fillCode(){this.vertexShaderCode="uniform mat4 view_proj_matrix;\nattribute vec4 rm_Vertex;\nattribute vec2 rm_TexCoord0;\nvarying vec2 vTextureCoord;\n\nvoid main() {\n  gl_Position = view_proj_matrix * rm_Vertex;\n  vTextureCoord = rm_TexCoord0;\n}",this.fragmentShaderCode="precision mediump float;\nvarying vec2 vTextureCoord;\nuniform sampler2D sTexture;\n\nvoid main() {\n  gl_FragColor = texture2D(sTexture, vTextureCoord);\n}"}fillUniformsAttributes(){this.view_proj_matrix=this.getUniform("view_proj_matrix"),this.rm_Vertex=this.getAttrib("rm_Vertex"),this.rm_TexCoord0=this.getAttrib("rm_TexCoord0"),this.sTexture=this.getUniform("sTexture")}drawModel(e,t,i,n,r,o,s,a,l,d,h){if(void 0===this.rm_Vertex||void 0===this.rm_TexCoord0||void 0===this.view_proj_matrix)return;const u=e.gl;t.bindBuffers(u),u.enableVertexAttribArray(this.rm_Vertex),u.enableVertexAttribArray(this.rm_TexCoord0),u.vertexAttribPointer(this.rm_Vertex,3,u.FLOAT,!1,20,0),u.vertexAttribPointer(this.rm_TexCoord0,2,u.FLOAT,!1,20,12),e.calculateMVPMatrix(i,n,r,o,s,a,l,d,h),u.uniformMatrix4fv(this.view_proj_matrix,!1,e.getMVPMatrix()),u.drawElements(u.TRIANGLES,3*t.getNumIndices(),u.UNSIGNED_SHORT,0),e.checkGlError("DiffuseShader glDrawElements")}}var C="undefined"!=typeof Float32Array?Float32Array:Array;function w(){var e=new C(16);return C!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function y(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function S(e,t){var i=t[0],n=t[1],r=t[2],o=t[3],s=t[4],a=t[5],l=t[6],d=t[7],h=t[8],u=t[9],c=t[10],m=t[11],f=t[12],_=t[13],v=t[14],g=t[15],x=i*a-n*s,p=i*l-r*s,A=i*d-o*s,T=n*l-r*a,b=n*d-o*a,E=r*d-o*l,C=h*_-u*f,w=h*v-c*f,y=h*g-m*f,S=u*v-c*_,P=u*g-m*_,I=c*g-m*v,D=x*I-p*P+A*S+T*y-b*w+E*C;return D?(D=1/D,e[0]=(a*I-l*P+d*S)*D,e[1]=(r*P-n*I-o*S)*D,e[2]=(_*E-v*b+g*T)*D,e[3]=(c*b-u*E-m*T)*D,e[4]=(l*y-s*I-d*w)*D,e[5]=(i*I-r*y+o*w)*D,e[6]=(v*A-f*E-g*p)*D,e[7]=(h*E-c*A+m*p)*D,e[8]=(s*P-a*y+d*C)*D,e[9]=(n*y-i*P-o*C)*D,e[10]=(f*b-_*A+g*x)*D,e[11]=(u*A-h*b-m*x)*D,e[12]=(a*w-s*S-l*C)*D,e[13]=(i*S-n*w+r*C)*D,e[14]=(_*p-f*T-v*x)*D,e[15]=(h*T-u*p+c*x)*D,e):null}function P(e,t,i){var n=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],d=t[6],h=t[7],u=t[8],c=t[9],m=t[10],f=t[11],_=t[12],v=t[13],g=t[14],x=t[15],p=i[0],A=i[1],T=i[2],b=i[3];return e[0]=p*n+A*a+T*u+b*_,e[1]=p*r+A*l+T*c+b*v,e[2]=p*o+A*d+T*m+b*g,e[3]=p*s+A*h+T*f+b*x,p=i[4],A=i[5],T=i[6],b=i[7],e[4]=p*n+A*a+T*u+b*_,e[5]=p*r+A*l+T*c+b*v,e[6]=p*o+A*d+T*m+b*g,e[7]=p*s+A*h+T*f+b*x,p=i[8],A=i[9],T=i[10],b=i[11],e[8]=p*n+A*a+T*u+b*_,e[9]=p*r+A*l+T*c+b*v,e[10]=p*o+A*d+T*m+b*g,e[11]=p*s+A*h+T*f+b*x,p=i[12],A=i[13],T=i[14],b=i[15],e[12]=p*n+A*a+T*u+b*_,e[13]=p*r+A*l+T*c+b*v,e[14]=p*o+A*d+T*m+b*g,e[15]=p*s+A*h+T*f+b*x,e}function I(e,t,i){var n,r,o,s,a,l,d,h,u,c,m,f,_=i[0],v=i[1],g=i[2];return t===e?(e[12]=t[0]*_+t[4]*v+t[8]*g+t[12],e[13]=t[1]*_+t[5]*v+t[9]*g+t[13],e[14]=t[2]*_+t[6]*v+t[10]*g+t[14],e[15]=t[3]*_+t[7]*v+t[11]*g+t[15]):(n=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],d=t[6],h=t[7],u=t[8],c=t[9],m=t[10],f=t[11],e[0]=n,e[1]=r,e[2]=o,e[3]=s,e[4]=a,e[5]=l,e[6]=d,e[7]=h,e[8]=u,e[9]=c,e[10]=m,e[11]=f,e[12]=n*_+a*v+u*g+t[12],e[13]=r*_+l*v+c*g+t[13],e[14]=o*_+d*v+m*g+t[14],e[15]=s*_+h*v+f*g+t[15]),e}function D(e,t,i){var n=Math.sin(i),r=Math.cos(i),o=t[4],s=t[5],a=t[6],l=t[7],d=t[8],h=t[9],u=t[10],c=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*r+d*n,e[5]=s*r+h*n,e[6]=a*r+u*n,e[7]=l*r+c*n,e[8]=d*r-o*n,e[9]=h*r-s*n,e[10]=u*r-a*n,e[11]=c*r-l*n,e}function R(e,t,i){var n=Math.sin(i),r=Math.cos(i),o=t[0],s=t[1],a=t[2],l=t[3],d=t[8],h=t[9],u=t[10],c=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*r-d*n,e[1]=s*r-h*n,e[2]=a*r-u*n,e[3]=l*r-c*n,e[8]=o*n+d*r,e[9]=s*n+h*r,e[10]=a*n+u*r,e[11]=l*n+c*r,e}function M(e,t,i){var n=Math.sin(i),r=Math.cos(i),o=t[0],s=t[1],a=t[2],l=t[3],d=t[4],h=t[5],u=t[6],c=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*r+d*n,e[1]=s*r+h*n,e[2]=a*r+u*n,e[3]=l*r+c*n,e[4]=d*r-o*n,e[5]=h*r-s*n,e[6]=u*r-a*n,e[7]=c*r-l*n,e}function N(){var e=new C(3);return C!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function F(e,t){var i=t[0],n=t[1],r=t[2],o=i*i+n*n+r*r;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});!function(){var e=N()}();function B(){var e=new C(4);return C!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function O(e,t,i){var n=t[0],r=t[1],o=t[2],s=t[3];return e[0]=i[0]*n+i[4]*r+i[8]*o+i[12]*s,e[1]=i[1]*n+i[5]*r+i[9]*o+i[13]*s,e[2]=i[2]*n+i[6]*r+i[10]*o+i[14]*s,e[3]=i[3]*n+i[7]*r+i[11]*o+i[15]*s,e}var L;!function(){var e=B()}();class U extends E{constructor(){super(...arguments),this._color=[1,1,0,0]}fillCode(){super.fillCode(),this.fragmentShaderCode="precision mediump float;\n            varying vec2 vTextureCoord;\n            uniform sampler2D sTexture;\n            uniform vec4 color;\n\n            void main() {\n                gl_FragColor = texture2D(sTexture, vTextureCoord) * color;\n            }"}fillUniformsAttributes(){super.fillUniformsAttributes(),this.color=this.getUniform("color")}setColor(e,t,i,n){this._color=[e,t,i,n]}drawModel(e,t,i,n,r,o,s,a,l,d,h){if(void 0===this.rm_Vertex||void 0===this.view_proj_matrix||void 0===this.color)return;e.gl.uniform4f(this.color,this._color[0],this._color[1],this._color[2],this._color[3]),super.drawModel(e,t,i,n,r,o,s,a,l,d,h)}}!function(e){e[e.Rotating=0]="Rotating",e[e.Random=1]="Random"}(L||(L={}));class G{constructor(){this._speed=0,this.duration=0,this._minDuration=3e3,this._timer=0,this.lastTime=0,this._reverse=!1,this._cameraPosition=N(),this._cameraRotation=N(),this._matrix=w()}get cameraPosition(){return this._cameraPosition}get cameraRotation(){return this._cameraRotation}set reverse(e){this._reverse=e}set minDuration(e){this._minDuration=e}get matrix(){return this._matrix}get speed(){return this._speed}set speed(e){this._speed=e}get position(){return this._position}set position(e){this._position=e,this.duration=Math.max(this.getLength()/this.speed,this._minDuration)}get timer(){return this._timer}getLength(){if(void 0===this.position)return 0;const e=this.position.start.position,t=this.position.end.position;return Math.sqrt((t[0]-e[0])**2+(t[1]-e[1])**2+(t[2]-e[2])**2)}iterate(e){if(0!=this.lastTime){const t=e-this.lastTime;this._timer+=t/this.duration,this._timer>1&&(this._timer=1)}this.lastTime=e,this.updateMatrix()}reset(){this._timer=0,this.updateMatrix()}updateMatrix(){if(void 0===this._position)return;const e=this._reverse?this._position.end:this._position.start,t=this._reverse?this._position.start:this._position.end;this._cameraPosition[0]=e.position[0]+this._timer*(t.position[0]-e.position[0]),this._cameraPosition[1]=e.position[1]+this._timer*(t.position[1]-e.position[1]),this._cameraPosition[2]=e.position[2]+this._timer*(t.position[2]-e.position[2]),this._cameraRotation[0]=e.rotation[0]+this._timer*(t.rotation[0]-e.rotation[0]),this._cameraRotation[1]=e.rotation[1]+this._timer*(t.rotation[1]-e.rotation[1]),this._cameraRotation[2]=e.rotation[2]+this._timer*(t.rotation[2]-e.rotation[2]),y(this.matrix),D(this.matrix,this.matrix,this._cameraRotation[0]-Math.PI/2),M(this.matrix,this.matrix,this._cameraRotation[1]),R(this.matrix,this.matrix,this._cameraRotation[2]),I(this.matrix,this.matrix,[-this._cameraPosition[0],-this._cameraPosition[1],-this._cameraPosition[2]])}}class V extends E{fillCode(){this.vertexShaderCode="#version 300 es\nprecision highp float;\nuniform sampler2D sPositions;\nuniform vec3 uTexelSizes; // x = vertex count; y = texel half width; z = sampler y coord (animation frame)\nuniform mat4 view_proj_matrix;\nin vec2 rm_TexCoord0;\nout vec2 vTextureCoord;\n\nvoid main() {\n  float id = float(gl_VertexID);  vec4 position = texture(sPositions, vec2(id / uTexelSizes.x + uTexelSizes.y, uTexelSizes.z));  gl_Position = view_proj_matrix * position;\n  vTextureCoord = rm_TexCoord0;\n}",this.fragmentShaderCode="#version 300 es\nprecision mediump float;\nin vec2 vTextureCoord;\nuniform sampler2D sTexture;\nout vec4 fragColor;\n\nvoid main() {\n  fragColor = texture(sTexture, vTextureCoord);\n}"}fillUniformsAttributes(){this.view_proj_matrix=this.getUniform("view_proj_matrix"),this.rm_TexCoord0=this.getAttrib("rm_TexCoord0"),this.sTexture=this.getUniform("sTexture"),this.sPositions=this.getUniform("sPositions"),this.uTexelSizes=this.getUniform("uTexelSizes")}drawModel(e,t,i,n,r,o,s,a,l,d,h){if(void 0===this.rm_TexCoord0||void 0===this.view_proj_matrix)return;const u=e.gl;t.bindBuffers(u),u.enableVertexAttribArray(this.rm_TexCoord0),u.vertexAttribPointer(this.rm_TexCoord0,2,u.HALF_FLOAT,!1,4,0),e.calculateMVPMatrix(i,n,r,o,s,a,l,d,h),u.uniformMatrix4fv(this.view_proj_matrix,!1,e.getMVPMatrix()),u.drawElements(u.TRIANGLES,3*t.getNumIndices(),u.UNSIGNED_SHORT,0),e.checkGlError("DiffuseShader glDrawElements")}}class k extends V{fillCode(){super.fillCode(),this.vertexShaderCode="#version 300 es\nprecision highp float;\nuniform sampler2D sPositions;\n// x = texture width; y = texel half width; z = sampler y coord (animation frame); w = chunk size\nuniform vec4 uTexelSizes;\nuniform float uTexelHeight;\nuniform int uTextureWidthInt;\nuniform mat4 view_proj_matrix;\nin vec2 rm_TexCoord0;\nout vec2 vTextureCoord;\n\nfloat getCenter(float y) {\n  return y - mod(y, uTexelHeight) + uTexelHeight * 0.5;\n}\n\nvec4 linearFilter(vec2 coords) {\n  vec2 coords1 = vec2(coords.x, coords.y - uTexelHeight * 0.49);\n  vec2 coords2 = vec2(coords.x, coords.y + uTexelHeight * 0.49);\n  float center1 = getCenter(coords1.y);\n  float center2 = getCenter(coords2.y);\n  vec4 v1 = texture(sPositions, vec2(coords1.x, center1));\n  vec4 v2 = texture(sPositions, vec2(coords2.x, center2));\n  float d1 = abs(coords.y - center1);\n  float d2 = abs(coords.y - center2);\n  if (d1 > d2) {\n    return mix( v1, v2, d1 / (uTexelHeight) );\n  } else {\n    return mix( v2, v1, d2 / (uTexelHeight) );\n  }\n}\n\nvoid main() {\n  float id = float(gl_VertexID % uTextureWidthInt);  float chunk = float(gl_VertexID / uTextureWidthInt);  vec2 coords = vec2(id / uTexelSizes.x + uTexelSizes.y, uTexelSizes.z);  coords.y += chunk * uTexelSizes.w;  vec4 position = linearFilter(coords);  gl_Position = view_proj_matrix * position;\n  vTextureCoord = rm_TexCoord0;\n}"}fillUniformsAttributes(){super.fillUniformsAttributes(),this.uTextureWidthInt=this.getUniform("uTextureWidthInt"),this.uTexelHeight=this.getUniform("uTexelHeight")}}class z extends E{fillCode(){this.vertexShaderCode="// vertex-lit for trunk\n// ambient = RGBA 206, 206, 205, 255\n// diffuse = RGBA 105, 125, 152, 255\n// lightDir - normalized light direction\n// lightDir = 0.57735, -0.57735, -0.57735, 0.0\n\nuniform vec4 lightDir;\nuniform mat4 view_matrix;\nuniform mat4 model_matrix;\nuniform mat4 view_proj_matrix;\nuniform vec4 diffuse;\nuniform vec4 ambient;\nuniform float diffuseCoef;\nuniform float diffuseExponent;\n\nvarying vec2 vTexCoord;\nvarying vec4 vDiffuseColor;\n\nattribute vec2 rm_TexCoord0;\nattribute vec4 rm_Vertex;\nattribute vec3 rm_Normal;\n\nvoid main(void)\n{\n   gl_Position = view_proj_matrix * rm_Vertex;\n\n   vec3 vLightVec = (view_matrix * lightDir).xyz;\n   vec4 normal = model_matrix * vec4(rm_Normal, 0.0);\n   vec3 vNormal = normalize( view_matrix * normal).xyz;\n   float d = pow(max(0.0, dot(normalize(vNormal), normalize(vLightVec))), diffuseExponent);\n   vDiffuseColor = mix(ambient, diffuse, d * diffuseCoef);\n\n   vTexCoord = rm_TexCoord0;\n}\n",this.fragmentShaderCode="precision mediump float;\nuniform sampler2D sTexture;\n\nvarying vec2 vTexCoord;\nvarying vec4 vDiffuseColor;\n\nvoid main(void)\n{\n   gl_FragColor = vDiffuseColor * texture2D(sTexture, vTexCoord);\n}\n"}fillUniformsAttributes(){super.fillUniformsAttributes(),this.view_matrix=this.getUniform("view_matrix"),this.model_matrix=this.getUniform("model_matrix"),this.rm_Normal=this.getAttrib("rm_Normal"),this.ambient=this.getUniform("ambient"),this.diffuse=this.getUniform("diffuse"),this.lightDir=this.getUniform("lightDir"),this.diffuseCoef=this.getUniform("diffuseCoef"),this.diffuseExponent=this.getUniform("diffuseExponent")}drawModel(e,t,i,n,r,o,s,a,l,d,h){if(void 0===this.rm_Vertex||void 0===this.rm_TexCoord0||void 0===this.rm_Normal||void 0===this.view_proj_matrix||void 0===this.view_matrix||void 0===this.model_matrix)return;const u=e.gl;t.bindBuffers(u),u.enableVertexAttribArray(this.rm_Vertex),u.enableVertexAttribArray(this.rm_TexCoord0),u.enableVertexAttribArray(this.rm_Normal),u.vertexAttribPointer(this.rm_Vertex,3,u.FLOAT,!1,32,0),u.vertexAttribPointer(this.rm_TexCoord0,2,u.FLOAT,!1,32,12),u.vertexAttribPointer(this.rm_Normal,3,u.FLOAT,!1,32,20),e.calculateMVPMatrix(i,n,r,o,s,a,l,d,h),u.uniformMatrix4fv(this.view_proj_matrix,!1,e.getMVPMatrix()),u.uniformMatrix4fv(this.view_matrix,!1,e.getViewMatrix()),u.uniformMatrix4fv(this.model_matrix,!1,e.getModelMatrix()),u.drawElements(u.TRIANGLES,3*t.getNumIndices(),u.UNSIGNED_SHORT,0),e.checkGlError("VertexLitShader glDrawElements")}}const H="\n    /** From https://thebookofshaders.com/10/ */\n    float random_vec2 (vec2 st) {\n        return fract(sin(dot(st.xy,vec2(12.9898, 78.233))) * 43758.5453123);\n    }\n\n    /** Optimized version of the same random() from The Book of Shaders */\n    float random (float st) {\n        return fract(sin(st) * 43758.5453123);\n    }\n    ",j="\n    /** From https://thebookofshaders.com/10/ */\n    float random_vec2 (vec2 st) {\n        return 1.0 - fract(sin(dot(st.xy,vec2(12.9898, 78.233))) * 43758.5453123);\n    }\n\n    /** Optimized version of the same random() from The Book of Shaders */\n    float random (float st) {\n        return 1.0 - fract(sin(st) * 43758.5453123);\n    }\n    ",X='\n    vec2 random2(vec2 st){\n        st = vec2( dot(st,vec2(127.1,311.7)),\n                  dot(st,vec2(269.5,183.3)) );\n        return -1.0 + 2.0*fract(sin(st)*43758.5453123);\n    }\n\n    // Gradient Noise by Inigo Quilez - iq/2013\n    // https://www.shadertoy.com/view/XdXGW8\n    // The MIT License\n    // Copyright © 2013 Inigo Quilez\n    // Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions: The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software. THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n    // https://www.youtube.com/c/InigoQuilez\n    // https://iquilezles.org    \n    float noise(vec2 st) {\n        vec2 i = floor(st);\n        vec2 f = fract(st);\n    \n        vec2 u = f*f*(3.0-2.0*f);\n    \n        return mix( mix( dot( random2(i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),\n                         dot( random2(i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),\n                    mix( dot( random2(i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),\n                         dot( random2(i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x), u.y);\n    }    \n    ',W="\n    /** https://www.neilmendoza.com/glsl-rotation-about-an-arbitrary-axis/ */\n    mat4 rotationMatrix(vec3 axis, float angle)\n    {\n        // axis = normalize(axis);\n        float s = sin(angle);\n        float c = cos(angle);\n        float oc = 1.0 - c;\n        \n        return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,\n                    oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,\n                    oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,\n                    0.0,                                0.0,                                0.0,                                1.0);\n    }  \n\n    /** Optimized version to rotate only around Z axis */\n    mat4 rotationAroundZ(float angle)\n    {\n        float s = sin(angle);\n        float c = cos(angle);\n        \n        return mat4(c,  -s,   0.0, 0.0,\n                    s,   c,   0.0, 0.0,\n                    0.0, 0.0, 1.0, 0.0,\n                    0.0, 0.0, 0.0, 1.0);\n    }\n    ";class Y extends E{fillCode(){this.vertexShaderCode=`#version 300 es\n            precision highp float;\n            \n            uniform mat4 view_proj_matrix;\n\n            uniform vec3 uScale; // x: base scale for models; y: min random scale (normalized); z: max additional scale (normalized)\n            uniform vec2 spread; // x: X spread; y: Y spread.\n            uniform vec3 cullDistances; // x: near culling distance; y: far culling distance; z: cascade width = far - near\n            uniform vec3 uDistributionRange;\n            \n            out vec2 vTexCoord;\n            \n            in vec2 rm_TexCoord0;\n            in vec4 rm_Vertex;\n\n            const vec4 EMTPY_COORDINATE = vec4(0., 0., 0., 0.); // vertex coordinates to create degenerate triangle\n            const float FADE_WIDTH = 0.0; // size of fade in-out (using scale) width relative to cascade width.\n            const float FADE_MIN = FADE_WIDTH;\n            const float FADE_MAX = 1.0 - FADE_WIDTH;\n\n            ${X}\n            ${H}\n            ${W}\n                       \n            void main(void)\n            {\n                vec4 vertex = rm_Vertex;\n                float fInstance = float(gl_InstanceID);\n\n                vec2 translation = vec2(\n                    spread.x * (random(fInstance * 0.0196) - 0.5),\n                    spread.y * (random(fInstance * 0.0177) - 0.5)\n                );\n                float rotation = 6.28318530718 * random(fInstance * 0.03);\n                mat4 rotationMatrix = rotationAroundZ(rotation);\n\n                vec4 instancePosition = view_proj_matrix * vec4(translation, 0., 1.);\n                if (instancePosition.z < cullDistances.x || instancePosition.z > cullDistances.y) {\n                    vertex = EMTPY_COORDINATE;\n                } else {\n                    float scale = uScale.x * (uScale.y + random(fInstance * 1.07) * uScale.z);\n\n                    // t = normalized position of instance within width of cascade.\n                    float t = (cullDistances.y - instancePosition.z) / cullDistances.z;\n                    float fade = smoothstep(0.0, FADE_MIN, t) * (1.0 - smoothstep(FADE_MAX, 1.0, t));\n                    scale *= fade;\n\n                    vertex *= rotationMatrix;\n                    vertex *= vec4(scale, scale, scale, 1.0);\n                    vertex.xy += translation;\n                }\n                ${Y.DISTRIBUTION_CULLING}\n\n                gl_Position = view_proj_matrix * vertex;\n           \n                vTexCoord = rm_TexCoord0;\n            }`,this.fragmentShaderCode="#version 300 es\n            precision mediump float;\n            uniform sampler2D sTexture;\n            \n            in vec2 vTexCoord;\n            out vec4 fragColor;\n            \n            void main(void)\n            {\n                fragColor = texture(sTexture, vTexCoord);\n            }"}fillUniformsAttributes(){super.fillUniformsAttributes(),this.spread=this.getUniform("spread"),this.cullDistances=this.getUniform("cullDistances"),this.uScale=this.getUniform("uScale"),this.uDistributionRange=this.getUniform("uDistributionRange")}drawModel(e,t,i,n,r,o,s,a,l,d,h){if(void 0===this.rm_Vertex||void 0===this.rm_TexCoord0||void 0===this.view_proj_matrix)return;const u=e.gl;t.bindBuffers(u),u.enableVertexAttribArray(this.rm_Vertex),u.enableVertexAttribArray(this.rm_TexCoord0),u.vertexAttribPointer(this.rm_Vertex,3,u.FLOAT,!1,20,0),u.vertexAttribPointer(this.rm_TexCoord0,2,u.FLOAT,!1,20,12),e.calculateMVPMatrix(i,n,r,o,s,a,l,d,h),u.uniformMatrix4fv(this.view_proj_matrix,!1,e.getMVPMatrix()),u.drawElements(u.TRIANGLES,3*t.getNumIndices(),u.UNSIGNED_SHORT,0),e.checkGlError("VertexLitInstancedShader glDrawElements")}drawInstanced(e,t,i,n,r,o,s,a,l,d,h,u){if(void 0===this.rm_Vertex||void 0===this.rm_TexCoord0||void 0===this.view_proj_matrix)return;const c=e.gl;t.bindBuffers(c),c.enableVertexAttribArray(this.rm_Vertex),c.enableVertexAttribArray(this.rm_TexCoord0),c.vertexAttribPointer(this.rm_Vertex,3,c.FLOAT,!1,20,0),c.vertexAttribPointer(this.rm_TexCoord0,2,c.FLOAT,!1,20,12),e.calculateMVPMatrix(i,n,r,o,s,a,l,d,h),c.uniformMatrix4fv(this.view_proj_matrix,!1,e.getMVPMatrix()),c.drawElementsInstanced(c.TRIANGLES,3*t.getNumIndices(),c.UNSIGNED_SHORT,0,u),e.checkGlError("InstancedVegetationShader glDrawElements")}}Y.DISTRIBUTION_CULLING="\n        float distributionNoise = noise(translation * uDistributionRange.z /*.027*/); // [-1...1] range\n        if (distributionNoise < uDistributionRange.x || distributionNoise > uDistributionRange.y) {\n            vertex = EMTPY_COORDINATE;\n        }\n    ";class $ extends Y{fillCode(){this.vertexShaderCode=`#version 300 es\n            precision highp float;\n            // vertex-lit for trunk\n            // ambient = RGBA 206, 206, 205, 255\n            // diffuse = RGBA 105, 125, 152, 255\n            // lightDir - normalized light direction\n            // lightDir = 0.57735, -0.57735, -0.57735, 0.0\n            \n            uniform vec4 lightDir;\n            uniform mat4 view_matrix;\n            uniform mat4 model_matrix;\n            uniform mat4 view_proj_matrix;\n            uniform vec4 diffuse;\n            uniform vec4 ambient;\n            uniform float diffuseCoef;\n            uniform float diffuseExponent;\n\n            uniform vec3 uScale; // x: base scale for models; y: min random scale (normalized); z: max additional scale (normalized)\n            uniform vec2 spread; // x: X spread; y: Y spread.\n            uniform vec3 cullDistances; // x: near culling distance; y: far culling distance; z: cascade width = far - near\n            uniform vec3 uDistributionRange;\n            \n            out vec2 vTexCoord;\n            out vec4 vDiffuseColor;\n            \n            in vec2 rm_TexCoord0;\n            in vec4 rm_Vertex;\n            in vec3 rm_Normal;\n\n            const vec4 EMTPY_COORDINATE = vec4(0., 0., 0., 0.); // vertex coordinates to create degenerate triangle\n            const float FADE_WIDTH = 0.1; // size of fade in-out (using scale) width relative to cascade width.\n            const float FADE_MIN = FADE_WIDTH;\n            const float FADE_MAX = 1.0 - FADE_WIDTH;\n\n            ${X}\n            ${H}\n            ${W}\n                       \n            void main(void)\n            {\n                vec4 vertex = rm_Vertex;\n                float fInstance = float(gl_InstanceID);\n\n                vec2 translation = vec2(\n                    spread.x * (random(fInstance * 0.0196) - 0.5),\n                    spread.y * (random(fInstance * 0.0177) - 0.5)\n                );\n                float rotation = 6.28318530718 * random(fInstance * 0.03);\n                mat4 rotationMatrix = rotationAroundZ(rotation);\n\n                vec4 instancePosition = view_proj_matrix * vec4(translation, 0., 1.);\n                if (instancePosition.z < cullDistances.x || instancePosition.z > cullDistances.y) {\n                    vertex = EMTPY_COORDINATE;\n                } else {\n                    float scale = uScale.x * (uScale.y + random(fInstance * 1.07) * uScale.z);\n\n                    // t = normalized position of instance within width of cascade.\n                    float t = (cullDistances.y - instancePosition.z) / cullDistances.z;\n                    float fade = smoothstep(0.0, FADE_MIN, t) * (1.0 - smoothstep(FADE_MAX, 1.0, t));\n                    scale *= fade;\n\n                    vertex *= rotationMatrix;\n                    vertex *= vec4(scale, scale, scale, 1.0);\n                    vertex.xy += translation;\n                }\n                ${Y.DISTRIBUTION_CULLING}\n\n                gl_Position = view_proj_matrix * vertex;\n            \n                vec3 vLightVec = (view_matrix * lightDir).xyz;\n                vec4 normal = model_matrix * vec4(rm_Normal, 0.0) * rotationMatrix;\n                vec3 vNormal = normalize( view_matrix * normal).xyz; // w component of rm_Normal might be ignored, and implicitly converted to vec4 in uniform declaration\n                float d = pow(max(0.0, dot(normalize(vNormal), normalize(vLightVec))), diffuseExponent); // redundant normalize() ??\n                vDiffuseColor = mix(ambient, diffuse, d * diffuseCoef);\n            \n                vTexCoord = rm_TexCoord0;\n            }`,this.fragmentShaderCode="#version 300 es\n            precision mediump float;\n            uniform sampler2D sTexture;\n            \n            in vec2 vTexCoord;\n            in vec4 vDiffuseColor;\n            out vec4 fragColor;\n            \n            void main(void)\n            {\n                fragColor = vDiffuseColor * texture(sTexture, vTexCoord);\n            }"}fillUniformsAttributes(){super.fillUniformsAttributes(),this.view_matrix=this.getUniform("view_matrix"),this.model_matrix=this.getUniform("model_matrix"),this.rm_Normal=this.getAttrib("rm_Normal"),this.ambient=this.getUniform("ambient"),this.diffuse=this.getUniform("diffuse"),this.lightDir=this.getUniform("lightDir"),this.diffuseCoef=this.getUniform("diffuseCoef"),this.diffuseExponent=this.getUniform("diffuseExponent"),this.spread=this.getUniform("spread"),this.cullDistances=this.getUniform("cullDistances"),this.uScale=this.getUniform("uScale")}drawModel(e,t,i,n,r,o,s,a,l,d,h){if(void 0===this.rm_Vertex||void 0===this.rm_TexCoord0||void 0===this.rm_Normal||void 0===this.view_proj_matrix||void 0===this.view_matrix||void 0===this.model_matrix)return;const u=e.gl;t.bindBuffers(u),u.enableVertexAttribArray(this.rm_Vertex),u.enableVertexAttribArray(this.rm_TexCoord0),u.enableVertexAttribArray(this.rm_Normal),u.vertexAttribPointer(this.rm_Vertex,3,u.FLOAT,!1,32,0),u.vertexAttribPointer(this.rm_TexCoord0,2,u.FLOAT,!1,32,12),u.vertexAttribPointer(this.rm_Normal,3,u.FLOAT,!1,32,20),e.calculateMVPMatrix(i,n,r,o,s,a,l,d,h),u.uniformMatrix4fv(this.view_proj_matrix,!1,e.getMVPMatrix()),u.uniformMatrix4fv(this.view_matrix,!1,e.getViewMatrix()),u.uniformMatrix4fv(this.model_matrix,!1,e.getModelMatrix()),u.drawElements(u.TRIANGLES,3*t.getNumIndices(),u.UNSIGNED_SHORT,0),e.checkGlError("VertexLitInstancedShader glDrawElements")}drawInstanced(e,t,i,n,r,o,s,a,l,d,h,u){if(void 0===this.rm_Vertex||void 0===this.rm_TexCoord0||void 0===this.rm_Normal||void 0===this.view_proj_matrix||void 0===this.view_matrix||void 0===this.model_matrix)return;const c=e.gl;t.bindBuffers(c),c.enableVertexAttribArray(this.rm_Vertex),c.enableVertexAttribArray(this.rm_TexCoord0),c.enableVertexAttribArray(this.rm_Normal),c.vertexAttribPointer(this.rm_Vertex,3,c.FLOAT,!1,32,0),c.vertexAttribPointer(this.rm_TexCoord0,2,c.FLOAT,!1,32,12),c.vertexAttribPointer(this.rm_Normal,3,c.FLOAT,!1,32,20),e.calculateMVPMatrix(i,n,r,o,s,a,l,d,h),c.uniformMatrix4fv(this.view_proj_matrix,!1,e.getMVPMatrix()),c.uniformMatrix4fv(this.view_matrix,!1,e.getViewMatrix()),c.uniformMatrix4fv(this.model_matrix,!1,e.getModelMatrix()),c.drawElementsInstanced(c.TRIANGLES,3*t.getNumIndices(),c.UNSIGNED_SHORT,0,u),e.checkGlError("VertexLitInstancedShader glDrawElements")}}class K extends ${fillCode(){super.fillCode(),this.vertexShaderCode=`#version 300 es\n            precision highp float;\n            // vertex-lit for trunk\n            // ambient = RGBA 206, 206, 205, 255\n            // diffuse = RGBA 105, 125, 152, 255\n            // lightDir - normalized light direction\n            // lightDir = 0.57735, -0.57735, -0.57735, 0.0\n            \n            uniform vec4 lightDir;\n            uniform mat4 view_matrix;\n            uniform mat4 model_matrix;\n            uniform mat4 view_proj_matrix;\n            uniform vec4 diffuse;\n            uniform vec4 ambient;\n            uniform float diffuseCoef;\n            uniform float diffuseExponent;\n\n            uniform vec3 uScale; // x: base scale for models; y: min random scale (normalized); z: max additional scale (normalized)\n            uniform vec2 spread; // x: X spread; y: Y spread.\n            uniform vec3 cullDistances; // x: near culling distance; y: far culling distance; z: cascade width = far - near\n            uniform float minInstanceScale; // minimum scale of instance to draw\n            uniform vec3 uDistributionRange;\n            \n            out vec2 vTexCoord;\n            out vec4 vDiffuseColor;\n            \n            in vec2 rm_TexCoord0;\n            in vec4 rm_Vertex;\n            in vec3 rm_Normal;\n\n            const vec4 EMTPY_COORDINATE = vec4(0., 0., 0., 0.); // vertex coordinates to create degenerate triangle\n            const float FADE_WIDTH = 0.1; // size of fade in-out (using scale) width relative to cascade width.\n            const float FADE_MIN = FADE_WIDTH;\n            const float FADE_MAX = 1.0 - FADE_WIDTH;\n            \n            ${X}\n            ${H}\n            ${W}\n                        \n            void main(void)\n            {\n                vec4 vertex = rm_Vertex;\n                float fInstance = float(gl_InstanceID);\n\n                vec2 translation = vec2(\n                    spread.x * (random(fInstance * 0.0196) - 0.5),\n                    spread.y * (random(fInstance * 0.0177) - 0.5)\n                );\n                vec4 instancePosition = view_proj_matrix * vec4(translation, 0., 1.);\n                float rotation = 6.28318530718 * random(fInstance * 0.03);\n                mat4 rotationMatrix = rotationAroundZ(rotation);\n\n                float shrink = smoothstep(0.0, 0.6, (cullDistances.y - instancePosition.z) / cullDistances.y);\n                if (shrink < minInstanceScale) {\n                    shrink = 0.0;\n                }\n\n                if (instancePosition.z < cullDistances.x || instancePosition.z > cullDistances.y) {\n                    vertex = EMTPY_COORDINATE;\n                } else {\n                    float scale = uScale.x * (uScale.y + random(fInstance * 1.07) * uScale.z);\n\n                    // t = normalized position of instance within width of cascade.\n                    float t = (cullDistances.y - instancePosition.z) / cullDistances.z;\n                    float fade = (1.0 - smoothstep(FADE_MAX, 1.0, t));\n                    scale *= fade;\n\n                    scale *= shrink;\n\n                    vertex *= rotationMatrix;\n                    vertex *= vec4(scale, scale, scale, 1.0);\n                    vertex.xy += translation;\n                }\n                ${Y.DISTRIBUTION_CULLING}\n                \n                gl_Position = view_proj_matrix * vertex;\n            \n                vec3 vLightVec = (view_matrix * lightDir).xyz;\n                vec4 normal = model_matrix * vec4(rm_Normal, 0.0) * rotationMatrix;\n                vec3 vNormal = normalize( view_matrix * normal).xyz; // w component of rm_Normal might be ignored, and implicitly converted to vec4 in uniform declaration\n                float d = pow(max(0.0, dot(normalize(vNormal), normalize(vLightVec))), diffuseExponent); // redundant normalize() ??\n                vDiffuseColor = mix(ambient, diffuse, d * diffuseCoef);\n            \n                vTexCoord = rm_TexCoord0;\n            }`}fillUniformsAttributes(){super.fillUniformsAttributes(),this.minInstanceScale=this.getUniform("minInstanceScale")}drawModel(e,t,i,n,r,o,s,a,l,d,h){if(void 0===this.rm_Vertex||void 0===this.rm_TexCoord0||void 0===this.rm_Normal||void 0===this.view_proj_matrix||void 0===this.view_matrix||void 0===this.model_matrix)return;const u=e.gl;t.bindBuffers(u),u.enableVertexAttribArray(this.rm_Vertex),u.enableVertexAttribArray(this.rm_TexCoord0),u.enableVertexAttribArray(this.rm_Normal),u.vertexAttribPointer(this.rm_Vertex,3,u.FLOAT,!1,32,0),u.vertexAttribPointer(this.rm_TexCoord0,2,u.FLOAT,!1,32,12),u.vertexAttribPointer(this.rm_Normal,3,u.FLOAT,!1,32,20),e.calculateMVPMatrix(i,n,r,o,s,a,l,d,h),u.uniformMatrix4fv(this.view_proj_matrix,!1,e.getMVPMatrix()),u.uniformMatrix4fv(this.view_matrix,!1,e.getViewMatrix()),u.uniformMatrix4fv(this.model_matrix,!1,e.getModelMatrix()),u.drawElements(u.TRIANGLES,3*t.getNumIndices(),u.UNSIGNED_SHORT,0),e.checkGlError("VertexLitInstancedShader glDrawElements")}drawInstanced(e,t,i,n,r,o,s,a,l,d,h,u){if(void 0===this.rm_Vertex||void 0===this.rm_TexCoord0||void 0===this.rm_Normal||void 0===this.view_proj_matrix||void 0===this.view_matrix||void 0===this.model_matrix)return;const c=e.gl;t.bindBuffers(c),c.enableVertexAttribArray(this.rm_Vertex),c.enableVertexAttribArray(this.rm_TexCoord0),c.enableVertexAttribArray(this.rm_Normal),c.vertexAttribPointer(this.rm_Vertex,3,c.FLOAT,!1,32,0),c.vertexAttribPointer(this.rm_TexCoord0,2,c.FLOAT,!1,32,12),c.vertexAttribPointer(this.rm_Normal,3,c.FLOAT,!1,32,20),e.calculateMVPMatrix(i,n,r,o,s,a,l,d,h),c.uniformMatrix4fv(this.view_proj_matrix,!1,e.getMVPMatrix()),c.uniformMatrix4fv(this.view_matrix,!1,e.getViewMatrix()),c.uniformMatrix4fv(this.model_matrix,!1,e.getModelMatrix()),c.drawElementsInstanced(c.TRIANGLES,3*t.getNumIndices(),c.UNSIGNED_SHORT,0,u),e.checkGlError("VertexLitInstancedShader glDrawElements")}}class Z extends ${fillCode(){super.fillCode(),this.vertexShaderCode=`#version 300 es\n            precision highp float;\n            \n            uniform vec4 lightDir;\n            uniform vec3 viewPos;\n            uniform mat4 view_matrix;\n            uniform mat4 model_matrix;\n            uniform mat4 view_proj_matrix;\n            uniform vec4 diffuse;\n            uniform vec4 ambient;\n            uniform float diffuseCoef;\n            uniform float diffuseExponent;\n\n            uniform vec3 uScale; // x: base scale for models; y: min random scale (normalized); z: max additional scale (normalized)\n            uniform vec2 spread; // x: X spread; y: Y spread.\n            uniform vec3 cullDistances; // x: near culling distance; y: far culling distance; z: cascade width = far - near\n            \n            out vec2 vTexCoord;\n            out vec4 vDiffuseColor;\n            \n            in vec2 rm_TexCoord0;\n            in vec4 rm_Vertex;\n            in vec3 rm_Normal;\n\n            uniform float uSpecularPower;\n            uniform vec4 uSpecularColor;\n            uniform float uSpecularStrength;\n            uniform vec3 uDistributionRange;\n\n            const float PI2 = 6.283185307179586;\n\n            const vec4 EMTPY_COORDINATE = vec4(0., 0., 0., 0.); // vertex coordinates to create degenerate triangle\n            const float FADE_WIDTH = 0.0; // size of fade in-out (using scale) width relative to cascade width.\n            const float FADE_MIN = FADE_WIDTH;\n            const float FADE_MAX = 1.0 - FADE_WIDTH;\n\n            ${H}\n            ${W}\n            ${X}\n                       \n            void main(void)\n            {\n                vec4 vertex = rm_Vertex;\n                float fInstance = float(gl_InstanceID);\n\n                vec2 translation = vec2(\n                    spread.x * (random(fInstance * 0.0196) - 0.5),\n                    spread.y * (random(fInstance * 0.0177) - 0.5)\n                );\n                float rotation = 6.28318530718 * random(fInstance * 0.03);\n                mat4 rotationMatrix = rotationAroundZ(rotation);\n\n                vec4 instancePosition = view_proj_matrix * vec4(translation, 0., 1.);\n                if (instancePosition.z < cullDistances.x || instancePosition.z > cullDistances.y) {\n                    vertex = EMTPY_COORDINATE;\n                } else {\n                    float scale = uScale.x * (uScale.y + random(fInstance * 1.07) * uScale.z);\n\n                    // t = normalized position of instance within width of cascade.\n                    float t = (cullDistances.y - instancePosition.z) / cullDistances.z;\n                    float fade = smoothstep(0.0, FADE_MIN, t) * (1.0 - smoothstep(FADE_MAX, 1.0, t));\n                    scale *= fade;\n\n                    vertex *= rotationMatrix;\n                    vertex *= vec4(scale, scale, scale, 1.0);\n                    vertex.xy += translation;\n                }\n                ${Y.DISTRIBUTION_CULLING}\n\n                gl_Position = view_proj_matrix * vertex;\n            \n                vec3 vLightVec = (view_matrix * lightDir).xyz;\n                vec4 normal = model_matrix * vec4(rm_Normal, 0.0) * rotationMatrix;\n                vec3 vNormal = normalize( view_matrix * normal).xyz; // w component of rm_Normal might be ignored, and implicitly converted to vec4 in uniform declaration\n                float d = pow(max(0.0, dot(normalize(vNormal), normalize(vLightVec))), diffuseExponent); // redundant normalize() ??\n                vDiffuseColor = mix(ambient, diffuse, d * diffuseCoef);\n\n                // vDiffuseColor.r += bendCoeff * 3.; // FIXME\n           \n                // specular ==================\n                vec3 FragPos = vec3(model_matrix * vertex);\n                const float ZERO = 0.0;\n                vec3 vNormal2 = normalize(normal).xyz; // w component of rm_Normal might be ignored, and implicitly converted to vec4 in uniform declaration\n\n                vec3 viewDir = normalize(viewPos - FragPos);\n                vec3 reflectDir = reflect(-lightDir.xyz, vNormal2);\n                float spec = pow(max(dot(viewDir, reflectDir), ZERO), uSpecularPower);\n                //const float specularStrength = 1.8;\n                //vDiffuseColor = mix(vDiffuseColor, uSpecularColor, uSpecularStrength * spec);\n                vDiffuseColor += uSpecularColor * uSpecularStrength * spec;\n                // end specular ==============\n\n                vTexCoord = rm_TexCoord0;\n            }`}fillUniformsAttributes(){super.fillUniformsAttributes(),this.viewPos=this.getUniform("viewPos"),this.uSpecularColor=this.getUniform("uSpecularColor"),this.uSpecularPower=this.getUniform("uSpecularPower"),this.uSpecularStrength=this.getUniform("uSpecularStrength")}}class J extends Z{fillCode(){super.fillCode(),this.vertexShaderCode=`#version 300 es\n            precision highp float;\n\n            uniform vec4 lightDir;\n            uniform vec3 viewPos;\n            uniform mat4 view_matrix;\n            uniform mat4 model_matrix;\n            uniform mat4 view_proj_matrix;\n            uniform vec4 diffuse;\n            uniform vec4 ambient;\n            uniform float diffuseCoef;\n            uniform float diffuseExponent;\n\n            uniform vec3 uScale; // x: base scale for models; y: min random scale (normalized); z: max additional scale (normalized)\n            uniform vec2 spread; // x: X spread; y: Y spread.\n            uniform vec3 cullDistances; // x: near culling distance; y: far culling distance; z: cascade width = far - near\n\n            uniform float stiffness;// = 2.0;\n            uniform float heightCoeff;// = 0.06;\n            uniform float windOffset;// = 11.0;\n\n            out vec2 vTexCoord;\n            out vec4 vDiffuseColor;\n\n            in vec2 rm_TexCoord0;\n            in vec4 rm_Vertex;\n            in vec3 rm_Normal;\n\n            uniform float uTime;\n            const float PI2 = 6.283185307179586;\n\n            uniform float uSpecularPower;\n            uniform vec4 uSpecularColor;\n            uniform float uSpecularStrength;\n            uniform vec3 uDistributionRange;\n\n            const vec4 EMTPY_COORDINATE = vec4(0., 0., 0., 0.); // vertex coordinates to create degenerate triangle\n            const float FADE_WIDTH = 0.0; // size of fade in-out (using scale) width relative to cascade width.\n            const float FADE_MIN = FADE_WIDTH;\n            const float FADE_MAX = 1.0 - FADE_WIDTH;\n\n            ${j}\n            ${W}\n            ${X}\n\n            void main(void)\n            {\n                vec4 vertex = rm_Vertex;\n                float fInstance = float(gl_InstanceID);\n\n                vec2 translation = vec2(\n                    spread.x * (random(fInstance * 0.0196) - 0.5),\n                    spread.y * (random(fInstance * 0.0177) - 0.5)\n                );\n                float rotation = 6.28318530718 * random(fInstance * 0.03);\n                mat4 rotationMatrix = rotationAroundZ(rotation);\n\n                vec4 instancePosition = view_proj_matrix * vec4(translation, 0., 1.);\n                if (instancePosition.z < cullDistances.x || instancePosition.z > cullDistances.y) {\n                    vertex = EMTPY_COORDINATE;\n                } else {\n                    float scale = uScale.x * (uScale.y + random(fInstance * 1.07) * uScale.z);\n\n                    // t = normalized position of instance within width of cascade.\n                    float t = (cullDistances.y - instancePosition.z) / cullDistances.z;\n                    float fade = smoothstep(0.0, FADE_MIN, t) * (1.0 - smoothstep(FADE_MAX, 1.0, t));\n                    scale *= fade;\n\n                    vertex *= rotationMatrix;\n                    vertex *= vec4(scale, scale, scale, 1.0);\n                    vertex.xy += translation;\n                }\n                ${Y.DISTRIBUTION_CULLING}\n\n                // animation ======================================\n                float time1 = sin(uTime + random(fInstance * 0.0196));\n                float time2 = cos(uTime + random(fInstance * 0.0177));\n                float bendCoeff = pow(rm_Vertex.z * heightCoeff, stiffness);\n                float ox = time1 * noise(vertex.xy * .07) * windOffset;\n                float oy = time2 * noise(vertex.xy * .077) * windOffset;\n                // float oz = time * noise(vertex.xy * .075) * windOffset;\n                vertex.x += ox * bendCoeff;\n                vertex.y += oy * bendCoeff;\n                // vertex.z += oz * bendCoeff;\n                // end animation ==================================\n\n                gl_Position = view_proj_matrix * vertex;\n\n                vec3 vLightVec = (view_matrix * lightDir).xyz;\n                vec4 normal = model_matrix * vec4(rm_Normal, 0.0) * rotationMatrix;\n                vec3 vNormal = normalize( view_matrix * normal).xyz; // w component of rm_Normal might be ignored, and implicitly converted to vec4 in uniform declaration\n                float d = pow(max(0.0, dot(normalize(vNormal), normalize(vLightVec))), diffuseExponent); // redundant normalize() ??\n                vDiffuseColor = mix(ambient, diffuse, d * diffuseCoef);\n\n                // vDiffuseColor.r += bendCoeff * 3.; // FIXME\n\n                // specular ==================\n                vec3 FragPos = vec3(model_matrix * vertex);\n                const float SPECULAR_POWER = 6.0;\n                const float ZERO = 0.0;\n                // const vec3 NORMAL = vec3(0.0, 0.0, 1.0);\n                float time3 =  noise(sin(uTime) * vertex.xy * .01);\n                vec3 vNormal2 = normalize(normal + time3 * 0.2).xyz; // w component of rm_Normal might be ignored, and implicitly converted to vec4 in uniform declaration\n                //vNormal2 *= time2 / 2.0;\n\n                vec3 viewDir = normalize(viewPos - FragPos);\n                //vec3 lightDir = normalize(lightPos - FragPos);\n                vec3 reflectDir = reflect(-lightDir.xyz, vNormal2);\n                float spec = pow(max(dot(viewDir, reflectDir), ZERO), uSpecularPower);\n                //const float specularStrength = 1.8;\n                //vec4 specularColor = specularStrength * spec * vec4(1.0, 1.0, 1.0, 1.0);\n                //vDiffuseColor = mix(vDiffuseColor, uSpecularColor, uSpecularStrength * spec);\n                vDiffuseColor += uSpecularColor * uSpecularStrength * spec;\n                // end specular ==============\n\n                vTexCoord = rm_TexCoord0;\n            }`}fillUniformsAttributes(){super.fillUniformsAttributes(),this.uTime=this.getUniform("uTime"),this.viewPos=this.getUniform("viewPos"),this.stiffness=this.getUniform("stiffness"),this.heightCoeff=this.getUniform("heightCoeff"),this.windOffset=this.getUniform("windOffset")}}class Q extends K{fillCode(){super.fillCode(),this.vertexShaderCode=`#version 300 es\n            precision highp float;\n            \n            uniform vec4 lightDir;\n            uniform mat4 view_matrix;\n            uniform mat4 model_matrix;\n            uniform mat4 view_proj_matrix;\n            uniform vec4 diffuse;\n            uniform vec4 ambient;\n            uniform float diffuseCoef;\n            uniform float diffuseExponent;\n\n            uniform vec3 uScale; // x: base scale for models; y: min random scale (normalized); z: max additional scale (normalized)\n            uniform vec2 spread; // x: X spread; y: Y spread.\n            uniform vec3 cullDistances; // x: near culling distance; y: far culling distance; z: cascade width = far - near\n            uniform float minInstanceScale; // minimum scale of instance to draw\n            uniform vec3 uDistributionRange;\n            \n            out vec2 vTexCoord;\n            out vec4 vDiffuseColor;\n            \n            in vec2 rm_TexCoord0;\n            in vec4 rm_Vertex;\n            in vec3 rm_Normal;\n\n            const vec4 EMTPY_COORDINATE = vec4(0., 0., 0., 0.); // vertex coordinates to create degenerate triangle\n            const float FADE_WIDTH = 0.1; // size of fade in-out (using scale) width relative to cascade width.\n            const float FADE_MIN = FADE_WIDTH;\n            const float FADE_MAX = 1.0 - FADE_WIDTH;\n            \n            ${X}\n            ${H}\n            ${W}\n                        \n            void main(void)\n            {\n                vec4 vertex = rm_Vertex;\n                float fInstance = float(gl_InstanceID);\n\n                vec2 translation = vec2(\n                    spread.x * (random(fInstance * 0.0196) - 0.5),\n                    spread.y * (random(fInstance * 0.0177) - 0.5)\n                );\n                vec4 instancePosition = view_proj_matrix * vec4(translation, 0., 1.);\n                float rotation = 6.28318530718 * random(fInstance * 0.03);\n                mat4 rotationMatrix = rotationAroundZ(rotation);\n\n                float shrink = smoothstep(0.0, 0.6, (cullDistances.y - instancePosition.z) / cullDistances.y);\n                if (shrink < minInstanceScale) {\n                    shrink = 0.0;\n                }\n\n                if (instancePosition.z < cullDistances.x || instancePosition.z > cullDistances.y) {\n                    vertex = EMTPY_COORDINATE;\n                } else {\n                    float scale = uScale.x * (uScale.y + random(fInstance * 1.07) * uScale.z);\n\n                    // t = normalized position of instance within width of cascade.\n                    float t = (cullDistances.y - instancePosition.z) / cullDistances.z;\n                    float fade = (1.0 - smoothstep(FADE_MAX, 1.0, t));\n                    scale *= fade;\n\n                    scale *= shrink;\n\n                    vertex *= rotationMatrix;\n                    vertex *= vec4(scale, scale, scale, 1.0);\n                    vertex.xy += translation;\n                }\n                ${Y.DISTRIBUTION_CULLING}\n\n                gl_Position = view_proj_matrix * vertex;\n            \n                vec3 vLightVec = (view_matrix * lightDir).xyz;\n                vec4 normal = model_matrix * vec4(rm_Normal, 0.0) * rotationMatrix;\n                vec3 vNormal = normalize( view_matrix * normal).xyz; // w component of rm_Normal might be ignored, and implicitly converted to vec4 in uniform declaration\n                float d = pow(max(0.0, dot(normalize(vNormal), normalize(vLightVec))), diffuseExponent); // redundant normalize() ??\n                vDiffuseColor = mix(ambient, diffuse, d * diffuseCoef);\n\n                // animation ======================================\n                //vDiffuseColor.r += 5.0;\n                // end animation ==================================\n\n                vTexCoord = rm_TexCoord0;\n            }`}fillUniformsAttributes(){super.fillUniformsAttributes()}}class q extends Z{fillCode(){super.fillCode(),this.fragmentShaderCode="#version 300 es\n            precision mediump float;\n            uniform sampler2D sTexture;\n            \n            in vec2 vTexCoord;\n            in vec4 vDiffuseColor;\n            out vec4 fragColor;\n            \n            void main(void)\n            {\n                vec4 base = texture(sTexture, vTexCoord);\n                if (base.a < 0.9) {\n                    discard;\n                } else {\n                    fragColor = vDiffuseColor * base;\n                }\n            }"}fillUniformsAttributes(){super.fillUniformsAttributes(),this.viewPos=this.getUniform("viewPos")}}class ee extends r{fillCode(){this.vertexShaderCode="precision mediump float;\n        uniform mat4 view_proj_matrix;\n        uniform vec4 lightDir;\n        uniform float glareExponent;\n        attribute vec4 rm_Vertex;\n        attribute vec4 rm_Normal;\n        varying vec3 vNormal;\n        varying float vGlare;\n        \n        void main() {\n            gl_Position = view_proj_matrix * rm_Vertex;\n            vGlare = clamp(dot(rm_Normal, lightDir), 0.0, 1.0);\n        }",this.fragmentShaderCode="precision mediump float;\n        varying vec3 vNormal;\n        varying float vGlare;\n        uniform float glareExponent;\n        uniform vec4 glareColor;\n\n        void main() {\n            float glare = pow(vGlare, glareExponent);\n            gl_FragColor = glareColor * glare;\n        }"}fillUniformsAttributes(){this.rm_Vertex=this.getAttrib("rm_Vertex"),this.rm_Normal=this.getAttrib("rm_Normal"),this.view_proj_matrix=this.getUniform("view_proj_matrix"),this.lightDir=this.getUniform("lightDir"),this.glareExponent=this.getUniform("glareExponent"),this.glareColor=this.getUniform("glareColor")}drawModel(e,t,i,n,r,o,s,a,l,d,h){if(void 0===this.rm_Vertex||void 0===this.rm_Normal||void 0===this.view_proj_matrix)return;const u=e.gl;t.bindBuffers(u),u.enableVertexAttribArray(this.rm_Vertex),u.enableVertexAttribArray(this.rm_Normal),u.vertexAttribPointer(this.rm_Vertex,3,u.FLOAT,!1,32,0),u.vertexAttribPointer(this.rm_Normal,3,u.FLOAT,!1,32,20),e.calculateMVPMatrix(i,n,r,o,s,a,l,d,h),u.uniformMatrix4fv(this.view_proj_matrix,!1,e.getMVPMatrix()),u.drawElements(u.TRIANGLES,3*t.getNumIndices(),u.UNSIGNED_SHORT,0),e.checkGlError("GlareShader glDrawElements")}}class te extends U{fillCode(){this.vertexShaderCode="uniform mat4 view_proj_matrix;\n            attribute vec4 rm_Vertex;\n            attribute vec2 rm_TexCoord0;\n            attribute float rm_AO;\n            varying vec2 vTextureCoord;\n            varying float vAlpha;\n            \n            void main() {\n              gl_Position = view_proj_matrix * rm_Vertex;\n              vTextureCoord = rm_TexCoord0;\n              vAlpha = rm_AO;\n            }",this.fragmentShaderCode="precision mediump float;\n            varying vec2 vTextureCoord;\n            varying float vAlpha;\n            uniform sampler2D sTexture;\n            uniform vec4 color;\n            \n            void main() {\n              gl_FragColor = texture2D(sTexture, vTextureCoord) * color;\n              gl_FragColor.a = vAlpha;\n            }"}fillUniformsAttributes(){super.fillUniformsAttributes(),this.rm_AO=this.getAttrib("rm_AO")}drawModel(e,t,i,n,r,o,s,a,l,d,h){if(void 0===this.rm_Vertex||void 0===this.rm_TexCoord0||void 0===this.rm_AO||void 0===this.view_proj_matrix||void 0===this.color)return;const u=e.gl;t.bindBuffers(u),u.enableVertexAttribArray(this.rm_Vertex),u.enableVertexAttribArray(this.rm_TexCoord0),u.enableVertexAttribArray(this.rm_AO),u.vertexAttribPointer(this.rm_Vertex,3,u.FLOAT,!1,24,0),u.vertexAttribPointer(this.rm_TexCoord0,2,u.FLOAT,!1,24,12),u.vertexAttribPointer(this.rm_AO,1,u.FLOAT,!1,24,20),e.calculateMVPMatrix(i,n,r,o,s,a,l,d,h),u.uniform4f(this.color,this._color[0],this._color[1],this._color[2],this._color[3]),u.uniformMatrix4fv(this.view_proj_matrix,!1,e.getMVPMatrix()),u.drawElements(u.TRIANGLES,3*t.getNumIndices(),u.UNSIGNED_SHORT,0),e.checkGlError("DiffuseShader glDrawElements")}}class ie extends E{fillCode(){this.vertexShaderCode=`#version 300 es\n            precision highp float;\n\n            uniform mat4 view_proj_matrix;\n\n            uniform vec2 uScale; // x: base scale for models; y: max random additional scale\n            uniform sampler2D sPositions;\n            uniform int uPositionOffset;\n\n            out mediump vec2 vTexCoord;\n\n            in vec2 rm_TexCoord0;\n            in vec4 rm_Vertex;\n\n            ${H}\n            ${W}\n\n            const float PI2 = 6.28318530718;\n\n            void main(void)\n            {\n                ${ie.COMMON_TRANSFORMS}\n\n                gl_Position = view_proj_matrix * vertex;\n                vTexCoord = rm_TexCoord0;\n            }`,this.fragmentShaderCode="#version 300 es\n            precision mediump float;\n            uniform sampler2D sTexture;\n\n            in mediump vec2 vTexCoord;\n            out vec4 fragColor;\n\n            void main(void)\n            {\n                fragColor = texture(sTexture, vTexCoord);\n            }"}fillUniformsAttributes(){super.fillUniformsAttributes(),this.uScale=this.getUniform("uScale"),this.sPositions=this.getUniform("sPositions"),this.uPositionOffset=this.getUniform("uPositionOffset")}drawModel(e,t,i,n,r,o,s,a,l,d,h){if(void 0===this.rm_Vertex||void 0===this.rm_TexCoord0||void 0===this.view_proj_matrix)return;const u=e.gl;t.bindBuffers(u),u.enableVertexAttribArray(this.rm_Vertex),u.enableVertexAttribArray(this.rm_TexCoord0),u.vertexAttribPointer(this.rm_Vertex,3,u.FLOAT,!1,20,0),u.vertexAttribPointer(this.rm_TexCoord0,2,u.FLOAT,!1,20,12),e.calculateMVPMatrix(i,n,r,o,s,a,l,d,h),u.uniformMatrix4fv(this.view_proj_matrix,!1,e.getMVPMatrix()),u.drawElements(u.TRIANGLES,3*t.getNumIndices(),u.UNSIGNED_SHORT,0),e.checkGlError("VertexLitInstancedShader glDrawElements")}drawInstanced(e,t,i,n,r,o,s,a,l,d,h,u,c){if(void 0===this.rm_Vertex||void 0===this.rm_TexCoord0||void 0===this.view_proj_matrix)return;const m=e.gl;t.bindBuffers(m),m.enableVertexAttribArray(this.rm_Vertex),m.enableVertexAttribArray(this.rm_TexCoord0),m.vertexAttribPointer(this.rm_Vertex,4,m.INT_2_10_10_10_REV,!1,8,0),m.vertexAttribPointer(this.rm_TexCoord0,2,m.HALF_FLOAT,!1,8,4),e.calculateMVPMatrix(i,n,r,o,s,a,l,d,h),m.uniformMatrix4fv(this.view_proj_matrix,!1,e.getMVPMatrix()),m.uniform1i(this.uPositionOffset,u),m.drawElementsInstanced(m.TRIANGLES,3*t.getNumIndices(),m.UNSIGNED_SHORT,0,c),e.checkGlError("InstancedVegetationShader glDrawElements")}}ie.COMMON_TRANSFORMS="\n    vec4 vertex = rm_Vertex;\n    float fInstance = float(gl_InstanceID);\n    int x = uPositionOffset + gl_InstanceID;\n    vec4 translationAndScale = texelFetch(sPositions, ivec2(x, 0), 0); // xy=translation, z=scale\n    vec4 rotations = texelFetch(sPositions, ivec2(x, 1), 0); // x=sin a; y=cos a\n    vec2 translation = translationAndScale.xy;\n    float scale = uScale.x + translationAndScale.z * uScale.y;\n    float s = rotations.x;\n    float c = rotations.y;\n    mat4 rotationMatrix = mat4(\n        c,  -s,   0.0, 0.0,\n        s,   c,   0.0, 0.0,\n        0.0, 0.0, 1.0, 0.0,\n        0.0, 0.0, 0.0, 1.0\n    );\n\n    vertex *= rotationMatrix;\n    vertex *= vec4(scale, scale, scale, 1.0);\n    vertex.xy += translation;\n    ";class ne extends ie{fillCode(){super.fillCode(),this.fragmentShaderCode="#version 300 es\n            precision mediump float;\n            uniform sampler2D sTexture;\n            uniform vec4 color;\n\n            in mediump vec2 vTexCoord;\n            out vec4 fragColor;\n\n            void main(void)\n            {\n                fragColor = texture(sTexture, vTexCoord) * color;\n            }"}fillUniformsAttributes(){super.fillUniformsAttributes(),this.color=this.getUniform("color")}}class re extends ie{fillCode(){this.vertexShaderCode=`#version 300 es\n            precision highp float;\n\n            uniform mat4 view_proj_matrix;\n\n            uniform vec2 uScale; // x: base scale for models; y: max random additional scale\n            uniform sampler2D sPositions;\n            uniform int uPositionOffset;\n\n            uniform vec4 lightDir;\n            uniform mat4 view_matrix;\n            uniform mat4 model_matrix;\n            uniform vec4 diffuse;\n            uniform vec4 ambient;\n            uniform float diffuseCoef;\n            uniform float diffuseExponent;\n\n            out mediump vec2 vTexCoord;\n            out mediump vec4 vDiffuseColor;\n\n            in vec2 rm_TexCoord0;\n            in vec4 rm_Vertex;\n            in vec3 rm_Normal;\n\n            ${H}\n            ${W}\n\n            const float PI2 = 6.28318530718;\n\n            void main(void)\n            {\n                ${ie.COMMON_TRANSFORMS}\n\n                vec3 vLightVec = (view_matrix * lightDir).xyz;\n                vec4 normal = model_matrix * vec4(rm_Normal, 0.0) * rotationMatrix;\n                vec3 vNormal = normalize( view_matrix * normal).xyz; // w component of rm_Normal might be ignored, and implicitly converted to vec4 in uniform declaration\n                float d = pow(max(0.0, dot(normalize(vNormal), normalize(vLightVec))), diffuseExponent); // redundant normalize() ??\n                vDiffuseColor = mix(ambient, diffuse, d * diffuseCoef);\n\n                gl_Position = view_proj_matrix * vertex;\n                vTexCoord = rm_TexCoord0;\n            }`,this.fragmentShaderCode="#version 300 es\n            precision mediump float;\n            uniform sampler2D sTexture;\n\n            in mediump vec2 vTexCoord;\n            in mediump vec4 vDiffuseColor;\n            out vec4 fragColor;\n\n            void main(void)\n            {\n                fragColor = vDiffuseColor * texture(sTexture, vTexCoord);\n            }"}fillUniformsAttributes(){super.fillUniformsAttributes(),this.view_matrix=this.getUniform("view_matrix"),this.model_matrix=this.getUniform("model_matrix"),this.rm_Normal=this.getAttrib("rm_Normal"),this.ambient=this.getUniform("ambient"),this.diffuse=this.getUniform("diffuse"),this.lightDir=this.getUniform("lightDir"),this.diffuseCoef=this.getUniform("diffuseCoef"),this.diffuseExponent=this.getUniform("diffuseExponent")}drawModel(e,t,i,n,r,o,s,a,l,d,h){if(void 0===this.rm_Vertex||void 0===this.rm_TexCoord0||void 0===this.rm_Normal||void 0===this.view_proj_matrix||void 0===this.view_matrix||void 0===this.model_matrix)return;const u=e.gl;t.bindBuffers(u),u.enableVertexAttribArray(this.rm_Vertex),u.enableVertexAttribArray(this.rm_TexCoord0),u.enableVertexAttribArray(this.rm_Normal),u.vertexAttribPointer(this.rm_Vertex,3,u.FLOAT,!1,32,0),u.vertexAttribPointer(this.rm_TexCoord0,2,u.FLOAT,!1,32,12),u.vertexAttribPointer(this.rm_Normal,3,u.FLOAT,!1,32,20),e.calculateMVPMatrix(i,n,r,o,s,a,l,d,h),u.uniformMatrix4fv(this.view_proj_matrix,!1,e.getMVPMatrix()),u.uniformMatrix4fv(this.view_matrix,!1,e.getViewMatrix()),u.uniformMatrix4fv(this.model_matrix,!1,e.getModelMatrix()),u.drawElements(u.TRIANGLES,3*t.getNumIndices(),u.UNSIGNED_SHORT,0),e.checkGlError("VertexLitInstancedShader glDrawElements")}drawInstanced(e,t,i,n,r,o,s,a,l,d,h,u,c){if(void 0===this.rm_Vertex||void 0===this.rm_TexCoord0||void 0===this.rm_Normal||void 0===this.view_proj_matrix||void 0===this.view_matrix||void 0===this.model_matrix)return;const m=e.gl;t.bindBuffers(m),m.enableVertexAttribArray(this.rm_Vertex),m.enableVertexAttribArray(this.rm_TexCoord0),m.enableVertexAttribArray(this.rm_Normal),m.vertexAttribPointer(this.rm_Vertex,4,m.INT_2_10_10_10_REV,!1,12,0),m.vertexAttribPointer(this.rm_TexCoord0,2,m.HALF_FLOAT,!1,12,4),m.vertexAttribPointer(this.rm_Normal,4,m.INT_2_10_10_10_REV,!0,12,8),e.calculateMVPMatrix(i,n,r,o,s,a,l,d,h),m.uniformMatrix4fv(this.view_proj_matrix,!1,e.getMVPMatrix()),m.uniformMatrix4fv(this.view_matrix,!1,e.getViewMatrix()),m.uniformMatrix4fv(this.model_matrix,!1,e.getModelMatrix()),m.uniform1i(this.uPositionOffset,u),m.drawElementsInstanced(m.TRIANGLES,3*t.getNumIndices(),m.UNSIGNED_SHORT,0,c),e.checkGlError("VertexLitInstancedShader glDrawElements")}}class oe extends re{fillCode(){super.fillCode(),this.vertexShaderCode=`#version 300 es\n            precision highp float;\n\n            uniform mat4 view_proj_matrix;\n\n            uniform vec2 uScale; // x: base scale for models; y: max random additional scale\n            uniform sampler2D sPositions;\n            uniform int uPositionOffset;\n\n            uniform vec4 lightDir;\n            uniform mat4 view_matrix;\n            uniform mat4 model_matrix;\n            uniform vec4 diffuse;\n            uniform vec4 ambient;\n            uniform float diffuseCoef;\n            uniform float diffuseExponent;\n\n            out vec2 vTexCoord;\n            out vec4 vDiffuseColor;\n\n            in vec2 rm_TexCoord0;\n            in vec4 rm_Vertex;\n            in vec3 rm_Normal;\n\n            uniform vec3 viewPos;\n            uniform float uSpecularPower;\n            uniform vec4 uSpecularColor;\n            uniform float uSpecularStrength;\n\n            ${H}\n            ${W}\n\n            const float PI2 = 6.28318530718;\n\n            void main(void)\n            {\n                ${ie.COMMON_TRANSFORMS}\n                gl_Position = view_proj_matrix * vertex;\n\n                vec3 vLightVec = (view_matrix * lightDir).xyz;\n                vec4 normal = model_matrix * vec4(rm_Normal, 0.0) * rotationMatrix;\n                vec3 vNormal = normalize( view_matrix * normal).xyz; // w component of rm_Normal might be ignored, and implicitly converted to vec4 in uniform declaration\n                float d = pow(max(0.0, dot(normalize(vNormal), normalize(vLightVec))), diffuseExponent); // redundant normalize() ??\n                vDiffuseColor = mix(ambient, diffuse, d * diffuseCoef);\n\n                // specular ==================\n                vec3 FragPos = vec3(model_matrix * vertex);\n                const float ZERO = 0.0;\n                vec3 vNormal2 = normalize(normal).xyz; // w component of rm_Normal might be ignored, and implicitly converted to vec4 in uniform declaration\n\n                vec3 viewDir = normalize(viewPos - FragPos);\n                vec3 reflectDir = reflect(-lightDir.xyz, vNormal2);\n                float spec = pow(max(dot(viewDir, reflectDir), ZERO), uSpecularPower);\n                //const float specularStrength = 1.8;\n                //vDiffuseColor = mix(vDiffuseColor, uSpecularColor, uSpecularStrength * spec);\n                vDiffuseColor += uSpecularColor * uSpecularStrength * spec;\n                // end specular ==============\n\n                vTexCoord = rm_TexCoord0;\n            }`}fillUniformsAttributes(){super.fillUniformsAttributes(),this.viewPos=this.getUniform("viewPos"),this.uSpecularColor=this.getUniform("uSpecularColor"),this.uSpecularPower=this.getUniform("uSpecularPower"),this.uSpecularStrength=this.getUniform("uSpecularStrength")}}class se extends oe{fillCode(){super.fillCode(),this.vertexShaderCode=`#version 300 es\n            precision highp float;\n\n            uniform mat4 view_proj_matrix;\n\n            uniform vec2 uScale; // x: base scale for models; y: max random additional scale\n            uniform sampler2D sPositions;\n            uniform int uPositionOffset;\n\n            uniform vec4 lightDir;\n            uniform mat4 view_matrix;\n            uniform mat4 model_matrix;\n            uniform vec4 diffuse;\n            uniform vec4 ambient;\n            uniform float diffuseCoef;\n            uniform float diffuseExponent;\n\n            out mediump vec2 vTexCoord;\n            out mediump vec4 vDiffuseColor;\n\n            in vec2 rm_TexCoord0;\n            in vec4 rm_Vertex;\n            in vec3 rm_Normal;\n\n            uniform vec3 viewPos;\n            uniform float uSpecularPower;\n            uniform vec4 uSpecularColor;\n            uniform float uSpecularStrength;\n\n            ${H}\n            ${W}\n            ${X}\n\n            const float PI2 = 6.28318530718;\n\n            uniform vec2 uTime; // x=sin(time), y=cos(time)\n            uniform float stiffness;// = 2.0;\n            uniform float heightCoeff;// = 0.06;\n            uniform float windOffset;// = 11.0;\n\n            void main(void)\n            {\n                ${ie.COMMON_TRANSFORMS}\n\n                vec3 vLightVec = (view_matrix * lightDir).xyz;\n                vec4 normal = model_matrix * vec4(rm_Normal, 0.0) * rotationMatrix;\n                vec3 vNormal = normalize( view_matrix * normal).xyz; // w component of rm_Normal might be ignored, and implicitly converted to vec4 in uniform declaration\n                float d = pow(max(0.0, dot(normalize(vNormal), normalize(vLightVec))), diffuseExponent); // redundant normalize() ??\n                vDiffuseColor = mix(ambient, diffuse, d * diffuseCoef);\n\n                // specular ==================\n                vec3 FragPos = vec3(model_matrix * vertex);\n                const float SPECULAR_POWER = 6.0;\n                const float ZERO = 0.0;\n                // const vec3 NORMAL = vec3(0.0, 0.0, 1.0);\n                float time3 =  noise(uTime.x * vertex.xy * .01);\n                vec3 vNormal2 = normalize(normal + time3 * 0.2).xyz; // w component of rm_Normal might be ignored, and implicitly converted to vec4 in uniform declaration\n                //vNormal2 *= time2 / 2.0;\n\n                vec3 viewDir = normalize(viewPos - FragPos);\n                //vec3 lightDir = normalize(lightPos - FragPos);\n                vec3 reflectDir = reflect(-lightDir.xyz, vNormal2);\n                float spec = pow(max(dot(viewDir, reflectDir), ZERO), uSpecularPower);\n                //const float specularStrength = 1.8;\n                //vec4 specularColor = specularStrength * spec * vec4(1.0, 1.0, 1.0, 1.0);\n                //vDiffuseColor = mix(vDiffuseColor, uSpecularColor, uSpecularStrength * spec);\n                vDiffuseColor += uSpecularColor * uSpecularStrength * spec;\n                // end specular ==============\n\n                //gl_Position = view_proj_matrix * vertex;\n                // animation ======================================\n                float time1 = uTime.x;\n                float time2 = uTime.y;\n                // float bendCoeff = pow(rm_Vertex.z * heightCoeff, stiffness);\n                float bendCoeff = pow(abs(rm_Vertex.z) * heightCoeff, stiffness);\n                float noiseX = noise(vertex.xy * .07);\n                float noiseY = noise(vertex.xy * .077);\n                float ox = time1 * noiseX * windOffset;\n                float oy = time2 * noiseY * windOffset;\n                // float oz = time * noise(vertex.xy * .075) * windOffset;\n                vertex.x += ox * bendCoeff;\n                vertex.y += oy * bendCoeff;\n                // vertex.z += oz * bendCoeff;\n                // end animation ==================================\n                gl_Position = view_proj_matrix * vertex;\n                //vDiffuseColor.r += bendCoeff * 5.; // FIXME\n\n\n                // gl_Position = view_proj_matrix * vertex;\n                vTexCoord = rm_TexCoord0;\n            }`}fillUniformsAttributes(){super.fillUniformsAttributes(),this.uTime=this.getUniform("uTime"),this.stiffness=this.getUniform("stiffness"),this.heightCoeff=this.getUniform("heightCoeff"),this.windOffset=this.getUniform("windOffset")}}class ae extends oe{fillCode(){super.fillCode(),this.fragmentShaderCode="#version 300 es\n            precision mediump float;\n            uniform sampler2D sTexture;\n\n            in mediump vec2 vTexCoord;\n            in mediump vec4 vDiffuseColor;\n            out vec4 fragColor;\n\n            void main(void)\n            {\n                vec4 base = texture(sTexture, vTexCoord);\n                if (base.a < 0.9) {\n                    discard;\n                } else {\n                    fragColor = vDiffuseColor * base;\n                }\n            }"}}class le extends U{fillCode(){this.vertexShaderCode=`#version 300 es\n            precision highp float;\n\n            uniform mat4 view_proj_matrix;\n\n            uniform vec2 uRadius; // x: base radius, y: additional random radius\n            uniform vec2 uSpread; // x: X spread; y: Y spread.\n            uniform float uTime;\n            uniform float uRotation;\n\n            out vec2 vTexCoord;\n\n            in vec2 rm_TexCoord0;\n            in vec4 rm_Vertex;\n\n            ${H}\n            ${W}\n\n            const float PI2 = 6.28318530718;\n            const float PI = 3.14159265359;\n            const float HALF_PI = 1.57079632679;\n\n            void main(void)\n            {\n                vec4 vertex = rm_Vertex;\n                float fInstance = float(gl_InstanceID) + uRotation;\n\n                vec2 translation = vec2(\n                    uSpread.x * (random(fInstance * 0.0196) - 0.5),\n                    uSpread.y * (random(fInstance * 0.0177) - 0.5)\n                );\n\n                float angle = uTime + fInstance;\n                float s = sin(angle);\n                float c = cos(angle);\n                float radius = uRadius.x + uRadius.y * random(fInstance);\n\n                mat4 rotationMatrix = rotationAroundZ(-angle + uRotation);\n\n                vertex *= rotationMatrix;\n                vertex.x += s * radius;\n                vertex.y += c * radius;\n                vertex.xy += translation;\n\n                gl_Position = view_proj_matrix * vertex;\n\n                vTexCoord = rm_TexCoord0;\n            }`,this.fragmentShaderCode="#version 300 es\n            precision mediump float;\n            uniform sampler2D sTexture;\n            uniform vec4 color;\n\n            in vec2 vTexCoord;\n            out vec4 fragColor;\n\n            void main(void)\n            {\n                fragColor = texture(sTexture, vTexCoord) * color;\n                if (fragColor.a < 0.2) discard;\n            }"}fillUniformsAttributes(){super.fillUniformsAttributes(),this.uSpread=this.getUniform("uSpread"),this.uTime=this.getUniform("uTime"),this.uRadius=this.getUniform("uRadius"),this.uRotation=this.getUniform("uRotation")}drawModel(e,t,i,n,r,o,s,a,l,d,h){if(void 0===this.rm_Vertex||void 0===this.rm_TexCoord0||void 0===this.view_proj_matrix)return;const u=e.gl;t.bindBuffers(u),u.enableVertexAttribArray(this.rm_Vertex),u.enableVertexAttribArray(this.rm_TexCoord0),u.vertexAttribPointer(this.rm_Vertex,3,u.FLOAT,!1,20,0),u.vertexAttribPointer(this.rm_TexCoord0,2,u.FLOAT,!1,20,12),e.calculateMVPMatrix(i,n,r,o,s,a,l,d,h),u.uniformMatrix4fv(this.view_proj_matrix,!1,e.getMVPMatrix()),u.drawElements(u.TRIANGLES,3*t.getNumIndices(),u.UNSIGNED_SHORT,0),e.checkGlError("VertexLitInstancedShader glDrawElements")}drawInstanced(e,t,i,n,r,o,s,a,l,d,h,u){if(void 0===this.rm_Vertex||void 0===this.rm_TexCoord0||void 0===this.view_proj_matrix)return;const c=e.gl;t.bindBuffers(c),c.enableVertexAttribArray(this.rm_Vertex),c.enableVertexAttribArray(this.rm_TexCoord0),c.vertexAttribPointer(this.rm_Vertex,3,c.FLOAT,!1,20,0),c.vertexAttribPointer(this.rm_TexCoord0,2,c.FLOAT,!1,20,12),c.uniform4f(this.color,this._color[0],this._color[1],this._color[2],this._color[3]),e.calculateMVPMatrix(i,n,r,o,s,a,l,d,h),c.uniformMatrix4fv(this.view_proj_matrix,!1,e.getMVPMatrix()),c.drawElementsInstanced(c.TRIANGLES,3*t.getNumIndices(),c.UNSIGNED_SHORT,0,u),e.checkGlError("InstancedVegetationShader glDrawElements")}}class de extends E{fillCode(){this.vertexShaderCode=`#version 300 es\n            precision highp float;\n\n            uniform mat4 view_proj_matrix;\n\n            uniform vec2 uRadius; // x: base radius, y: additional random radius\n            uniform vec2 uSpread; // x: X spread; y: Y spread.\n            uniform float uTime;\n            uniform float uRotation;\n\n            uniform float uAnimationTime;\n            uniform vec4 uButterflyParams; // x: X size; y: Z animation amplitude, z: Z flight amplitude, w: atlas Y size.\n\n            out mediump vec2 vTexCoord;\n\n            in vec2 rm_TexCoord0;\n            in vec4 rm_Vertex;\n\n            ${H}\n            ${W}\n\n            const float STIFFNESS = 4.0;\n            const float JUMP_PERIOD_COEFF = 4.0;\n            const float HALF = 0.5;\n            const float ONE = 1.0;\n            const float MAGIC_1 = 0.0196;\n            const float MAGIC_2 = 0.0177;\n\n            void main(void)\n            {\n                vec4 vertex = rm_Vertex;\n                float fInstance = float(gl_InstanceID);\n\n                vec2 translation = vec2(\n                    uSpread.x * (random(fInstance * MAGIC_1) - HALF),\n                    uSpread.y * (random(fInstance * MAGIC_2) - HALF)\n                );\n\n                float angle = uTime + fInstance;\n                float radius = uRadius.x + uRadius.y * random(fInstance);\n                translation += vec2(sin(angle), cos(angle)) * radius;\n\n                mat4 rotationMatrix = rotationAroundZ(-angle + uRotation);\n\n                float animCoeff = pow(abs(vertex.x / uButterflyParams.x), STIFFNESS);\n                vertex.z += sin(uAnimationTime + fInstance) * animCoeff * uButterflyParams.y;\n                vertex.z += sin(uTime * JUMP_PERIOD_COEFF + fInstance) * uButterflyParams.z;\n\n                vertex *= rotationMatrix;\n                vertex.xy += translation;\n\n                gl_Position = view_proj_matrix * vertex;\n\n                vTexCoord = rm_TexCoord0;\n                vTexCoord.y *= uButterflyParams.w;\n                vTexCoord.y += mod(fInstance * uButterflyParams.w, ONE);\n            }`,this.fragmentShaderCode="#version 300 es\n            precision mediump float;\n            uniform sampler2D sTexture;\n\n            in mediump vec2 vTexCoord;\n\n            out vec4 fragColor;\n\n            void main(void)\n            {\n                fragColor = texture(sTexture, vTexCoord);\n                if (fragColor.a < 0.2) discard;\n            }"}fillUniformsAttributes(){super.fillUniformsAttributes(),this.uSpread=this.getUniform("uSpread"),this.uTime=this.getUniform("uTime"),this.uRadius=this.getUniform("uRadius"),this.uRotation=this.getUniform("uRotation"),this.uAnimationTime=this.getUniform("uAnimationTime"),this.uButterflyParams=this.getUniform("uButterflyParams")}drawModel(e,t,i,n,r,o,s,a,l,d,h){if(void 0===this.rm_Vertex||void 0===this.rm_TexCoord0||void 0===this.view_proj_matrix)return;const u=e.gl;t.bindBuffers(u),u.enableVertexAttribArray(this.rm_Vertex),u.enableVertexAttribArray(this.rm_TexCoord0),u.vertexAttribPointer(this.rm_Vertex,3,u.FLOAT,!1,20,0),u.vertexAttribPointer(this.rm_TexCoord0,2,u.FLOAT,!1,20,12),e.calculateMVPMatrix(i,n,r,o,s,a,l,d,h),u.uniformMatrix4fv(this.view_proj_matrix,!1,e.getMVPMatrix()),u.drawElements(u.TRIANGLES,3*t.getNumIndices(),u.UNSIGNED_SHORT,0),e.checkGlError("VertexLitInstancedShader glDrawElements")}drawInstanced(e,t,i,n,r,o,s,a,l,d,h,u){if(void 0===this.rm_Vertex||void 0===this.rm_TexCoord0||void 0===this.view_proj_matrix)return;const c=e.gl;t.bindBuffers(c),c.enableVertexAttribArray(this.rm_Vertex),c.enableVertexAttribArray(this.rm_TexCoord0),c.vertexAttribPointer(this.rm_Vertex,3,c.FLOAT,!1,20,0),c.vertexAttribPointer(this.rm_TexCoord0,2,c.FLOAT,!1,20,12),e.calculateMVPMatrix(i,n,r,o,s,a,l,d,h),c.uniformMatrix4fv(this.view_proj_matrix,!1,e.getMVPMatrix()),c.drawElementsInstanced(c.TRIANGLES,3*t.getNumIndices(),c.UNSIGNED_SHORT,0,u),e.checkGlError("InstancedVegetationShader glDrawElements")}}class he{constructor(e,t,i){this.textureData=e,this.tiles=t,this.culledTiles=i}cull(e){for(let t=0;t<this.tiles.length;t++){const i=this.tiles[t];this.culledTiles[t]=e.isModelCulled(i.boundingBox)}}drawTiles(e,t,i,n=1){for(let r=0;r<this.tiles.length;r++){const o=this.tiles[r],s=Math.round(o.instancesCount*n);0!==s&&(this.culledTiles[r]||e.drawInstanced(i,t,0,0,0,0,0,0,1,1,1,o.instancesOffset,s))}}}function ue(e,t,i,n,r){const o=new Float32Array(e.length),s=new Array(t*t);let a=0,l=0;const d=i/t,h=i/2,u=o.length/3/2;for(let i=0;i<t;i++)for(let r=0;r<t;r++){const t=l;let c=0;const m={min:{x:i*d-h,y:r*d-h,z:0},max:{x:i*d+d-h,y:r*d+d-h,z:0}},f={min:{x:m.min.x-n.x,y:m.min.y-n.x,z:0},max:{x:m.max.x+n.x,y:m.max.y+n.x,z:n.z}};for(let t=0;t<u;t++){const i=e[3*t+0],n=e[3*t+1];i>m.min.x&&i<m.max.x&&n>m.min.y&&n<m.max.y&&(o[3*l+0]=i,o[3*l+1]=n,o[3*l+2]=e[3*t+2],o[3*l+0+3*u]=e[3*t+0+3*u],o[3*l+1+3*u]=e[3*t+1+3*u],o[3*l+2+3*u]=e[3*t+2+3*u],l++,c++)}s[a++]={boundingBoxInternal:m,boundingBox:f,instancesOffset:t,instancesCount:c}}return new he(o,s,r)}const ce={x:25,y:25,z:30},me=new Array(16),fe=new Float32Array([87.726,-114.001,.835,44.0889,-142.431,.86356,46.5807,105.192,.22177,-32.1435,-62.4233,.23101,-134.172,-64.1917,.44838,-68.9657,-73.0562,.21271,145.539,-22.5776,.51821,29.1278,-8.04683,.65153,-3.48778,21.4798,.85161,-100.302,142.878,.1003,-147.302,21.457,.73634,-76.2492,35.6231,.64953,68.495,-23.88,.44742,41.9443,30.5061,.0718,-.511131,84.7348,.94091,.9748879741391069,-.222695841629223,0,-.523117898010644,-.852260326884295,0,.6942360716170535,.7197473701693682,0,.5096843264509942,-.8603614864521753,0,.47313172525019465,-.8809916972150046,0,-.003637959044835528,.9999933826050991,0,.5637816433398299,-.8259238818638439,0,-.8343375083968227,.5512539542553702,0,-.8843323228993865,.4668579469982012,0,.8976102438495904,-.4407900295336532,0,.8809573365733816,-.47319570067524247,0,-.18434087797557186,.982862371193035,0,-.8802733835516019,-.47446682730262013,0,-.9989169986212127,-.04652773222055871,0,.6033142620947886,-.797503543034776,0]),_e=(new Float32Array(fe.slice(0,fe.length/2)),new Float32Array(fe.slice(fe.length/2)),ue(fe,4,400,ce,me)),ve=ue(new Float32Array([-97.8327,117.342,.69328,-111.633,96.0024,.63766,-97.2021,155.132,.36827,-154.819,80.5617,.24186,-30.1532,64.3189,.02491,-47.8267,56.7768,.74484,-70.7269,149.215,.66939,-101.388,77.1888,.01608,-13.5901,-.286582,.30126,-38.5456,84.7179,.22045,-41.8196,41.7573,.63355,-131.462,80.5613,.74526,-61.9944,85.9636,.79867,-101.774,59.077,.39862,-150.927,69.8197,.19171,-70.9281,91.9282,.03574,121.045,-104.797,.51456,115.438,-67.0238,.0016,110.222,30.762,.20005,-57.6145,-30.3018,.14702,-37.5022,-99.4647,.16389,86.7184,89.8945,.14714,.701865,47.0858,.19826,45.8065,.863282,4e-4,107.237,121.574,.13187,13.2823,41.5099,.36785,-132.866,111.532,.85905,101.09,94.8165,.03887,-48.4459,-69.2061,.21764,-70.0844,-129.262,.06406,-132.148,.457548,.9387,15.875,23.6906,.65892,-141.043,-82.0164,.68783,59.6386,48.6978,.94631,73.3649,-66.73,.3801,52.8335,20.0134,.78251,89.5817,105.738,.14429,50.92,67.7286,.8697,16.6343,6.65897,.17232,63.3694,-100.471,.48565,19.9507,33.7931,.73958,-61.1721,-59.6412,.72555,25.4066,84.3105,.60059,75.5511,52.3604,.63947,50.4259,-10.1633,.20878,-90.6659,48.4627,.67467,116.324,5.18666,.94642,-43.59,-24.381,.40163,-44.7389,-55.1578,.16274,40.1454,91.8185,.82877,-57.6158,-47.2884,.79503,-38.8279,-42.8392,.54204,88.2564,-74.1988,.85545,37.2427,22.2765,.69772,36.0891,-21.9179,.50563,63.943,60.0359,.99902,92.5023,64.5061,.89414,-132.081,-96.395,.9016,114.868,93.951,.60681,63.0208,29.0235,.23999,56.6394,79.0495,.29515,121.559,125.155,.10677,124.812,64.4218,.48642,-47.7045,-90.4934,.97986,124.707,78.9322,.58498,153.002,4.1807,.59777,-27.5848,-86.4617,.00351,-15.2397,-142.182,.12995,-23.8334,-131.783,.2296,-55.3915,-111.15,.34782,136.47,80.4205,.76765,-18.6615,-118.831,.02501,-37.2174,-121.439,.32615,90.2413,50.2349,.39028,125.095,20.2994,.14931,98.2974,4.54914,.68756,38.5574,80.3908,.86,-37.5985,-166.501,.60437,5.36929,-166.5,.8602,-16.1146,-166.5,.77322,26.8532,-166.5,.88375,-59.0824,-166.501,.30879,-123.534,-166.502,.33505,-145.018,-166.502,.08642,-80.5663,-166.501,.22275,-166.502,-166.503,.24738,-102.05,-166.502,.87681,134.273,-166.498,.16631,69.8209,-166.499,.23597,91.3048,-166.499,.76931,112.789,-166.498,.6085,48.3371,-166.499,.22851,-76.2696,-15.783,.31761,-151.079,-69.658,.50249,-145.984,-110.388,.88438,-152.501,-140.636,.0113,-121.344,-26.8583,.16519,-124.193,-112.794,.39216,-147.257,-94.8343,.76125,-77.5196,11.8978,.12987,-61.2458,-7.2059,.20577,-151.448,-41.1804,.52948,-47.9898,-13.1596,.25482,-59.4781,7.32497,.15209,-151.448,-12.5352,.83425,75.8256,-124.231,.29041,116.369,-152.232,.07512,121.143,-140.316,.43655,37.595,-156.601,.21039,102.046,-123.701,.63696,87.0681,-131.189,.33558,154.297,-124.22,.91253,59.0781,-113.66,.51801,145.014,-145.015,.45521,129.896,-125.601,.15811,150.231,-113.708,.25673,97.0022,-154.788,.68242,102.252,-65.188,.86293,45.4582,-111.862,.0674,39.7019,-85.122,.32018,83.3327,-145.634,.89137,66.3527,-135.332,.16702,16.1098,-81.0868,.42299,-5.37338,-121.767,.57686,-143.896,-126.094,.37966,-69.8252,-114.74,.80601,-5.3729,-151.589,.08938,5.36897,-146.619,.60732,19.6197,-36.7624,.81701,-134.09,-39.7899,.23239,-69.8246,-149.247,.18302,-4.08674,-43.6696,.56548,10.5476,-53.8396,.2005,39.959,-42.0983,.39801,-84.844,.180354,.09109,-154.995,-124.853,.3839,-130.541,-135.13,.17984,-133.031,-156.045,.2511,-113.999,48.9306,.56927,-131.239,47.9151,.17558,-14.4579,158.786,.87218,-79.0284,81.5185,.84514,-60.646,102.879,.75443,-114.828,84.5842,.53857,-8.68415,103.34,.23811,10.8075,74.5183,.25837,-95.4358,36.6476,.90962,-27.1552,76.8092,.18768,-109.644,112.104,.88732,-136.857,59.4754,.81957,-127.439,62.9891,.85345,32.1777,64.1003,.16107,10.339,92.9731,.5376,-143.55,132.485,.8347,-130.557,97.048,.80864,-90.4078,104.602,.28576,-94.6497,88.3731,.17651,82.7165,76.0061,.17664,-21.6847,-156.126,.12612,-84.1033,68.2832,.1514,108.114,77.4842,.86387,104.549,67.2775,.1808,2.82746,109.004,.96529,-21.8347,35.9841,.90299,-21.7546,130.492,.27289,33.7507,142.961,.89812,-78.7409,108.09,.16995,-115.575,141.442,.52815,-166.498,112.788,.4864,-166.497,134.272,.32868,-166.497,155.755,.99671,-166.498,91.3038,.71151,-166.498,69.8199,.17195,48.3386,129.735,.96812,-16.1129,119.625,.31695,93.6934,143.825,.7868,91.3065,123.535,.23978,-1.79055,150.876,.52864,26.855,98.0225,.3598,48.3385,154.247,.66167,-140.173,-10.944,.96143,-29.5597,7.98718,.24093,.647622,-26.9062,.70941,-81.3232,-44.0383,.24891,-95.6727,-73.2651,.95443,-101.186,-131.014,.88373,-97.6119,-115.956,.74197,-145.662,-31.1685,.10642,-86.8985,-117.901,.36739,-67.2379,-30.4572,.91132,-54.3087,-133.035,.23974,26.8529,-146.675,.15081,-86.1194,-140.011,.12038,-92.0965,-16.8618,.71653,19.3717,-138.924,.28978,-58.7504,-84.3747,.23296,-124.793,-81.557,.65761,-82.0045,-77.9833,.51162,32.8621,-110.634,.43219,-120.722,-3.7931,.30104,-20.6941,55.5948,.77893,-74.7876,49.6637,.94891,-45.6392,4.60336,.89891,-104.239,-27.6496,.5367,-108.776,-16.6938,.78578,-144.001,-54.0564,.6793,-118.64,-126.313,.67086,-89.5786,-157.671,.96864,-90.083,-95.6524,.97287,-72.8862,-98.2557,.88956,-106.886,-80.5135,.18515,27.235,-96.5623,.55537,-104.751,-98.9523,.7847,-166.5,-37.5995,.20265,-166.5,-16.1156,.36457,-166.499,48.336,.24528,-166.499,5.36825,.81875,-166.499,26.8521,.09265,166.499,80.5678,.0586,166.5,123.536,.7438,134.274,134.278,.05174,148.597,148.6,.95587,135.468,149.794,.63959,166.499,102.052,.80722,166.5,145.019,.64077,166.499,59.0839,.57421,166.499,37.6,.18838,166.5,166.503,.38199,166.498,-134.271,.42335,166.498,-112.787,.98146,166.498,-91.3033,.21302,166.498,-69.8194,.42172,166.499,-26.8516,.21857,166.499,-5.36776,.69881,166.498,-155.755,.53251,166.499,-48.3355,.51442,166.499,16.1161,.22763,155.756,-166.498,.09302,132.917,-48.558,.94499,54.3418,-128.599,.4644,57.4451,-77.4151,.40467,125.579,-9.28856,.21641,52.075,-92.0659,.18822,28.7566,4.0129,.40666,114.875,-54.3928,.52313,106.73,-139.602,.99079,-28.9152,-14.3759,.97246,87.4612,-53.0666,.47456,23.525,-65.1817,.20867,114.818,-21.1619,.45707,13.2971,-128.056,.03119,27.7012,-48.0141,.89439,-25.1657,-29.6815,.6243,69.9336,-152.945,.72115,157.552,-83.7297,.23837,5.27137,-7.72662,.37061,149.148,-95.8348,.89003,-6.07836,-92.9364,.52791,102.463,-85.3679,.87838,102.394,-104.872,.6683,111.445,-118.058,.70568,129.186,-81.4908,.91072,97.4481,-20.2317,.2676,131.885,-154.582,.0872,139.929,-109.792,.21975,143.069,-131.612,.95486,58.2369,8.74026,.21878,17.8826,-13.492,.06184,111.762,-86.5425,.51585,-13.9526,-13.8562,.09048,.842643,-77.2816,.59982,-37.599,-134.336,.99918,110.783,-37.7455,.37486,136.13,5.37434,.21161,111.597,133.084,.98299,108.131,-10.5534,.91328,156.376,-8.94835,.23388,158.065,106.826,.96514,-150.926,91.3036,.03909,136.137,-67.8633,.0086,89.423,-.884165,.82838,144.512,111.998,.10803,131.589,-60.2449,.50367,92.6288,-42.4383,.00216,141.197,94.8905,.93537,-43.5665,-150.288,.57656,97.3377,25.085,.46936,122.818,48.3422,.3434,158.271,28.0517,.18906,-55.502,-150.028,.53569,17.4144,127.585,.24315,118.806,108.104,.08571,79.7726,27.797,.23346,-148.577,114.58,.66684,141.816,30.4389,.92491,158.065,92.5033,.16651,148.429,123.27,.88512,-11.1473,143.353,.67208,139.66,-90.0665,.07768,103.848,-30.2458,.93798,138.413,43.7005,.25072,80.5642,166.503,.01184,59.0803,166.503,.58031,145.016,166.503,.02524,102.048,166.503,.88794,123.532,166.503,.8575,-112.791,166.501,.81875,-91.3069,166.502,.50155,-69.823,166.502,.51698,-155.759,166.501,.65785,-166.502,-145.019,.18932,-166.501,-102.051,.0271,-166.501,-123.535,.76915,-166.5,-59.0834,.50338,-166.501,-80.5673,.82358,-30.4357,150.876,.18506,14.2563,114.415,.24919,-67.4619,114.999,.25517,-1.21572,128.305,.51825,-54.6316,126.722,.23181,20.8869,149.038,.98772,32.0268,125.599,.77313,-38.0035,128.5,.23789,-58.4295,136.667,.02543,5.9602,142.74,.76485,37.5965,166.502,.98872,-26.8552,166.502,.82186,-48.3391,166.502,.39277,-5.37131,166.502,.46,16.1126,166.502,.63486,-79.8168,125.768,.74602,-69.9399,132.047,.10015,-83.9283,144.475,.78737,-116.371,154.42,.85729,-128.306,139.65,.32252,-153.767,143.226,.17207,-138.782,149.792,.08598,-45.7348,151.348,.63709,-134.275,166.501,.79699,.9968935124625302,-.07876118847579174,0,.6723239550941096,-.7402570495487455,0,-.7921827059004907,-.6102839998493952,0,-.8851132523678202,-.46537568746428865,0,-.6101472853415748,.7922880096216949,0,.8276889480744266,.5611871392284833,0,.9664157679278241,.2569835860526386,0,-.12088443424982952,.9926665873071878,0,.5862244331925074,.8101486986523668,0,.9874923703463258,.15766679583157364,0,.46115837698748563,.8873178412126447,0,-.9825430051060641,-.18603559637108413,0,-.9988351865157414,-.04825215205629743,0,.27856900535103635,-.9604162166778184,0,.8508055694756316,-.5254806209074188,0,-.3384709787019663,-.9409768310519303,0,-.911784166653668,.4106697376721057,0,-.9478642499492393,-.3186743850204561,0,-.9418738741718355,-.3359666726812904,0,.6400794264743114,-.7683087451046725,0,.7384465261510355,.674312040538702,0,-.74686051831799,-.6649807261701525,0,.9906275440159951,-.1365908819681525,0,.7387961038435357,-.6739290147675878,0,.5580669543134833,.8297959234072391,0,-.6730493003250919,-.7395976198798264,0,-.44008949800477526,.8979539151570669,0,-.6331823533046086,-.7740026533957347,0,.23154123537185028,-.9728250903027108,0,.6727823026045777,.739840505313194,0,-.4125151766856114,.9109507280879898,0,-.17663374685749067,-.9842766478338719,0,-.14810874181646047,.9889710817802233,0,-.022031958312998992,-.9997572669467796,0,.7277401238703228,.6858529814101615,0,-.5233968511641724,-.8520890424077927,0,-.9162089661802337,.400700798964698,0,-.815597934184227,.5786190540886303,0,.6070767426977205,-.7946432082862885,0,-.8844557138247494,.4666241424130914,0,-.9605277815347336,.2781840773659829,0,-.88260204094409,-.47012087522394375,0,.6792537062478927,-.7339035376318208,0,.006504620041837252,-.9999788447352831,0,.2156819483945862,.9764636691330175,0,.7332536612569268,.6799551957690388,0,.3862963411216232,.9223747269066117,0,.48084172621981897,-.8768074100541947,0,-.16702521354096633,.9859526246435955,0,-.974093866938832,-.2261440655691698,0,-.30647268827483987,.9518794521059863,0,.1822812061494954,-.98324644005696,0,-.9948307429946677,.10154699795009946,0,.90546661053682,-.42441750341257467,0,.7342243260561514,.6789069443063536,0,-.30768180058062555,.9514893113385269,0,.9708991696744143,-.23948862671436608,0,-.790060416395461,-.613028986627085,0,.7975102524922362,-.6033053929559802,0,-.9767414248591745,-.21442058894628,0,.9257567334147833,-.37811965108572426,0,.7270945811751768,-.6865373041763239,0,.7343481996000437,-.6787729530146103,0,-.522912584926231,.8523863141356548,0,-.471867749784291,-.8816693409172793,0,.8807508577280021,-.4735799052022675,0,.9650828664129425,-.2619447669952173,0,-.9366205849481509,-.35034537224199735,0,.37826582962583344,-.925697014220895,0,.8690548437199268,-.49471575536557727,0,.29050411393329967,.9568737428667528,0,.9913289190060367,.1314038596934002,0,-.38295374590280257,-.9237675186425488,0,.9990481497917022,.04362103159917815,0,-.20051406949310707,-.9796908226248286,0,.29449657013476166,-.9556525363220993,0,-.9873622976964707,-.15847931438375806,0,.9375499606791535,.34785064500517693,0,.9996299931981524,-.027200674599387988,0,.11796177768098429,-.9930181362927578,0,-.8035550236368435,.595230479720244,0,.44896705555719074,-.8935483104031401,0,.8654055994924642,-.5010719991848362,0,-.4393734553394153,.8983044955598869,0,-.9937502333046269,.11162649240659489,0,.936716831626061,-.3500879565886745,0,-.6094072959066223,.7928573312366975,0,-.94684962877967,-.3216765152755187,0,.04082028532316609,-.99916650479594,0,.5750236656660002,-.8181367758046548,0,-.8170547366652116,-.576560107268047,0,-.620454881428756,.7842421437994953,0,.7319253195467444,-.6813848593903419,0,.0771191547994578,-.997021883392244,0,.1642885735618308,-.9864123197715137,0,.977777919340628,-.20964336490791327,0,-.49304947472892824,.8700012732574177,0,-.9726213842522706,.23239544508272322,0,-.23673155741279983,-.9715750973161623,0,-.9992811526628622,.037910129685632364,0,.6685319621431816,-.743683410863109,0,-.9487216645041077,.3161126433734587,0,.735999992736664,.676981543833826,0,.4865715093487757,.873640753565248,0,-.8312317487696298,-.5559260560878425,0,.6374882245485798,-.7704600986176374,0,-.9923280015332155,-.12363307556270885,0,.3880964028233058,.9216187835084582,0,-.9976129864294325,.0690530904981725,0,.7836528932950271,.6211989559153597,0,.9559014653978755,.29368756945126956,0,.9605658264082578,.2780526805060881,0,-.9988351915141985,.048252048586504157,0,-.9072849310662584,-.42051641330641865,0,.47164904457018514,-.8817863566397653,0,.5963292354608856,-.8027399597220981,0,.9383037859799485,-.34581209524204776,0,-.9279142055306012,.37279381321920185,0,-.6333624569994416,.7738552823775454,0,-.1490507213420222,.9888295517769596,0,.9392092907209932,.3433451735839152,0,-.4789190878152192,.8778590475276987,0,.6451809705892166,-.764029786847055,0,-.9436488064160329,-.33094853096757576,0,-.33678538041032896,.9415814396757564,0,.9983854853450156,-.05680160783285686,0,-.5198348566278815,-.8542667743946676,0,.3762188564226291,.9265308262934641,0,.27600241145479365,-.9611569428928549,0,.6452906276792323,-.7639371740066997,0,.9090905274421146,-.4165986232754712,0,-.35668337575998665,.9342253312003802,0,-.8122654513918494,-.5832879533088225,0,-.9989278266315128,.04629467767726967,0,-.9999974498328342,-.0022583905393424018,0,.6948730866622761,-.7191323893640453,0,.960516719317128,-.27822227069783884,0,.786795383438163,-.6172139212626316,0,-.4518826014937054,.8920774150640072,0,.2013106191585912,.9795274547525377,0,-.9979415225695556,-.0641304727220778,0,-.9986266363876773,-.052391231108207835,0,.5060943223841193,.8624781370275765,0,-.8834051166589697,-.46861007229972357,0,-.411531506838297,-.9113955337170578,0,-.9650437283578462,.26208892070667067,0,.8910369786544508,-.45393072452781597,0,.015408556125862677,.9998812811519756,0,-.833910651027204,.5518994710120538,0,.5043537096280559,-.8634971543580319,0,.9918819089671735,-.12716241057653668,0,.033233385699222254,-.9994476184748087,0,.9820437958063837,.18865307608992174,0,-.8253763987798771,.5645828551569392,0,.3562016905166767,.9344090943869616,0,-.8639023145822013,.5036593996536899,0,-.001545482454307891,-.9999988057412786,0,.9963798704333664,.08501266843940322,0,.24376676359882532,.9698338852424957,0,.9731749030103604,-.23006652983599285,0,-.8618449799005135,.5071717959629494,0,.5396255170425832,-.84190516173529,0,.8867848867559673,.4621823932401645,0,-.9762894511931612,.2164691836935597,0,-.9595344667998169,-.281591205514645,0,.335912183054062,-.9418933088603265,0,-.5287139280733865,-.8488000838013683,0,-.3825041414540365,.9239537768581881,0,-.2995957587061823,-.9540662353134959,0,.7578107114464053,-.6524744635747004,0,-.5470624829919579,-.8370917749582024,0,.8081083148906272,-.589033913628605,0,.8538207060305839,.5205671925442816,0,.994462383177442,-.10509314176026208,0,.7714928412566755,-.6362380025506982,0,-.8884620114319931,.45895016531451105,0,-.054468710779565443,.9985154778700288,0,-.32249285870536376,.9465718969439365,0,-.9339718214216218,-.35734666192701187,0,.5336869611222017,-.8456821078444013,0,.7079417667949243,-.7062708084207368,0,-.9873423240431654,.15860370472672164,0,-.5793301464450799,-.8150929894312197,0,.9686918953929474,-.24826601015849717,0,.7562160214799899,-.6543220375755163,0,.23019162427488699,.9731453211692944,0,.5995192772909068,-.8003603164554005,0,.789263169974853,.6140550859012947,0,.8457473577310505,.5335835519306669,0,-.7608079081783738,.6489771389295982,0,.7048593261422651,.7093471155578712,0,-.9990607332607313,.043331873448188216,0,-.15063267585502157,-.9885898021751772,0,.9929529065448459,.11850960038808,0,-.9172221041244479,-.39837621880016943,0,-.8020994651486297,.5971904620875003,0,.9861624895423944,.1657816160481819,0,.9948148844882195,-.101702239900065,0,.17040134837397342,.9853747411377722,0,.8639924328261194,-.5035047924490923,0,.5116357177499814,.8592024745788744,0,-.6191979153408445,.7852349595105611,0,-.7774276214005179,.6289724107490988,0,-.5453009144139369,-.8382403669230708,0,.9538097132088036,.30041143618134764,0,-.7535707471754656,.6573668146487245,0,.7684122497963374,-.6399551659006522,0,-.7691127373547546,.6391131333642552,0,.6717504675163464,-.7407775032974274,0,.14394128315723173,-.9895862302008096,0,-.14441853265199772,.9895166938595042,0,.05498135811309803,-.9984873811220847,0,.47490925387255956,-.880034772373347,0,-.9766606275964168,-.2147883109086089,0,-.8487104836256103,-.5288577455081684,0,.888461149630923,-.4589518336345314,0,.9143791472425669,-.40485895703066305,0,.8258910224224726,.5638297784632902,0,.3348964587539573,.9422549346721719,0,-.3131675967364804,.9496978763555793,0,.9695027922070109,.24508026420503434,0,-.7378295096833676,.6749871218330031,0,-.0047726406647966724,.9999886108856864,0,.16050897399269792,-.987034380995825,0,.060260612840242894,-.9981826779403249,0,-.914086529618584,.4055191935899625,0,-.44181664960316336,.8971053718117151,0,.6044820664244377,-.7966187490708725,0,-.9999041078384492,.01384828970649438,0,-.8305260953442269,.5569797168230385,0,-.9457461664724546,.3249064305344789,0,.8112509361603139,-.5846981431294394,0,-.9960996583447262,.08823531405009906,0,.8549911199163045,-.5186426369517486,0,-.42609573518137517,.9046780778046096,0,.2838094640920206,-.9588806954422433,0,.24659973518222458,-.969117418380279,0,-.9757152100524065,-.2190429840747891,0,-.4257425346228848,-.904844348058207,0,-.5140688220839642,.857748941218353,0,-.7665027883676253,-.642240979247397,0,-.3590019687420476,.9333368022527205,0,.9711122463876414,.2386231441330636,0,.8499093240788704,-.5269289713460416,0,-.8853879097258458,-.4648529329920351,0,.3940680518306465,-.9190812643756802,0,.5438712363542627,.8391686828442096,0,.9798876889698744,-.19954978578108912,0,.3359491368515647,.9418801290231622,0,.6403701321044023,-.7680664645124081,0,-.7329923242388556,.680236909177178,0,.02797033250973034,.999608753712819,0,-.9966923248246571,.0812675189458876,0,.4144072657695442,.9100915437896401,0,-.6944934391508775,.7194990361191504,0,-.9617131816757374,-.2740579431272337,0,-.9844130060254395,.1758722080601656,0,-.6459904593419546,.7633454830148473,0,-.04346330959384442,-.9990550238696313,0,.9814727873501413,.19160158582627712,0,.8973416320648772,.44133660097837185,0,-.08768113796126925,-.9961485923524748,0,.9951658095370897,.09820901958776009,0,-.24903148396386082,-.9684953897643278,0,-.972421885682817,.2332288066364755,0,-.8823378878043542,-.47061645927968865,0,-.29341601931518063,-.9559848532321177,0,.4702183213111021,-.8825501290597431,0,.2547837538154307,.9669980552160992,0,.135319078772395,-.9908020725251792,0,.34020796836362266,-.9403502210676065,0,.6121466903488944,-.7907442250784351,0,-.5336889719720874,.8456808388484254,0,.09561072747148082,-.9954188007026863,0,.08831719450096448,-.9960924019163477,0,.21057574681081237,-.9775775441646911,0,-.2935374689398417,-.9559475688176583,0,.671377955185843,.7411151336266695,0,-.8766039781027927,.4812124952392224,0,.4294347178557896,-.9030979033859609,0,.9455357990641323,.32551812958444093,0,-.9564512793490292,-.2918920181019092,0,.545710479942646,-.8379737896144288,0,-.7440915306971193,-.6680776855612062,0,.6557571675287798,-.7549718784396091,0,.34181041088552105,.9397689306474604,0,.43101024493159373,.9023470334433463,0,.9559161699987233,-.29363970428906916,0,-.9963303843124527,-.08559068463215058,0,.5914160685028448,-.8063665629951668,0,.27007784917706296,.9628384887320882,0,.9164482056302379,.4001533286093185,0,.5288454496129684,.8487181454544596,0,.1332796931448377,.9910784648024685,0,.7640766434452658,-.6451254784469578,0,-.7060534978279984,-.7081584979401495,0,-.7895126716225966,.6137342595515993,0,-.4184226899656213,.9082524167443397,0,-.7410112759851668,-.671492582879986,0,.9540060578912025,-.2997873271285623,0,-.924452442722322,-.38129736577208617,0,.40765634972866727,.9131354228841955,0,-.8236716798057041,-.5670669835972199,0,-.32340950331027757,-.9462591046688003,0,-.16800044772581013,.9857869189454318,0,.9528070410230349,-.30357658436863777,0,-.5631106356428678,.82638151723395,0,.3281922623844936,-.9446109457924716,0,-.4213645854808049,-.9068913309226136,0,.01717471326290172,.9998525037345944,0,.9997050666224605,.024285381804324484,0,.9937746240471731,-.11140914055812412,0,.7775293899147098,-.6288466011825612,0,-.9607470274166974,.27742593481861016,0,-.9713812898691131,-.23752555587182217,0,.9798032998709515,-.19996373061631512,0,-.2632933065723885,-.9647158310684957,0,-.7322666637615709,.6810180123487913,0,-.5496659884479427,.8353845229255484,0,.37311457960678635,-.9277852717546508,0,-.8837268364120121,-.468003075422819,0,-.5211907132370185,-.8534402383503417,0,-.9912005596143479,.13236861644741713,0,.9536195851852535,.30101442947324814,0,.023263746650139548,.9997293624235501,0,.9848074843276047,.17364970144614314,0,.9897876968394407,-.14254934298436983,0,-.07269915373415965,.9973539156419535,0,-.9289750940897291,-.37014223558110587,0,.770654694434567,.6372529654273601,0,.5968625224755877,.8023435232268524,0,-.74910841450201,-.6624474192887195,0,-.9874781538661086,.15775581015348358,0,-.9956147414192907,-.09354831194948865,0,-.5714013720925019,.8206707451656884,0,-.36866306388026016,-.9295630937867635,0,.3475865073529601,-.937647918947283,0,-.42754895476632293,.903992196469762,0,-.7908534733084855,.6120055422591404,0]),4,400,ce,me),ge=ue(new Float32Array([-135.549,16.1097,.12055,-147.726,6.56152,.03329,-130.541,-135.13,.91595,-144.001,-54.0564,7e-4,-132.148,.457548,.36004,-142.863,35.3392,.23895,-131.239,47.9151,.46836,-136.857,59.4754,.43825,-129.477,-51.3309,.94129,122.818,48.3422,.91146,67.503,-51.5735,.02476,80.3651,-19.896,.45353,136.137,-67.8633,.47462,80.1656,-37.9693,.81894,-102.049,130.257,.77958,-38.0035,128.5,.45273,-43.5479,101.709,.0736,122.736,152.578,.39981,72.4748,137.405,.2531,66.1975,150.198,.1568,17.4144,127.585,.03674,89.423,-.884165,.9854,-99.2771,-39.2287,.20648,-81.3232,-44.0383,.95349,150.606,52.3205,.09679,-116.749,-43.4893,.38586,79.7726,27.797,.56389,97.3377,25.085,.73853,111.597,133.084,.73693,38.1273,113.573,.95806,-113.999,48.9306,.58556,33.7507,142.961,.48011,-32.5548,116.611,.17275,143.505,67.4389,.2584,141.197,94.8905,.83885,55.5,117.098,.51596,-79.0284,81.5185,.8761,-119.465,122.966,.1179,108.235,46.9016,.07138,32.1777,64.1003,.14899,-84.1033,68.2832,.7651,-30.2592,96.5888,.33956,-57.4196,48.0892,.83193,-95.4358,36.6476,.23724,10.8075,74.5183,.44742,-28.155,-48.9788,.33977,-21.5433,-60.9185,.65232,-115.575,141.442,.86025,-29.4499,19.6448,.10363,-7.50355,-57.8215,.92021,-29.5597,7.98718,.11308,-109.644,112.104,.83829,-81.1685,22.6262,.62276,-62.6213,27.7413,.62707,-28.9715,-75.9553,.62586,-74.7876,49.6637,.71093,-6.07836,-92.9364,.38136,-25.1657,-29.6815,.37322,151.931,-41.031,.82542,23.525,-65.1817,.26978,27.7012,-48.0141,.38452,-95.0919,18.4307,.75484,-58.7504,-84.3747,.92152,93.3745,-104.373,.97788,-126.669,26.7611,.32932,-72.8862,-98.2557,.8725,-1.08236,33.2659,.35388,-113.219,16.2585,.4247,13.2971,-128.056,.80811,132.475,-22.6866,.4772,125.579,-9.28856,.92878,61.0135,-64.8289,.29325,75.8109,11.8844,.09753,57.4451,-77.4151,.30443,66.1816,-5.5891,.90954,124.812,64.4218,.6245,102.463,-85.3679,.80999,114.818,-21.1619,.37809,136.47,80.4205,.57089,151.123,80.6513,.03318,71.62,-82.2945,.37388,54.6005,-40.8618,.00568,89.1525,-90.6785,.28499,97.4481,-20.2317,.1994,-27.5848,-86.4617,.98057,-13.0122,-100.388,.43714,58.2369,8.74026,.09302,5.26107,-103.755,.49414,.653939,13.2128,.14608,-16.8769,22.9472,.32881,45.8065,.863282,.79771,-90.6659,48.4627,.82752,-61.1721,-59.6412,.09954,76.0928,-114.088,.5846,73.3649,-66.73,.6871,37.2557,48.8637,.42022,15.875,23.6906,.74215,.471659,62.6952,.31289,-101.186,-131.014,.32557,20.9786,57.4706,.95202,88.2564,-74.1988,.39354,68.3143,113.99,.7978,35.7148,-70.3075,.67352,144.742,-50.6495,.49337,78.9551,-95.6871,.17378,-48.4459,-69.2061,.82205,-97.6119,-115.956,.73661,110.222,30.762,.26483,139.108,-37.4252,.70097,-86.8985,-117.901,.06229,-87.8635,-54.9604,.13876,71.9016,84.6389,.47,-118.64,-126.313,.90917,76.349,98.861,.33139,73.0938,126.012,.53,50.4259,-10.1633,.85366,-114.677,34.6438,.11475,-41.2073,41.7697,.10962,86.7184,89.8945,.50797,-60.1396,68.4793,.9206,-12.7721,82.5047,.60294,-21.3997,36.0397,.54724,89.7934,49.1531,.12613,15.8821,7.65362,.88755,55.0239,97.042,.40167,-10.4966,66.7169,.12175,-104.813,-58.4138,.48267,-100.743,4.42635,.11681,-84.844,.180354,.25152,-69.8252,-114.74,.94055,-77.5196,11.8978,.81603,-103.365,28.2396,.35441,-61.9944,85.9636,.14594,-52.9248,23.2368,.89772,-77.4545,-62.4291,.13892,-59.4781,7.32497,.1974,-120.235,-69.3232,.84871,25.8932,-123.478,.58915,-4.08674,-43.6696,.48005,37.5947,-136.804,.96998,56.3395,-28.9137,.59908,10.5476,-53.8396,.60734,43.9176,-60.6188,.75637,39.959,-42.0983,.76805,56.6473,-146.702,.05185,109.21,141.438,.42868,93.6934,143.825,.88834,-83.9283,144.475,.0411,-70.9281,91.9282,.51509,-13.5901,-.286582,.83744,-101.774,59.077,.45619,-97.8327,117.342,.72183,-71.5073,64.2542,.68134,-16.1129,119.625,.74754,48.3386,129.735,.74438,48.3385,154.247,.94867,32.0268,125.599,.03716,.9140698748311425,-.4055567333014944,0,-.9949334577795435,-.10053563841166685,0,-.2868132054203161,-.9579865266257785,0,-.8967008878512512,.4426370044706811,0,.8841937560035473,.4671203290848509,0,.1401187140553252,-.9901347110224356,0,.006765295539604454,.9999771151262722,0,.9076565504746499,.41971369572657413,0,.4589085370027373,.8884835140091274,0,-.9990259657191668,-.04412618065147023,0,.9861797170601236,-.16567910447372208,0,.8061415963477321,.5917226771367903,0,-.6656550268427187,-.7462595964133523,0,.11549040838663042,.9933085953371638,0,-.9779487488519973,.20884502536285848,0,.09334036811006229,-.9956342579888853,0,-.9596893839166931,.28106278017125985,0,.9570722183188293,-.2898495625704395,0,-.12162675503872536,.9925759076558074,0,-.8486487385668586,.5289568210439105,0,.8251084784702526,.5649743345998159,0,-.9155643871706318,.4021714223373728,0,.9414734603014179,-.337087115666076,0,-.9999232809064978,-.012386779290234753,0,-.9266442871209674,-.3759393104559221,0,-.9990585637417668,.04338186503872477,0,.3422332026258103,.9396150461867249,0,-.8449807310620251,-.534796750302286,0,-.5728734814696287,.8196438093640841,0,-.4584746677351802,.8887074766452211,0,-.810926014810633,.5851486977712119,0,-.7096582809298015,.704546041297344,0,-.8876019031078308,-.46061139977138754,0,.9939941913025735,.10943284542011518,0,-.06957627066400407,.997576634931116,0,-.16264968613305883,.9866838802781859,0,.27330593955370586,.9619271611742056,0,.39046776177295617,.9206166015318309,0,-.26069980270368615,-.965419915306422,0,-.8135948515646404,.5814322123063966,0,.8737325575247166,-.4864066384428958,0,.8484587248078324,-.529261553768519,0,-.905233489043894,.4249144976503134,0,-.8166213083710955,.5771738375171558,0,-.13019304177431576,.9914886645209572,0,.810711179305404,.5854463115856492,0,.13744863259624024,.9905088961727824,0,-.024727776183703625,.9996942217923482,0,-.64403549711225,.7649956068235797,0,.4495193750943261,-.8932705812993097,0,-.9996502147581966,.026447081765127698,0,.08836912017766424,.9960877966319162,0,-.7094865755578085,.7047189504357423,0,-.17340546695376316,.9848505186222666,0,.6420762360355313,.7666407940609765,0,-.5480650743074345,.8364356964670903,0,.8703935702547856,.49235661147092113,0,-.9317592108211784,.3630768142554613,0,-.7112043788101795,-.7029852996764774,0,.06603437523593578,-.9978173486601641,0,.9759041294126831,-.21819974838499007,0,.7667303915061587,.6419692412731411,0,-.5033752936614231,-.8640678872237274,0,.23047124273159433,.9730791366963709,0,-.08626753348522458,-.9962720073686582,0,.9113072942183161,.4117268700297461,0,.30270964704327763,.9530828240960668,0,.8061161755513679,-.5917573079518631,0,-.31628098983314257,.9486655551194887,0,-.040781989443463666,.9991680686136007,0,-.1625091110854122,-.9867070430549431,0,.7400573045804086,.6725438171131903,0,-.9635176252439033,.2676448875737201,0,.7885409969743447,-.6149821916858297,0,-.41418958095845076,.9101906344417432,0,-.6670814856608885,-.7449847592323362,0,.9913581654605742,-.13118303158047828,0,.7631247602202242,-.6462511898161776,0,.16538969062765002,.9862282951903633,0,.771018301382246,.6368129858393562,0,.8350349912174959,-.5501968406328743,0,-.9780666300532209,.20829226384178542,0,-.9181077178748107,.39633094552243464,0,-.8206217939820554,.5714716714253412,0,-.9797511382744013,-.20021914756090387,0,.275241239523189,-.961375192141829,0,.7080734345893963,-.706138804505726,0,-.29443674827059196,-.9556709691456783,0,-.8302399810797021,.5574061121092735,0,.9361661417145458,-.3515578972335865,0,.386313475571975,-.9223675507038943,0,.09403673824564357,.9955687278435981,0,.8372296500792409,.5468514542617511,0,.6142734878710088,.7890932024157765,0,.9423419140238645,.3346516353969296,0,.11720248750651582,.9931080388972214,0,-.8831784765449473,-.4690370758988527,0,-.2949524398561577,-.9555119351546059,0,-.3681086780775783,-.92978277093307,0,.9634243765648933,-.2679803549526469,0,.9603068074440183,-.27894593665561285,0,-.7361080260795143,-.6768640734603374,0,-.1145374265943165,.9934189337380034,0,.9090409789372745,-.4167067297425871,0,.9936433088525971,-.11257430778140413,0,-.9969296485882049,.07830246334438286,0,.538118480534915,.8428692074733745,0,-.5733019539697795,.8193441704036423,0,.826755249894549,.5625617804044298,0,-.9993609405450095,.035745076765816654,0,-.99664356984194,.08186326827530123,0,.8550322841730821,.5185747709074959,0,.7750121859998429,.631946288502231,0,.4210012032845477,.9070600789545106,0,.9643309276028093,.26469956945319256,0,.9064192634961742,.42237911733779304,0,.06963269819856362,.9975726977727426,0,-.8087742726134313,.5881191851645508,0,-.8279001321529594,.5608755398313536,0,-.5255777863415156,.8507455497999106,0,.8724271939745399,-.488744095835142,0,-.5877769754949278,-.8090230077556726,0,-.3206620631811768,.9471936661720194,0,.9649697474369218,.2623611757320876,0,-.37208053601858987,.9282004496422736,0,.06762049235138548,-.997711115009829,0,-.6435919852830374,-.7653687715601144,0,.25236236613774404,.967632800269482,0,.08405847760559389,-.9964608232854064,0,-.42199816808189355,-.906596683280678,0,-.9998391000949952,.01793805790018034,0,-.8770177034984277,.48045806034485883,0,.5249843541526465,.8511118774255995,0,-.21774777278397828,-.9760050755234918,0,.8202391464096408,.5720207537294288,0,-.17141142244291502,-.9851995352496349,0,.9706168158002019,-.2406304155460754,0,.06393026054650473,.9979543685892938,0,-.44745026388425435,-.894308817663066,0,.7195632366160739,-.6944269209287612,0,-.10515577315512252,-.994455762400796,0,-.9843655425304809,-.17613766967537606,0,-.9586865449606988,-.28446459975068605,0,.6071457902395015,-.794590453878255,0,-.07915853145497666,-.9968620400526301,0,-.944311754299752,-.32905213977624415,0,-.6324149073988041,-.7746298373415279,0,-.9584416058816287,-.28528878021233967,0,-.9946299678752377,.10349505787477727,0,-.876288816981142,-.48178616546533437,0,.3121859534090077,.950021015817076,0,.4193302538750088,.9078337613159805,0,.969651371266351,.24449175487383026,0,-.5473088207529228,.8369307347242334,0,-.07574174915904718,.9971274679971102,0,-.936375119924256,.35100090425358615,0,-.228719066407469,.9734924697508943,0]),4,400,ce,me);class xe{constructor(e){this.pointsBB=[B(),B(),B(),B(),B(),B(),B(),B()],this.mMVPMatrix=w(),this.modelMatrix=w(),this.renderer=e,y(this.modelMatrix),function(e,t,i,n){var r,o,s,a,l,d,h,u,c,m,f,_,v,g,x,p,A,T,b,E,C,w,y,S,P=n[0],I=n[1],D=n[2],R=Math.hypot(P,I,D);R<1e-6||(P*=R=1/R,I*=R,D*=R,r=Math.sin(i),s=1-(o=Math.cos(i)),a=t[0],l=t[1],d=t[2],h=t[3],u=t[4],c=t[5],m=t[6],f=t[7],_=t[8],v=t[9],g=t[10],x=t[11],p=P*P*s+o,A=I*P*s+D*r,T=D*P*s-I*r,b=P*I*s-D*r,E=I*I*s+o,C=D*I*s+P*r,w=P*D*s+I*r,y=I*D*s-P*r,S=D*D*s+o,e[0]=a*p+u*A+_*T,e[1]=l*p+c*A+v*T,e[2]=d*p+m*A+g*T,e[3]=h*p+f*A+x*T,e[4]=a*b+u*E+_*C,e[5]=l*b+c*E+v*C,e[6]=d*b+m*E+g*C,e[7]=h*b+f*E+x*C,e[8]=a*w+u*y+_*S,e[9]=l*w+c*y+v*S,e[10]=d*w+m*y+g*S,e[11]=h*w+f*y+x*S,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]))}(this.modelMatrix,this.modelMatrix,0,[1,0,0]),I(this.modelMatrix,this.modelMatrix,[0,0,0])}isModelCulled(e){let t;this.pointsBB[0][0]=e.min.x,this.pointsBB[0][1]=e.min.y,this.pointsBB[0][2]=e.min.z,this.pointsBB[0][3]=1,this.pointsBB[1][0]=e.min.x,this.pointsBB[1][1]=e.max.y,this.pointsBB[1][2]=e.min.z,this.pointsBB[1][3]=1,this.pointsBB[2][0]=e.min.x,this.pointsBB[2][1]=e.max.y,this.pointsBB[2][2]=e.max.z,this.pointsBB[2][3]=1,this.pointsBB[3][0]=e.min.x,this.pointsBB[3][1]=e.min.y,this.pointsBB[3][2]=e.max.z,this.pointsBB[3][3]=1,this.pointsBB[4][0]=e.max.x,this.pointsBB[4][1]=e.min.y,this.pointsBB[4][2]=e.min.z,this.pointsBB[4][3]=1,this.pointsBB[5][0]=e.max.x,this.pointsBB[5][1]=e.max.y,this.pointsBB[5][2]=e.min.z,this.pointsBB[5][3]=1,this.pointsBB[6][0]=e.max.x,this.pointsBB[6][1]=e.max.y,this.pointsBB[6][2]=e.max.z,this.pointsBB[6][3]=1,this.pointsBB[7][0]=e.max.x,this.pointsBB[7][1]=e.min.y,this.pointsBB[7][2]=e.max.z,this.pointsBB[7][3]=1,this.prepareCullingMatrix();for(let e=0;e<8;e++)O(this.pointsBB[e],this.pointsBB[e],this.mMVPMatrix);t=!0;for(let e=0;e<8&&(t=0>this.pointsBB[e][2],t);e++);if(t)return t;t=!0;for(let e=0;e<8&&(t=this.pointsBB[e][0]<-this.pointsBB[e][3],t);e++);if(t)return t;t=!0;for(let e=0;e<8&&(t=this.pointsBB[e][0]>this.pointsBB[e][3],t);e++);if(t)return t;t=!0;for(let e=0;e<8&&(t=this.pointsBB[e][1]<-this.pointsBB[e][3],t);e++);if(t)return t;t=!0;for(let e=0;e<8&&(t=this.pointsBB[e][1]>this.pointsBB[e][3],t);e++);return t}prepareCullingMatrix(){P(this.mMVPMatrix,this.renderer.getViewMatrix(),this.modelMatrix),P(this.mMVPMatrix,this.renderer.mProjMatrix,this.mMVPMatrix)}}class pe extends class{constructor(){this.mMMatrix=s(),this.mVMatrix=s(),this.mMVPMatrix=s(),this.mProjMatrix=s(),this.matOrtho=s(),this.m_boundTick=this.tick.bind(this),this.isWebGL2=!1,this.viewportWidth=0,this.viewportHeight=0}get gl(){if(void 0===this.m_gl)throw new Error("No WebGL context");return this.m_gl}logGLError(){var e=this.gl.getError();e!==this.gl.NO_ERROR&&console.warn(`WebGL error # + ${e}`)}setTexture2D(e,t,i){this.gl.activeTexture(this.gl.TEXTURE0+e),this.gl.bindTexture(this.gl.TEXTURE_2D,t),this.gl.uniform1i(i,e)}setTextureCubemap(e,t,i){this.gl.activeTexture(this.gl.TEXTURE0+e),this.gl.bindTexture(this.gl.TEXTURE_CUBE_MAP,t),this.gl.uniform1i(i,e)}setFOV(e,t,i,n,r){const o=Math.tan(t/360*Math.PI)*n,s=o*i;!function(e,t,i,n,r,o,s){var a=1/(i-t),l=1/(r-n),d=1/(o-s);e[0]=2*o*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*o*l,e[6]=0,e[7]=0,e[8]=(i+t)*a,e[9]=(r+n)*l,e[10]=(s+o)*d,e[11]=-1,e[12]=0,e[13]=0,e[14]=s*o*2*d,e[15]=0}(e,-s,s,-o,o,n,r)}calculateMVPMatrix(e,t,i,n,r,o,s,l,d){!function(e){e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1}(this.mMMatrix),function(e,t,i,n){var r,o,s,a,l,d,h,u,c,m,f,_,v,g,x,p,A,T,b,E,C,w,y,S,P=n[0],I=n[1],D=n[2],R=Math.hypot(P,I,D);R<1e-6||(P*=R=1/R,I*=R,D*=R,r=Math.sin(i),s=1-(o=Math.cos(i)),a=t[0],l=t[1],d=t[2],h=t[3],u=t[4],c=t[5],m=t[6],f=t[7],_=t[8],v=t[9],g=t[10],x=t[11],p=P*P*s+o,A=I*P*s+D*r,T=D*P*s-I*r,b=P*I*s-D*r,E=I*I*s+o,C=D*I*s+P*r,w=P*D*s+I*r,y=I*D*s-P*r,S=D*D*s+o,e[0]=a*p+u*A+_*T,e[1]=l*p+c*A+v*T,e[2]=d*p+m*A+g*T,e[3]=h*p+f*A+x*T,e[4]=a*b+u*E+_*C,e[5]=l*b+c*E+v*C,e[6]=d*b+m*E+g*C,e[7]=h*b+f*E+x*C,e[8]=a*w+u*y+_*S,e[9]=l*w+c*y+v*S,e[10]=d*w+m*y+g*S,e[11]=h*w+f*y+x*S,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]))}(this.mMMatrix,this.mMMatrix,0,[1,0,0]),function(e,t,i){var n,r,o,s,a,l,d,h,u,c,m,f,_=i[0],v=i[1],g=i[2];t===e?(e[12]=t[0]*_+t[4]*v+t[8]*g+t[12],e[13]=t[1]*_+t[5]*v+t[9]*g+t[13],e[14]=t[2]*_+t[6]*v+t[10]*g+t[14],e[15]=t[3]*_+t[7]*v+t[11]*g+t[15]):(n=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],d=t[6],h=t[7],u=t[8],c=t[9],m=t[10],f=t[11],e[0]=n,e[1]=r,e[2]=o,e[3]=s,e[4]=a,e[5]=l,e[6]=d,e[7]=h,e[8]=u,e[9]=c,e[10]=m,e[11]=f,e[12]=n*_+a*v+u*g+t[12],e[13]=r*_+l*v+c*g+t[13],e[14]=o*_+d*v+m*g+t[14],e[15]=s*_+h*v+f*g+t[15])}(this.mMMatrix,this.mMMatrix,[e,t,i]),function(e,t,i){var n=i[0],r=i[1],o=i[2];e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]}(this.mMMatrix,this.mMMatrix,[s,l,d]),function(e,t,i){var n=Math.sin(i),r=Math.cos(i),o=t[4],s=t[5],a=t[6],l=t[7],d=t[8],h=t[9],u=t[10],c=t[11];t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*r+d*n,e[5]=s*r+h*n,e[6]=a*r+u*n,e[7]=l*r+c*n,e[8]=d*r-o*n,e[9]=h*r-s*n,e[10]=u*r-a*n,e[11]=c*r-l*n}(this.mMMatrix,this.mMMatrix,n),function(e,t,i){var n=Math.sin(i),r=Math.cos(i),o=t[0],s=t[1],a=t[2],l=t[3],d=t[8],h=t[9],u=t[10],c=t[11];t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*r-d*n,e[1]=s*r-h*n,e[2]=a*r-u*n,e[3]=l*r-c*n,e[8]=o*n+d*r,e[9]=s*n+h*r,e[10]=a*n+u*r,e[11]=l*n+c*r}(this.mMMatrix,this.mMMatrix,r),function(e,t,i){var n=Math.sin(i),r=Math.cos(i),o=t[0],s=t[1],a=t[2],l=t[3],d=t[4],h=t[5],u=t[6],c=t[7];t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*r+d*n,e[1]=s*r+h*n,e[2]=a*r+u*n,e[3]=l*r+c*n,e[4]=d*r-o*n,e[5]=h*r-s*n,e[6]=u*r-a*n,e[7]=c*r-l*n}(this.mMMatrix,this.mMMatrix,o),a(this.mMVPMatrix,this.mVMatrix,this.mMMatrix),a(this.mMVPMatrix,this.mProjMatrix,this.mMVPMatrix)}drawScene(){this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height),this.gl.clearColor(0,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)}tick(){requestAnimationFrame(this.m_boundTick),this.resizeCanvas(),this.drawScene(),this.animate()}initGL(e){const t=e.getContext("webgl",{alpha:!1});if(null===t)throw new Error("Cannot initialize WebGL context");return t}initGL2(e){let t=e.getContext("webgl2",{alpha:!1});return null===t?(console.warn("Could not initialise WebGL 2, falling back to WebGL 1"),this.initGL(e)):t}generateMipmaps(...e){for(const t of e)this.gl.bindTexture(this.gl.TEXTURE_2D,t),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR_MIPMAP_LINEAR),this.gl.generateMipmap(this.gl.TEXTURE_2D)}init(e,t=!1){if(this.onBeforeInit(),this.canvas=document.getElementById(e),null===this.canvas)throw new Error("Cannot find canvas element");this.viewportWidth=this.canvas.width,this.viewportHeight=this.canvas.height,this.m_gl=t?this.initGL2(this.canvas):this.initGL(this.canvas),this.m_gl?(this.resizeCanvas(),this.onAfterInit(),this.initShaders(),this.loadData(),this.m_boundTick()):this.onInitError()}resizeCanvas(){if(void 0===this.canvas)return;const e=window.devicePixelRatio||1,t=Math.floor(this.canvas.clientWidth*e),i=Math.floor(this.canvas.clientHeight*e);this.canvas.width==t&&this.canvas.height==i||(this.canvas.width=t,this.canvas.height=i)}checkGlError(e){let t;for(;(t=this.gl.getError())!==this.gl.NO_ERROR;)console.error(`${e}: glError ${t}`)}unbindBuffers(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,null)}getMVPMatrix(){return this.mMVPMatrix}getOrthoMatrix(){return this.matOrtho}getModelMatrix(){return this.mMMatrix}getViewMatrix(){return this.mVMatrix}}{constructor(){super(),this.lastTime=0,this.angleYaw=0,this.loaded=!1,this.fmSky=new n,this.fmGrassPatch=new n,this.fmDust=new n,this.fmAnt=new n,this.fmGroundFading=new n,this.fmRoundGrass=new n,this.fmButterfly=new n,this.fmDandelion0Leaves=new n,this.fmDandelion0Petals=new n,this.fmDandelion0Stem=new n,this.fmSphere=new n,this.noTextures=!1,this.noGlare=!1,this.vec3Temp=[0,0,0],this.textureGrass1Positions=null,this.textureGrass2Positions=null,this.textureFlowersPositions=null,this.Z_NEAR=10,this.Z_FAR=1500,this.timerAnts=0,this.ANTS_PERIOD=18e3,this.timerGrassWind=0,this.WIND_PERIOD=5e3,this.timerButterfly=0,this.BUTTERFLY_PERIOD=5e3,this.timerButterflyAnimation=0,this.BUTTERFLY_ANIMATION_PERIOD=350,this.WIND_STIFFNESS=2,this.WIND_HEIGHT_COEFF=.06,this.WIND_OFFSET=11,this.GRASS_PATCH_SCALE=28,this.DANDELION_SCALE=39,this.FLOWERS_SCALE=[2.2/this.DANDELION_SCALE,.5/this.DANDELION_SCALE],this.ROUND_GRASS_SCALE=[2.2/122,.5/122],this.GRASS1_COUNT=339,this.GRASS2_COUNT=157,this.FLOWERS_COUNT=15,this.ANTS_SCALE=.005,this.ANTS_COUNT=34,this.ANTS_SPREAD=75,this.ANTS_RADIUS=[50,30],this.BUTTERFLIES_SCALE=.06,this.BUTTERFLIES_COUNT=4,this.BUTTERFLIES_SPREAD=80,this.BUTTERFLIES_RADIUS=[50,30],this.BUTTERFLIES_SIZE_X=74,this.BUTTERFLIES_ANIMATION_AMPLITUDE=60,this.BUTTERFLIES_FLIGHT_Z_AMPLITUDE=50,this.currentPreset=0,this.PRESETS=[{name:"Day",glareColor:[105/255,105/255,45/255],glareBrightness:.8,glareExponent:2.5,lightDir:F(this.vec3Temp,[1,1,1]),flowerColor:[1,1,1],flowerColorBrightness:1,lightDiffuse:[1,1,1],lightDiffuseBrightness:1,lightAmbient:[128/255,128/255,160/255],lightAmbientBrightness:1,lightDiffuseGrass:[1,1,1],lightDiffuseGrassBrightness:1,lightAmbientGrass:[95/255,126/255,82/255],lightAmbientGrassBrightness:1,diffuseCoeff:1,grassSpecularColor:[1,1,1],grassSpecularColorBrightness:1,grassSpecularPower:4,grassSpecularStrength:.66,roundGrassSpecularColor:[1,1,1],roundGrassSpecularPower:4,roundGrassSpecularStrength:.1,stemSpecularColor:[1,1,1],stemSpecularColorBrightness:1,stemSpecularPower:1,stemSpecularStrength:.2,leavesSpecularColor:[1,1,1],leavesSpecularColorBrightness:1,leavesSpecularPower:4,leavesSpecularStrength:1,groundColor:[1,1,1],groundColorBrightness:1,drawAnts:!0,antsColor:[1,1,1],antsColorBrightness:1,skyTexture:"sky-half.webp",skyColor:[1,1,1],skyColorBrightness:1,drawButterflies:!0},{name:"Sunset",glareColor:[241/255,133/255,0],glareBrightness:.85,glareExponent:22.5,lightDir:F(this.vec3Temp,[-1,-1,.3]),flowerColor:[1,200/255,180/255],flowerColorBrightness:.35,lightDiffuse:[1,180/255,120/255],lightDiffuseBrightness:.35,lightAmbient:[110/255,90/255,144/255],lightAmbientBrightness:.45,lightDiffuseGrass:[225/255,132/255,64/255],lightDiffuseGrassBrightness:.45,lightAmbientGrass:[100/255,100/255,168/255],lightAmbientGrassBrightness:.4,diffuseCoeff:1,grassSpecularColor:[1,88/255,0],grassSpecularColorBrightness:.45,grassSpecularPower:4,grassSpecularStrength:.66,roundGrassSpecularColor:[1,88/255,0],roundGrassSpecularPower:4,roundGrassSpecularStrength:.1,stemSpecularColor:[1,88/255,0],stemSpecularColorBrightness:.45,stemSpecularPower:1,stemSpecularStrength:.2,leavesSpecularColor:[1,160/255,88/255],leavesSpecularColorBrightness:.45,leavesSpecularPower:4,leavesSpecularStrength:1,groundColor:[1,1,1],groundColorBrightness:.35,drawAnts:!0,antsColor:[1,180/255,120/255],antsColorBrightness:.4,skyTexture:"sky-sunset.webp",skyColor:[1,1,1],skyColorBrightness:1},{name:"Night",glareColor:[241/255,133/255,0],glareBrightness:.85,glareExponent:22.5,noGlare:!0,lightDir:F(this.vec3Temp,[-1,-1,.3]),flowerColor:[180/255,180/255,200/255],flowerColorBrightness:.3,lightDiffuse:[123/255,120/255,1],lightDiffuseBrightness:.33,lightAmbient:[60/255,77/255,144/255],lightAmbientBrightness:.33,lightDiffuseGrass:[140/255,140/255,1],lightDiffuseGrassBrightness:.35,lightAmbientGrass:[95/255,80/255,182/255],lightAmbientGrassBrightness:.3,diffuseCoeff:1,grassSpecularColor:[1,200/255,180/255],grassSpecularColorBrightness:.3,grassSpecularPower:4,grassSpecularStrength:.66,roundGrassSpecularColor:[1,1,1],roundGrassSpecularPower:4,roundGrassSpecularStrength:.1,stemSpecularColor:[1,185/255,155/255],stemSpecularColorBrightness:.3,stemSpecularPower:1,stemSpecularStrength:.2,leavesSpecularColor:[1,1,1],leavesSpecularColorBrightness:.3,leavesSpecularPower:4,leavesSpecularStrength:1,groundColor:[1,1,1],groundColorBrightness:.4,drawAnts:!1,antsColor:[1,1,1],antsColorBrightness:1,skyTexture:"sky-half.webp",skyColor:[80/255,92/255,138/255],skyColorBrightness:.3},{name:"Sunrise",glareColor:[1,70/255,0],glareBrightness:.7,glareExponent:22.5,lightDir:F(this.vec3Temp,[-1,-1,.3]),flowerColor:[1,144/255,111/255],flowerColorBrightness:.35,lightDiffuse:[1,160/255,100/255],lightDiffuseBrightness:.4,lightAmbient:[110/255,90/255,144/255],lightAmbientBrightness:.45,lightDiffuseGrass:[1,122/255,55/255],lightDiffuseGrassBrightness:.45,lightAmbientGrass:[144/255,90/255,90/255],lightAmbientGrassBrightness:.4,diffuseCoeff:1,grassSpecularColor:[1,55/255,11/255],grassSpecularColorBrightness:.45,grassSpecularPower:4,grassSpecularStrength:.66,roundGrassSpecularColor:[1,88/255,0],roundGrassSpecularPower:4,roundGrassSpecularStrength:.1,stemSpecularColor:[1,88/255,0],stemSpecularColorBrightness:.45,stemSpecularPower:1,stemSpecularStrength:.2,leavesSpecularColor:[1,160/255,88/255],leavesSpecularColorBrightness:.45,leavesSpecularPower:4,leavesSpecularStrength:1,groundColor:[1,1,1],groundColorBrightness:.35,drawAnts:!0,antsColor:[1,180/255,120/255],antsColorBrightness:.4,skyTexture:"sky-sunset.webp",skyColor:[1,150/255,150/255],skyColorBrightness:1}],this.cameraMode=L.Random,this.currentRandomCamera=0,this.matViewInverted=w(),this.matViewInvertedTransposed=w(),this.matTemp=w(),this.cameraPosition=N(),this.cameraRotation=N(),this.CAMERAS=[{start:{position:new Float32Array([193.48460388183594,-161.2293701171875,26.288768768310547]),rotation:new Float32Array([-.006000004708766937,5.191177845001221,0])},end:{position:new Float32Array([138.8173828125,178.6765594482422,31.021570205688477]),rotation:new Float32Array([-2.7418136649970393e-9,3.949169158935547,0])},speedMultiplier:1},{start:{position:new Float32Array([105.49623107910156,57.43907165527344,71.68569946289062]),rotation:new Float32Array([.5879998803138733,4.345171928405762,0])},end:{position:new Float32Array([42.728511810302734,-90.01109313964844,74.52281188964844]),rotation:new Float32Array([.48600009083747864,6.04318380355835,0])},speedMultiplier:1},{start:{position:new Float32Array([-67.54290008544922,-33.61400604248047,63.343177795410156]),rotation:new Float32Array([.4320005774497986,.9239993691444397,0])},end:{position:new Float32Array([44.3769645690918,70.59022521972656,69.28772735595703]),rotation:new Float32Array([.6060004234313965,3.9420197010040283,0])},speedMultiplier:1},{start:{position:new Float32Array([38.70161819458008,30.623598098754883,29.440074920654297]),rotation:new Float32Array([.14999987185001373,4.212021350860596,0])},end:{position:new Float32Array([5.7086896896362305,98.68388366699219,23.767621994018555]),rotation:new Float32Array([.023999907076358795,2.8620119094848633,0])},speedMultiplier:1},{start:{position:new Float32Array([126.77375793457031,82.41195678710938,64.88525390625]),rotation:new Float32Array([.5220004320144653,4.009169578552246,0])},end:{position:new Float32Array([121.06608581542969,111.07565307617188,25.369491577148438]),rotation:new Float32Array([.01200005691498518,4.5131731033325195,0])},speedMultiplier:1},{start:{position:new Float32Array([122.68425750732422,6.09023904800415,26.537200927734375]),rotation:new Float32Array([.03599995747208595,3.996018886566162,0])},end:{position:new Float32Array([101.9842529296875,74.69181823730469,20.949016571044922]),rotation:new Float32Array([-.024000033736228943,4.95002555847168,0])},speedMultiplier:1},{start:{position:new Float32Array([129.5026092529297,142.1769256591797,24.73994255065918]),rotation:new Float32Array([-1.778304579147516e-7,3.6180028915405273,0])},end:{position:new Float32Array([-97.36258697509766,173.8473358154297,21.665822982788086]),rotation:new Float32Array([-.012000122107565403,2.622001886367798,0])},speedMultiplier:1},{start:{position:new Float32Array([75.2061996459961,75.03823852539062,185.00991821289062]),rotation:new Float32Array([1.0079998970031738,3.755999803543091,0])},end:{position:new Float32Array([-29.02829933166504,42.7842903137207,189.60440063476562]),rotation:new Float32Array([1.0920006036758423,2.387998580932617,0])},speedMultiplier:1},{start:{position:new Float32Array([103.99015808105469,74.62678527832031,156.29510498046875]),rotation:new Float32Array([.9899996519088745,4.032003879547119,0])},end:{position:new Float32Array([-178.87892150878906,-5.985522747039795,177.8407440185547]),rotation:new Float32Array([.959999680519104,1.6260037422180176,0])},speedMultiplier:1},{start:{position:new Float32Array([60.910362243652344,119.53804016113281,81.02588653564453]),rotation:new Float32Array([.8939999341964722,3.4200048446655273,0])},end:{position:new Float32Array([-182.57057189941406,34.927425384521484,183.38380432128906]),rotation:new Float32Array([.9479997754096985,1.9920008182525635,0])},speedMultiplier:1},{start:{position:new Float32Array([7.54575777053833,107.43892669677734,124.10911560058594]),rotation:new Float32Array([1.0620001554489136,2.736001968383789,0])},end:{position:new Float32Array([-107.07096862792969,-121.59932708740234,155.70933532714844]),rotation:new Float32Array([.8699998259544373,.9540011286735535,0])},speedMultiplier:1},{start:{position:new Float32Array([80.27741241455078,171.7574920654297,68.77640533447266]),rotation:new Float32Array([.7019999027252197,3.210000514984131,0])},end:{position:new Float32Array([-140.18307495117188,-137.1750030517578,65.08952331542969]),rotation:new Float32Array([.4560002386569977,1.1220002174377441,0])},speedMultiplier:1},{start:{position:new Float32Array([50.706085205078125,86.05104064941406,102.37602233886719]),rotation:new Float32Array([.8219998478889465,2.8080010414123535,0])},end:{position:new Float32Array([-5.94230842590332,-62.32189178466797,75.14812469482422]),rotation:new Float32Array([.7379996180534363,4.704004764556885,0])},speedMultiplier:1},{start:{position:new Float32Array([-141.20269775390625,27.679370880126953,218.7299041748047]),rotation:new Float32Array([1.2060006856918335,1.6259998083114624,0])},end:{position:new Float32Array([67.05718231201172,-151.7519073486328,125.82315063476562]),rotation:new Float32Array([.9900000095367432,.2279992401599884,0])},speedMultiplier:1},{start:{position:new Float32Array([-145.80145263671875,114.13640594482422,22.470090866088867]),rotation:new Float32Array([-.024000030010938644,1.9740006923675537,0])},end:{position:new Float32Array([-123.3978500366211,-117.26119995117188,15.269742965698242]),rotation:new Float32Array([.01799994334578514,1.175997257232666,0])},speedMultiplier:1}],this.CAMERA_SPEED=.01,this.CAMERA_MIN_DURATION=8e3,this.useRandomCamera=!0,this.cameraPositionInterpolator=new G,this.grassDensity=1,this.drawInsects=!0,this.visibleTiles=0,this.visibleGrassInstances=0,this.bboxVisibility=new xe(this),this.cameraPositionInterpolator.speed=this.CAMERA_SPEED,this.cameraPositionInterpolator.minDuration=this.CAMERA_MIN_DURATION,this.randomizeCamera()}setCustomCamera(e,t,i){this.customCamera=e,void 0!==t&&(this.cameraPosition=t),void 0!==i&&(this.cameraRotation=i)}resetCustomCamera(){this.customCamera=void 0}onBeforeInit(){}onAfterInit(){}onInitError(){}initShaders(){this.shaderVertexLit=new z(this.gl),this.shaderVertexLitInstancedVegetation=new $(this.gl),this.shaderVertexLitInstancedVegetationFading=new K(this.gl),this.shaderVertexLitInstancedGrass=new Z(this.gl),this.shaderVertexLitInstancedGrassAnimated=new J(this.gl),this.shaderVertexLitInstancedGrassAt=new q(this.gl),this.shaderVertexLitInstancedGrassFading=new Q(this.gl),this.shaderInstancedVegetation=new Y(this.gl),this.shaderGlare=new ee(this.gl),this.shaderInstancedTexturePositionsColored=new ne(this.gl),this.shaderVertexLitInstancedTexturePositions=new re(this.gl),this.shaderInstancedTexturePositionsGrass=new oe(this.gl),this.shaderInstancedTexturePositionsGrassAt=new ae(this.gl),this.shaderInstancedTexturePositionsGrassAnimated=new se(this.gl),this.shaderAnts=new le(this.gl),this.shaderButterfly=new de(this.gl),this.shaderDiffuse=new E(this.gl),this.shaderDiffuseAnimatedTexture=new V(this.gl),this.shaderDiffuseAnimatedTextureChunked=new k(this.gl),this.shaderDiffuseColored=new U(this.gl),this.shaderDiffuseColoredVertexAlpha=new te(this.gl)}async loadFloatingPointTexture(e,t,i,n,r=t.LINEAR,o=t.LINEAR,s=!1,a=3){const l=t.createTexture();if(null===l)throw new Error("Error creating WebGL texture");let d=t.RGB16F,h=t.RGB;2===a?(d=t.RG16F,h=t.RG):1===a?(d=t.R16F,h=t.RED):4===a&&(d=t.RGBA16F,h=t.RGBA);const u=await fetch(e),c=await u.arrayBuffer(),m=new Uint16Array(c);return t.bindTexture(t.TEXTURE_2D,l),this.checkGlError("loadFloatingPointTexture 0"),t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.texImage2D(t.TEXTURE_2D,0,d,i,n,0,h,t.HALF_FLOAT,m),this.checkGlError("loadFloatingPointTexture 1"),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,o),!0===s?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT)),this.checkGlError("loadFloatingPointTexture 2"),t.bindTexture(t.TEXTURE_2D,null),console.log(`Loaded texture ${e} [${i}x${n}]`),l}loadFp32Texture(e,t,i,n,r=t.LINEAR,o=t.LINEAR,s=!1,a=3){const l=t.createTexture();if(null===l)throw new Error("Error creating WebGL texture");let d=t.RGB32F,h=t.RGB;2===a?(d=t.RG32F,h=t.RG):1===a?(d=t.R32F,h=t.RED):4===a&&(d=t.RGBA32F,h=t.RGBA);const u=new Float32Array(e);return t.bindTexture(t.TEXTURE_2D,l),this.checkGlError("loadFp32Texture 0"),t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.texImage2D(t.TEXTURE_2D,0,d,i,n,0,h,t.FLOAT,u),this.checkGlError("loadFp32Texture 1"),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,o),!0===s?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT)),this.checkGlError("loadFp32Texture 2"),t.bindTexture(t.TEXTURE_2D,null),l}async loadData(){var e;const t=this.PRESETS[this.currentPreset];await Promise.all([this.fmSky.load("data/models/sky-half",this.gl),this.fmGrassPatch.load("data/models/grass_twosided2",this.gl),this.fmDust.load("data/models/particles_20",this.gl),this.fmDandelion0Leaves.load("data/models/dandelion0_leaves",this.gl),this.fmDandelion0Stem.load("data/models/dandelion0_stem",this.gl),this.fmDandelion0Petals.load("data/models/dandelion0_petals",this.gl),this.fmAnt.load("data/models/ant",this.gl),this.fmGroundFading.load("data/models/ground-vntao",this.gl),this.fmSphere.load("data/models/sphere10",this.gl),this.fmRoundGrass.load("data/models/small-grass2",this.gl),this.fmButterfly.load("data/models/butterfly",this.gl)]),[this.textureDandelionStem,this.textureDandelionLeavesDiffuse,this.textureDandelionPetals,this.textureGround,this.textureRoundGrass,this.textureWhite,this.textureAnt,this.textureButterfly,this.textureGrass1Positions,this.textureGrass2Positions,this.textureFlowersPositions,this.textureSky,this.textureGrass]=await Promise.all([i.load("data/textures/stem.webp",this.gl,void 0,void 0,!0),i.load("data/textures/leaves.webp",this.gl,void 0,void 0,!1),i.load("data/textures/petal.webp",this.gl,void 0,void 0,!0),i.load("data/textures/ground.webp",this.gl,void 0,void 0,!1),i.load("data/textures/round-grass2.webp",this.gl,void 0,void 0,!0),i.load("data/textures/white.webp",this.gl,void 0,void 0,!0),i.load("data/textures/ant.webp",this.gl,void 0,void 0,!0),i.load("data/textures/butterfly-all.webp",this.gl,void 0,void 0,!0),this.loadFp32Texture(ve.textureData,this.gl,this.GRASS1_COUNT,2,this.gl.NEAREST,this.gl.NEAREST,!0,3),this.loadFp32Texture(ge.textureData,this.gl,this.GRASS2_COUNT,2,this.gl.NEAREST,this.gl.NEAREST,!0,3),this.loadFp32Texture(_e.textureData,this.gl,this.FLOWERS_COUNT,2,this.gl.NEAREST,this.gl.NEAREST,!0,3),i.load(`data/textures/${t.skyTexture}`,this.gl,void 0,void 0,!0),i.load(this.noTextures?"data/textures/white.webp":"data/textures/grass.webp",this.gl,void 0,void 0,!1)]),this.generateMipmaps(this.textureDandelionStem,this.textureDandelionLeavesDiffuse,this.textureDandelionPetals,this.textureGround,this.textureRoundGrass),this.loaded=!0,console.log("Loaded all assets"),null===(e=this.readyCallback)||void 0===e||e.call(this)}animate(){const e=(new Date).getTime();if(0!=this.lastTime){const t=e-this.lastTime;this.angleYaw+=t/220,this.angleYaw%=360,this.timerAnts=e%this.ANTS_PERIOD/this.ANTS_PERIOD,this.timerGrassWind=e%this.WIND_PERIOD/this.WIND_PERIOD,this.timerButterfly=e%this.BUTTERFLY_PERIOD/this.BUTTERFLY_PERIOD,this.timerButterflyAnimation=e%this.BUTTERFLY_ANIMATION_PERIOD/this.BUTTERFLY_ANIMATION_PERIOD,this.cameraPositionInterpolator.iterate(e),this.useRandomCamera?this.cameraMode===L.Random&&void 0===this.customCamera&&1===this.cameraPositionInterpolator.timer&&this.randomizeCamera():1===this.cameraPositionInterpolator.timer&&this.cameraPositionInterpolator.reset()}this.lastTime=e}setCameraFOV(e){var t;t=this.gl.canvas.height>0?this.gl.canvas.width/this.gl.canvas.height:1;let i=0;i=this.gl.canvas.width>=this.gl.canvas.height?20*e:30*e,this.setFOV(this.mProjMatrix,i,t,this.Z_NEAR,this.Z_FAR)}positionCamera(e){if(void 0===this.customCamera)if(this.cameraMode===L.Random)this.mVMatrix=this.cameraPositionInterpolator.matrix,this.cameraPosition[0]=this.cameraPositionInterpolator.cameraPosition[0],this.cameraPosition[1]=this.cameraPositionInterpolator.cameraPosition[1],this.cameraPosition[2]=this.cameraPositionInterpolator.cameraPosition[2];else{const e=this.angleYaw/360*Math.PI*2,t=Math.sin(e),i=Math.cos(e),n=Math.cos(2*e);this.cameraPosition[0]=77*t+29,this.cameraPosition[1]=77*i-11,this.cameraPosition[2]=40+20*n,function(e,t,i,n){var r,o,s,a,l,d,h,u,c,m,f=t[0],_=t[1],v=t[2],g=n[0],x=n[1],p=n[2],A=i[0],T=i[1],b=i[2];Math.abs(f-A)<1e-6&&Math.abs(_-T)<1e-6&&Math.abs(v-b)<1e-6?y(e):(h=f-A,u=_-T,c=v-b,r=x*(c*=m=1/Math.hypot(h,u,c))-p*(u*=m),o=p*(h*=m)-g*c,s=g*u-x*h,(m=Math.hypot(r,o,s))?(r*=m=1/m,o*=m,s*=m):(r=0,o=0,s=0),a=u*s-c*o,l=c*r-h*s,d=h*o-u*r,(m=Math.hypot(a,l,d))?(a*=m=1/m,l*=m,d*=m):(a=0,l=0,d=0),e[0]=r,e[1]=a,e[2]=h,e[3]=0,e[4]=o,e[5]=l,e[6]=u,e[7]=0,e[8]=s,e[9]=d,e[10]=c,e[11]=0,e[12]=-(r*f+o*_+s*v),e[13]=-(a*f+l*_+d*v),e[14]=-(h*f+u*_+c*v),e[15]=1)}(this.mVMatrix,this.cameraPosition,[29,-11,20],[0,0,1])}else this.mVMatrix=this.customCamera}drawScene(){this.loaded&&(this.positionCamera(0),this.setCameraFOV(1),this.gl.clearColor(1,1,1,1),this.gl.enable(this.gl.DEPTH_TEST),this.gl.enable(this.gl.CULL_FACE),this.gl.cullFace(this.gl.BACK),this.positionCamera(0),this.setCameraFOV(1),this.gl.colorMask(!0,!0,!0,!0),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),_e.cull(this.bboxVisibility),this.drawSceneObjects())}drawSceneObjects(){var e,t;if(void 0===this.shaderDiffuse||void 0===this.shaderDiffuseAnimatedTexture||void 0===this.shaderDiffuseAnimatedTextureChunked||void 0===this.shaderDiffuseColored||void 0===this.shaderVertexLit||void 0===this.shaderVertexLitInstancedVegetation||void 0===this.shaderVertexLitInstancedVegetationFading||void 0===this.shaderVertexLitInstancedGrass||void 0===this.shaderVertexLitInstancedGrassAnimated||void 0===this.shaderVertexLitInstancedGrassAt||void 0===this.shaderVertexLitInstancedGrassFading||void 0===this.shaderInstancedVegetation||void 0===this.shaderGlare||void 0===this.shaderDiffuseColoredVertexAlpha||void 0===this.shaderInstancedTexturePositionsColored||void 0===this.shaderVertexLitInstancedTexturePositions||void 0===this.shaderInstancedTexturePositionsGrass||void 0===this.shaderInstancedTexturePositionsGrassAt||void 0===this.shaderInstancedTexturePositionsGrassAnimated||void 0===this.shaderAnts||void 0===this.shaderButterfly)return void console.log("undefined shaders");const i=this.PRESETS[this.currentPreset];this.gl.cullFace(this.gl.BACK),this.gl.disable(this.gl.BLEND),this.drawInsects&&this.drawButterflies(),this.drawGrass(this.grassDensity),this.drawInsects&&this.drawAnts(),this.shaderDiffuse.use(),this.drawSkyObject(),this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.shaderDiffuseColoredVertexAlpha.use(),this.setTexture2D(0,this.textureGround,this.shaderDiffuseColoredVertexAlpha.sTexture),null===(e=this.shaderDiffuseColoredVertexAlpha)||void 0===e||e.setColor(i.groundColor[0]*i.groundColorBrightness,i.groundColor[1]*i.groundColorBrightness,i.groundColor[2]*i.groundColorBrightness,1),this.shaderDiffuseColoredVertexAlpha.drawModel(this,this.fmGroundFading,0,0,0,0,0,0,1.05,1.05,1.05),this.noGlare||i.noGlare||(this.gl.depthMask(!1),this.gl.cullFace(this.gl.FRONT),this.gl.disable(this.gl.DEPTH_TEST),this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.ONE,this.gl.ONE),null===(t=this.shaderGlare)||void 0===t||t.use(),this.gl.uniform4f(this.shaderGlare.lightDir,i.lightDir[0],i.lightDir[1],i.lightDir[2],0),this.gl.uniform1f(this.shaderGlare.glareExponent,i.glareExponent),this.gl.uniform4f(this.shaderGlare.glareColor,i.glareColor[0]*i.glareBrightness,i.glareColor[1]*i.glareBrightness,i.glareColor[2]*i.glareBrightness,1),this.shaderGlare.drawModel(this,this.fmSphere,0,0,0,0,0,0,32,32,32)),this.gl.depthMask(!0),this.gl.cullFace(this.gl.BACK),this.gl.enable(this.gl.DEPTH_TEST),this.gl.disable(this.gl.BLEND)}drawButterflies(){if(void 0===this.shaderButterfly)return void console.log("undefined shaders");this.PRESETS[this.currentPreset].drawButterflies&&(this.gl.disable(this.gl.CULL_FACE),this.shaderButterfly.use(),this.gl.uniform2f(this.shaderButterfly.uSpread,this.BUTTERFLIES_SPREAD/this.BUTTERFLIES_SCALE,this.BUTTERFLIES_SPREAD/this.BUTTERFLIES_SCALE),this.gl.uniform2f(this.shaderButterfly.uRadius,this.BUTTERFLIES_RADIUS[0]/this.BUTTERFLIES_SCALE,this.BUTTERFLIES_RADIUS[1]/this.BUTTERFLIES_SCALE),this.gl.uniform4f(this.shaderButterfly.uButterflyParams,this.BUTTERFLIES_SIZE_X,this.BUTTERFLIES_ANIMATION_AMPLITUDE,this.BUTTERFLIES_FLIGHT_Z_AMPLITUDE,.25),this.setTexture2D(0,this.textureButterfly,this.shaderButterfly.sTexture),this.gl.uniform1f(this.shaderButterfly.uAnimationTime,2*Math.PI*this.timerButterflyAnimation),this.gl.uniform1f(this.shaderButterfly.uTime,2*Math.PI*this.timerButterfly),this.gl.uniform1f(this.shaderButterfly.uRotation,-1.57079632679),this.shaderButterfly.drawInstanced(this,this.fmButterfly,-5,0,40,0,0,0,this.BUTTERFLIES_SCALE,this.BUTTERFLIES_SCALE,this.BUTTERFLIES_SCALE,this.BUTTERFLIES_COUNT),this.gl.uniform1f(this.shaderButterfly.uTime,2*Math.PI*(1-this.timerButterfly)),this.gl.uniform1f(this.shaderButterfly.uRotation,1.57079632679),this.shaderButterfly.drawInstanced(this,this.fmButterfly,0,5,50,0,0,0,this.BUTTERFLIES_SCALE,this.BUTTERFLIES_SCALE,this.BUTTERFLIES_SCALE,this.BUTTERFLIES_COUNT),this.gl.enable(this.gl.CULL_FACE))}drawAnts(){var e;if(void 0===this.shaderAnts)return void console.log("undefined shaders");const t=this.PRESETS[this.currentPreset];t.drawAnts&&(null===(e=this.shaderAnts)||void 0===e||e.use(),this.setTexture2D(1,this.textureAnt,this.shaderAnts.sTexture),this.gl.uniform2f(this.shaderAnts.uSpread,this.ANTS_SPREAD/this.ANTS_SCALE,this.ANTS_SPREAD/this.ANTS_SCALE),this.gl.uniform2f(this.shaderAnts.uRadius,this.ANTS_RADIUS[0]/this.ANTS_SCALE,this.ANTS_RADIUS[1]/this.ANTS_SCALE),this.shaderAnts.setColor(t.antsColor[0]*t.antsColorBrightness,t.antsColor[1]*t.antsColorBrightness,t.antsColor[2]*t.antsColorBrightness,1),this.gl.uniform1f(this.shaderAnts.uTime,2*Math.PI*this.timerAnts),this.gl.uniform1f(this.shaderAnts.uRotation,-1.57079632679),this.shaderAnts.drawInstanced(this,this.fmAnt,0,0,.1,0,0,0,this.ANTS_SCALE,this.ANTS_SCALE,this.ANTS_SCALE,this.ANTS_COUNT),this.gl.uniform1f(this.shaderAnts.uTime,2*Math.PI*(1-this.timerAnts)),this.gl.uniform1f(this.shaderAnts.uRotation,1.57079632679),this.shaderAnts.drawInstanced(this,this.fmAnt,0,0,.1,0,0,0,this.ANTS_SCALE,this.ANTS_SCALE,this.ANTS_SCALE,this.ANTS_COUNT))}drawGrass(e){var t;if(void 0===this.shaderInstancedTexturePositionsColored||void 0===this.shaderInstancedTexturePositionsGrass||void 0===this.shaderInstancedTexturePositionsGrassAt||void 0===this.shaderInstancedTexturePositionsGrassAnimated)return void console.log("undefined shaders");const i=this.PRESETS[this.currentPreset];this.gl.disable(this.gl.CULL_FACE),null===(t=this.shaderInstancedTexturePositionsColored)||void 0===t||t.use(),this.setTexture2D(0,this.textureFlowersPositions,this.shaderInstancedTexturePositionsColored.sPositions),this.setTexture2D(1,this.noTextures?this.textureWhite:this.textureDandelionPetals,this.shaderInstancedTexturePositionsColored.sTexture),this.gl.uniform4f(this.shaderInstancedTexturePositionsColored.color,i.flowerColor[0]*i.flowerColorBrightness,i.flowerColor[1]*i.flowerColorBrightness,i.flowerColor[2]*i.flowerColorBrightness,1),this.gl.uniform2fv(this.shaderInstancedTexturePositionsColored.uScale,this.FLOWERS_SCALE),_e.drawTiles(this.shaderInstancedTexturePositionsColored,this.fmDandelion0Petals,this,1),this.gl.enable(this.gl.CULL_FACE),this.gl.cullFace(this.gl.BACK),this.setTexture2D(0,this.textureGrass2Positions,this.shaderInstancedTexturePositionsColored.sPositions),this.setTexture2D(1,this.noTextures?this.textureWhite:this.textureRoundGrass,this.shaderInstancedTexturePositionsColored.sTexture),this.gl.uniform2fv(this.shaderInstancedTexturePositionsColored.uScale,this.ROUND_GRASS_SCALE),ge.drawTiles(this.shaderInstancedTexturePositionsColored,this.fmRoundGrass,this,e),this.shaderInstancedTexturePositionsGrassAnimated.use(),this.setTexture2D(0,this.textureGrass1Positions,this.shaderInstancedTexturePositionsGrassAnimated.sPositions),this.setTexture2D(1,this.noTextures?this.textureWhite:this.textureGrass,this.shaderInstancedTexturePositionsGrassAnimated.sTexture),this.gl.uniform4f(this.shaderInstancedTexturePositionsGrassAnimated.lightDir,i.lightDir[0],i.lightDir[1],i.lightDir[2],0),this.gl.uniform1f(this.shaderInstancedTexturePositionsGrassAnimated.diffuseCoef,i.diffuseCoeff),this.gl.uniform1f(this.shaderInstancedTexturePositionsGrassAnimated.diffuseExponent,1),this.gl.uniform2f(this.shaderInstancedTexturePositionsGrassAnimated.uScale,.9/this.GRASS_PATCH_SCALE,.8/this.GRASS_PATCH_SCALE),this.gl.uniform2f(this.shaderInstancedTexturePositionsGrassAnimated.uTime,Math.sin(this.timerGrassWind*Math.PI*2),Math.cos(this.timerGrassWind*Math.PI*2)),this.gl.uniform3f(this.shaderInstancedTexturePositionsGrassAnimated.viewPos,this.cameraPosition[0],this.cameraPosition[1],this.cameraPosition[2]),this.gl.uniform4f(this.shaderInstancedTexturePositionsGrassAnimated.uSpecularColor,i.grassSpecularColor[0]*i.grassSpecularColorBrightness,i.grassSpecularColor[1]*i.grassSpecularColorBrightness,i.grassSpecularColor[2]*i.grassSpecularColorBrightness,1),this.gl.uniform1f(this.shaderInstancedTexturePositionsGrassAnimated.uSpecularPower,i.grassSpecularPower),this.gl.uniform1f(this.shaderInstancedTexturePositionsGrassAnimated.uSpecularStrength,i.grassSpecularStrength),this.gl.uniform4f(this.shaderInstancedTexturePositionsGrassAnimated.ambient,i.lightAmbientGrass[0]*i.lightAmbientGrassBrightness,i.lightAmbientGrass[1]*i.lightAmbientGrassBrightness,i.lightAmbientGrass[2]*i.lightAmbientGrassBrightness,0),this.gl.uniform4f(this.shaderInstancedTexturePositionsGrassAnimated.diffuse,i.lightDiffuseGrass[0]*i.lightDiffuseGrassBrightness,i.lightDiffuseGrass[1]*i.lightDiffuseGrassBrightness,i.lightDiffuseGrass[2]*i.lightDiffuseGrassBrightness,0),this.gl.uniform1f(this.shaderInstancedTexturePositionsGrassAnimated.stiffness,this.WIND_STIFFNESS),this.gl.uniform1f(this.shaderInstancedTexturePositionsGrassAnimated.heightCoeff,this.WIND_HEIGHT_COEFF/this.GRASS_PATCH_SCALE),this.gl.uniform1f(this.shaderInstancedTexturePositionsGrassAnimated.windOffset,this.WIND_OFFSET),ve.drawTiles(this.shaderInstancedTexturePositionsGrassAnimated,this.fmGrassPatch,this,e),this.shaderInstancedTexturePositionsGrass.use(),this.gl.uniform4f(this.shaderInstancedTexturePositionsGrass.lightDir,-i.lightDir[0],-i.lightDir[1],-i.lightDir[2],0),this.gl.uniform1f(this.shaderInstancedTexturePositionsGrass.diffuseCoef,i.diffuseCoeff),this.gl.uniform1f(this.shaderInstancedTexturePositionsGrass.diffuseExponent,1),this.gl.uniform3f(this.shaderInstancedTexturePositionsGrass.viewPos,this.cameraPosition[0],this.cameraPosition[1],this.cameraPosition[2]),this.setTexture2D(0,this.textureFlowersPositions,this.shaderInstancedTexturePositionsGrass.sPositions),this.setTexture2D(1,this.noTextures?this.textureWhite:this.textureDandelionStem,this.shaderInstancedTexturePositionsGrass.sTexture),this.gl.uniform4f(this.shaderInstancedTexturePositionsGrass.ambient,i.lightAmbient[0]*i.lightAmbientBrightness,i.lightAmbient[1]*i.lightAmbientBrightness,i.lightAmbient[2]*i.lightAmbientBrightness,0),this.gl.uniform4f(this.shaderInstancedTexturePositionsGrass.diffuse,i.lightDiffuse[0]*i.lightDiffuseBrightness,i.lightDiffuse[1]*i.lightDiffuseBrightness,i.lightDiffuse[2]*i.lightDiffuseBrightness,0),this.gl.uniform2fv(this.shaderInstancedTexturePositionsGrass.uScale,this.FLOWERS_SCALE),this.gl.uniform4f(this.shaderInstancedTexturePositionsGrass.uSpecularColor,i.stemSpecularColor[0]*i.stemSpecularColorBrightness,i.stemSpecularColor[1]*i.stemSpecularColorBrightness,i.stemSpecularColor[2]*i.stemSpecularColorBrightness,1),this.gl.uniform1f(this.shaderInstancedTexturePositionsGrass.uSpecularPower,i.stemSpecularPower),this.gl.uniform1f(this.shaderInstancedTexturePositionsGrass.uSpecularStrength,i.stemSpecularStrength),_e.drawTiles(this.shaderInstancedTexturePositionsGrass,this.fmDandelion0Stem,this,1),this.shaderInstancedTexturePositionsGrassAt.use(),this.setTexture2D(0,this.textureFlowersPositions,this.shaderInstancedTexturePositionsGrassAt.sPositions),this.setTexture2D(1,this.noTextures?this.textureWhite:this.textureDandelionLeavesDiffuse,this.shaderInstancedTexturePositionsGrassAt.sTexture),this.gl.uniform4f(this.shaderInstancedTexturePositionsGrassAt.lightDir,i.lightDir[0],i.lightDir[1],i.lightDir[2],0),this.gl.uniform4f(this.shaderInstancedTexturePositionsGrassAt.ambient,i.lightAmbient[0]*i.lightAmbientBrightness,i.lightAmbient[1]*i.lightAmbientBrightness,i.lightAmbient[2]*i.lightAmbientBrightness,0),this.gl.uniform4f(this.shaderInstancedTexturePositionsGrassAt.diffuse,i.lightDiffuse[0]*i.lightDiffuseBrightness,i.lightDiffuse[1]*i.lightDiffuseBrightness,i.lightDiffuse[2]*i.lightDiffuseBrightness,0),this.gl.uniform1f(this.shaderInstancedTexturePositionsGrassAt.diffuseCoef,i.diffuseCoeff),this.gl.uniform1f(this.shaderInstancedTexturePositionsGrassAt.diffuseExponent,1),this.gl.uniform2fv(this.shaderInstancedTexturePositionsGrassAt.uScale,this.FLOWERS_SCALE),this.gl.uniform3f(this.shaderInstancedTexturePositionsGrassAt.viewPos,this.cameraPosition[0],this.cameraPosition[1],this.cameraPosition[2]),this.gl.uniform4f(this.shaderInstancedTexturePositionsGrassAt.uSpecularColor,i.leavesSpecularColor[0]*i.leavesSpecularColorBrightness,i.leavesSpecularColor[1]*i.leavesSpecularColorBrightness,i.leavesSpecularColor[2]*i.leavesSpecularColorBrightness,1),this.gl.uniform1f(this.shaderInstancedTexturePositionsGrassAt.uSpecularPower,i.leavesSpecularPower),this.gl.uniform1f(this.shaderInstancedTexturePositionsGrassAt.uSpecularStrength,i.leavesSpecularStrength),_e.drawTiles(this.shaderInstancedTexturePositionsGrassAt,this.fmDandelion0Leaves,this,1),this.visibleTiles=0,this.visibleGrassInstances=0;for(let t=0;t<me.length;t++){const i=me[t];this.visibleTiles+=i?0:1,i||(this.visibleGrassInstances+=3*_e.tiles[t].instancesCount,this.visibleGrassInstances+=Math.round(ve.tiles[t].instancesCount*e),this.visibleGrassInstances+=Math.round(ge.tiles[t].instancesCount*e))}}drawSkyObject(){var e;if(void 0===this.shaderDiffuseColored)return;const t=this.PRESETS[this.currentPreset];this.shaderDiffuseColored.use(),null===(e=this.shaderDiffuseColored)||void 0===e||e.setColor(t.skyColor[0]*t.skyColorBrightness,t.skyColor[1]*t.skyColorBrightness,t.skyColor[2]*t.skyColorBrightness,1),this.setTexture2D(0,this.textureSky,this.shaderDiffuseColored.sTexture),this.shaderDiffuseColored.drawModel(this,this.fmSky,0,0,0,0,0,0,3,3,3)}randomizeCamera(){this.currentRandomCamera=(this.currentRandomCamera+1+Math.trunc(Math.random()*(this.CAMERAS.length-2)))%this.CAMERAS.length,this.cameraPositionInterpolator.speed=this.CAMERA_SPEED*this.CAMERAS[this.currentRandomCamera].speedMultiplier,this.cameraPositionInterpolator.position=this.CAMERAS[this.currentRandomCamera],this.cameraPositionInterpolator.reset()}iterateCamera(){this.useRandomCamera&&this.nextCamera(0),this.useRandomCamera=!1,this.nextCamera()}nextCamera(e){void 0!==e?this.currentRandomCamera=e:(this.currentRandomCamera++,this.currentRandomCamera%=this.CAMERAS.length),this.cameraPositionInterpolator.speed=this.CAMERA_SPEED*this.CAMERAS[this.currentRandomCamera].speedMultiplier,this.cameraPositionInterpolator.position=this.CAMERAS[this.currentRandomCamera],this.cameraPositionInterpolator.reset()}checkGlError(e){}set density(e){this.grassDensity=e}set timeOfDay(e){this.currentPreset=this.PRESETS.findIndex((t=>t.name===e)),(async()=>{const e=this.PRESETS[this.currentPreset],t=await i.load(`data/textures/${e.skyTexture}`,this.gl,void 0,void 0,!0);this.gl.deleteTexture(this.textureSky),this.textureSky=t})()}set glare(e){this.noGlare=!e}set insects(e){this.drawInsects=e}get tiles(){return this.visibleTiles}get grassInstances(){return this.visibleGrassInstances}set ready(e){this.readyCallback=e}}class Ae{constructor(e){var t,i;this._dirty=!0,this._angles=N(),this._position=N(),this.speed=100,this.rotationSpeed=.025,this._cameraMat=w(),this._viewMat=w(),this.projectionMat=w(),this.pressedKeys=new Array,this.canvas=e.canvas,this.speed=null!==(t=e.movementSpeed)&&void 0!==t?t:100,this.rotationSpeed=null!==(i=e.rotationSpeed)&&void 0!==i?i:.025;let n,r,o=!1;window.addEventListener("keydown",(e=>this.pressedKeys[e.keyCode]=!0)),window.addEventListener("keyup",(e=>this.pressedKeys[e.keyCode]=!1)),this.canvas.addEventListener("contextmenu",(e=>e.preventDefault())),this.canvas.addEventListener("mousedown",(e=>{3===e.which&&(o=!0),n=e.pageX,r=e.pageY})),this.canvas.addEventListener("mousemove",(e=>{if(o){let t=e.pageX-n,i=e.pageY-r;n=e.pageX,r=e.pageY,this.angles[1]+=t*this.rotationSpeed,this.angles[1]<0&&(this.angles[1]+=2*Math.PI),this.angles[1]>=2*Math.PI&&(this.angles[1]-=2*Math.PI),this.angles[0]+=i*this.rotationSpeed,this.angles[0]<.5*-Math.PI&&(this.angles[0]=.5*-Math.PI),this.angles[0]>.5*Math.PI&&(this.angles[0]=.5*Math.PI),this._dirty=!0}})),this.canvas.addEventListener("mouseup",(e=>o=!1))}get angles(){return this._angles}set angles(e){this._angles=e,this._dirty=!0}get position(){return this._position}set position(e){this._position=e,this._dirty=!0}get viewMat(){if(this._dirty){var e=this._viewMat;y(e),D(e,e,this.angles[0]-Math.PI/2),M(e,e,this.angles[1]),R(e,e,this.angles[2]),I(e,e,[-this.position[0],-this.position[1],-this.position[2]]),this._dirty=!1}return this._viewMat}update(e){const t=N();let i=this.speed/1e3*e;if(this.pressedKeys[16]&&(i*=5),this.pressedKeys["W".charCodeAt(0)]&&(t[1]+=i),this.pressedKeys["S".charCodeAt(0)]&&(t[1]-=i),this.pressedKeys["A".charCodeAt(0)]&&(t[0]-=i),this.pressedKeys["D".charCodeAt(0)]&&(t[0]+=i),this.pressedKeys[32]&&(t[2]+=i),this.pressedKeys["C".charCodeAt(0)]&&(t[2]-=i),0!==t[0]||0!==t[1]||0!==t[2]){let e=this._cameraMat;y(e),D(e,e,this.angles[0]),M(e,e,this.angles[1]),S(e,e),function(e,t,i){var n=t[0],r=t[1],o=t[2],s=i[3]*n+i[7]*r+i[11]*o+i[15];s=s||1,e[0]=(i[0]*n+i[4]*r+i[8]*o+i[12])/s,e[1]=(i[1]*n+i[5]*r+i[9]*o+i[13])/s,e[2]=(i[2]*n+i[6]*r+i[10]*o+i[14])/s}(t,t,e),function(e,t,i){e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2]}(this.position,this.position,t),this._dirty=!0}}}var Te;!function(e){e[e.Free=0]="Free",e[e.Predefined=1]="Predefined"}(Te||(Te={}));class be{constructor(e,t){this.renderer=e,this.options=t,this.matCamera=w(),this.matInvCamera=new Float32Array(16),this.vec3Eye=new Float32Array(3),this.vec3Rotation=new Float32Array(3),this.mode=Te.Predefined,this.setupControls()}setupControls(){document.addEventListener("keypress",(e=>{var t;if("Enter"===e.code)if(this.mode===Te.Predefined){this.matCamera=function(e){var t=new C(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}(this.renderer.getViewMatrix()),this.renderer.setCustomCamera(this.matCamera),this.mode=Te.Free,S(this.matInvCamera,this.matCamera),function(e,t){e[0]=t[12],e[1]=t[13],e[2]=t[14]}(this.vec3Eye,this.matInvCamera),F(this.vec3Rotation,this.vec3Eye),function(e,t,i){e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i}(this.vec3Rotation,this.vec3Rotation,-1),this.fpsCamera=null!==(t=this.fpsCamera)&&void 0!==t?t:new Ae(this.options),this.fpsCamera.position=this.vec3Eye;const e=t=>{this.mode===Te.Free&&(this.fpsCamera.update(16),this.matCamera=this.fpsCamera.viewMat,this.renderer.setCustomCamera(this.matCamera,this.fpsCamera.position,this.fpsCamera.angles),requestAnimationFrame(e))};e()}else this.renderer.resetCustomCamera(),this.mode=Te.Predefined}))}}function Ee(e,t){var i=e.__state.conversionName.toString(),n=Math.round(e.r),r=Math.round(e.g),o=Math.round(e.b),s=e.a,a=Math.round(e.h),l=e.s.toFixed(1),d=e.v.toFixed(1);if(t||"THREE_CHAR_HEX"===i||"SIX_CHAR_HEX"===i){for(var h=e.hex.toString(16);h.length<6;)h="0"+h;return"#"+h}return"CSS_RGB"===i?"rgb("+n+","+r+","+o+")":"CSS_RGBA"===i?"rgba("+n+","+r+","+o+","+s+")":"HEX"===i?"0x"+e.hex.toString(16):"RGB_ARRAY"===i?"["+n+","+r+","+o+"]":"RGBA_ARRAY"===i?"["+n+","+r+","+o+","+s+"]":"RGB_OBJ"===i?"{r:"+n+",g:"+r+",b:"+o+"}":"RGBA_OBJ"===i?"{r:"+n+",g:"+r+",b:"+o+",a:"+s+"}":"HSV_OBJ"===i?"{h:"+a+",s:"+l+",v:"+d+"}":"HSVA_OBJ"===i?"{h:"+a+",s:"+l+",v:"+d+",a:"+s+"}":"unknown format"}var Ce=Array.prototype.forEach,we=Array.prototype.slice,ye={BREAK:{},extend:function(e){return this.each(we.call(arguments,1),(function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(i){this.isUndefined(t[i])||(e[i]=t[i])}.bind(this))}),this),e},defaults:function(e){return this.each(we.call(arguments,1),(function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(i){this.isUndefined(e[i])&&(e[i]=t[i])}.bind(this))}),this),e},compose:function(){var e=we.call(arguments);return function(){for(var t=we.call(arguments),i=e.length-1;i>=0;i--)t=[e[i].apply(this,t)];return t[0]}},each:function(e,t,i){if(e)if(Ce&&e.forEach&&e.forEach===Ce)e.forEach(t,i);else if(e.length===e.length+0){var n,r=void 0;for(r=0,n=e.length;r<n;r++)if(r in e&&t.call(i,e[r],r)===this.BREAK)return}else for(var o in e)if(t.call(i,e[o],o)===this.BREAK)return},defer:function(e){setTimeout(e,0)},debounce:function(e,t,i){var n=void 0;return function(){var r=this,o=arguments;function s(){n=null,i||e.apply(r,o)}var a=i||!n;clearTimeout(n),n=setTimeout(s,t),a&&e.apply(r,o)}},toArray:function(e){return e.toArray?e.toArray():we.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return isNaN(e)})),isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return!1===e||!0===e},isFunction:function(e){return e instanceof Function}},Se=[{litmus:ye.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString(),0)}},write:Ee},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString(),0)}},write:Ee},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:Ee},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:Ee}}},{litmus:ye.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:ye.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:ye.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(ye.isNumber(e.r)&&ye.isNumber(e.g)&&ye.isNumber(e.b)&&ye.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(ye.isNumber(e.r)&&ye.isNumber(e.g)&&ye.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(ye.isNumber(e.h)&&ye.isNumber(e.s)&&ye.isNumber(e.v)&&ye.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(ye.isNumber(e.h)&&ye.isNumber(e.s)&&ye.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],Pe=void 0,Ie=void 0,De=function(){Ie=!1;var e=arguments.length>1?ye.toArray(arguments):arguments[0];return ye.each(Se,(function(t){if(t.litmus(e))return ye.each(t.conversions,(function(t,i){if(Pe=t.read(e),!1===Ie&&!1!==Pe)return Ie=Pe,Pe.conversionName=i,Pe.conversion=t,ye.BREAK})),ye.BREAK})),Ie},Re=void 0,Me={hsv_to_rgb:function(e,t,i){var n=Math.floor(e/60)%6,r=e/60-Math.floor(e/60),o=i*(1-t),s=i*(1-r*t),a=i*(1-(1-r)*t),l=[[i,a,o],[s,i,o],[o,i,a],[o,s,i],[a,o,i],[i,o,s]][n];return{r:255*l[0],g:255*l[1],b:255*l[2]}},rgb_to_hsv:function(e,t,i){var n=Math.min(e,t,i),r=Math.max(e,t,i),o=r-n,s=void 0;return 0===r?{h:NaN,s:0,v:0}:(s=e===r?(t-i)/o:t===r?2+(i-e)/o:4+(e-t)/o,(s/=6)<0&&(s+=1),{h:360*s,s:o/r,v:r/255})},rgb_to_hex:function(e,t,i){var n=this.hex_with_component(0,2,e);return n=this.hex_with_component(n,1,t),n=this.hex_with_component(n,0,i)},component_from_hex:function(e,t){return e>>8*t&255},hex_with_component:function(e,t,i){return i<<(Re=8*t)|e&~(255<<Re)}},Ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Fe=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Be=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),Oe=function e(t,i,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,i);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,n)}if("value"in r)return r.value;var s=r.get;return void 0!==s?s.call(n):void 0},Le=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},Ue=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},Ge=function(){function e(){if(Fe(this,e),this.__state=De.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return Be(e,[{key:"toString",value:function(){return Ee(this)}},{key:"toHexString",value:function(){return Ee(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),e}();function Ve(e,t,i){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space||Ge.recalculateRGB(this,t,i),this.__state[t]},set:function(e){"RGB"!==this.__state.space&&(Ge.recalculateRGB(this,t,i),this.__state.space="RGB"),this.__state[t]=e}})}function ke(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space||Ge.recalculateHSV(this),this.__state[t]},set:function(e){"HSV"!==this.__state.space&&(Ge.recalculateHSV(this),this.__state.space="HSV"),this.__state[t]=e}})}Ge.recalculateRGB=function(e,t,i){if("HEX"===e.__state.space)e.__state[t]=Me.component_from_hex(e.__state.hex,i);else{if("HSV"!==e.__state.space)throw new Error("Corrupted color state");ye.extend(e.__state,Me.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}},Ge.recalculateHSV=function(e){var t=Me.rgb_to_hsv(e.r,e.g,e.b);ye.extend(e.__state,{s:t.s,v:t.v}),ye.isNaN(t.h)?ye.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=t.h},Ge.COMPONENTS=["r","g","b","h","s","v","hex","a"],Ve(Ge.prototype,"r",2),Ve(Ge.prototype,"g",1),Ve(Ge.prototype,"b",0),ke(Ge.prototype,"h"),ke(Ge.prototype,"s"),ke(Ge.prototype,"v"),Object.defineProperty(Ge.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(Ge.prototype,"hex",{get:function(){return"HEX"!==this.__state.space&&(this.__state.hex=Me.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var ze=function(){function e(t,i){Fe(this,e),this.initialValue=t[i],this.domElement=document.createElement("div"),this.object=t,this.property=i,this.__onChange=void 0,this.__onFinishChange=void 0}return Be(e,[{key:"onChange",value:function(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),e}(),He={};ye.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},(function(e,t){ye.each(e,(function(e){He[e]=t}))}));var je=/(\d+(\.\d+)?)px/;function Xe(e){if("0"===e||ye.isUndefined(e))return 0;var t=e.match(je);return ye.isNull(t)?0:parseFloat(t[1])}var We={makeSelectable:function(e,t){void 0!==e&&void 0!==e.style&&(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,i){var n=i,r=t;ye.isUndefined(r)&&(r=!0),ye.isUndefined(n)&&(n=!0),e.style.position="absolute",r&&(e.style.left=0,e.style.right=0),n&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,i,n){var r=i||{},o=He[t];if(!o)throw new Error("Event type "+t+" not supported.");var s=document.createEvent(o);switch(o){case"MouseEvents":var a=r.x||r.clientX||0,l=r.y||r.clientY||0;s.initMouseEvent(t,r.bubbles||!1,r.cancelable||!0,window,r.clickCount||1,0,0,a,l,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var d=s.initKeyboardEvent||s.initKeyEvent;ye.defaults(r,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),d(t,r.bubbles||!1,r.cancelable,window,r.ctrlKey,r.altKey,r.shiftKey,r.metaKey,r.keyCode,r.charCode);break;default:s.initEvent(t,r.bubbles||!1,r.cancelable||!0)}ye.defaults(s,n),e.dispatchEvent(s)},bind:function(e,t,i,n){var r=n||!1;return e.addEventListener?e.addEventListener(t,i,r):e.attachEvent&&e.attachEvent("on"+t,i),We},unbind:function(e,t,i,n){var r=n||!1;return e.removeEventListener?e.removeEventListener(t,i,r):e.detachEvent&&e.detachEvent("on"+t,i),We},addClass:function(e,t){if(void 0===e.className)e.className=t;else if(e.className!==t){var i=e.className.split(/ +/);-1===i.indexOf(t)&&(i.push(t),e.className=i.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return We},removeClass:function(e,t){if(t)if(e.className===t)e.removeAttribute("class");else{var i=e.className.split(/ +/),n=i.indexOf(t);-1!==n&&(i.splice(n,1),e.className=i.join(" "))}else e.className=void 0;return We},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var t=getComputedStyle(e);return Xe(t["border-left-width"])+Xe(t["border-right-width"])+Xe(t["padding-left"])+Xe(t["padding-right"])+Xe(t.width)},getHeight:function(e){var t=getComputedStyle(e);return Xe(t["border-top-width"])+Xe(t["border-bottom-width"])+Xe(t["padding-top"])+Xe(t["padding-bottom"])+Xe(t.height)},getOffset:function(e){var t=e,i={left:0,top:0};if(t.offsetParent)do{i.left+=t.offsetLeft,i.top+=t.offsetTop,t=t.offsetParent}while(t);return i},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},Ye=function(e){function t(e,i){Fe(this,t);var n=Ue(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i)),r=n;return n.__prev=n.getValue(),n.__checkbox=document.createElement("input"),n.__checkbox.setAttribute("type","checkbox"),We.bind(n.__checkbox,"change",(function(){r.setValue(!r.__prev)}),!1),n.domElement.appendChild(n.__checkbox),n.updateDisplay(),n}return Le(t,ze),Be(t,[{key:"setValue",value:function(e){var i=Oe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),i}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),Oe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(),$e=function(e){function t(e,i,n){Fe(this,t);var r=Ue(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i)),o=n,s=r;if(r.__select=document.createElement("select"),ye.isArray(o)){var a={};ye.each(o,(function(e){a[e]=e})),o=a}return ye.each(o,(function(e,t){var i=document.createElement("option");i.innerHTML=t,i.setAttribute("value",e),s.__select.appendChild(i)})),r.updateDisplay(),We.bind(r.__select,"change",(function(){var e=this.options[this.selectedIndex].value;s.setValue(e)})),r.domElement.appendChild(r.__select),r}return Le(t,ze),Be(t,[{key:"setValue",value:function(e){var i=Oe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),i}},{key:"updateDisplay",value:function(){return We.isActive(this.__select)?this:(this.__select.value=this.getValue(),Oe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this))}}]),t}(),Ke=function(e){function t(e,i){Fe(this,t);var n=Ue(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i)),r=n;function o(){r.setValue(r.__input.value)}return n.__input=document.createElement("input"),n.__input.setAttribute("type","text"),We.bind(n.__input,"keyup",o),We.bind(n.__input,"change",o),We.bind(n.__input,"blur",(function(){r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue())})),We.bind(n.__input,"keydown",(function(e){13===e.keyCode&&this.blur()})),n.updateDisplay(),n.domElement.appendChild(n.__input),n}return Le(t,ze),Be(t,[{key:"updateDisplay",value:function(){return We.isActive(this.__input)||(this.__input.value=this.getValue()),Oe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}();function Ze(e){var t=e.toString();return t.indexOf(".")>-1?t.length-t.indexOf(".")-1:0}var Je=function(e){function t(e,i,n){Fe(this,t);var r=Ue(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i)),o=n||{};return r.__min=o.min,r.__max=o.max,r.__step=o.step,ye.isUndefined(r.__step)?0===r.initialValue?r.__impliedStep=1:r.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(r.initialValue))/Math.LN10))/10:r.__impliedStep=r.__step,r.__precision=Ze(r.__impliedStep),r}return Le(t,ze),Be(t,[{key:"setValue",value:function(e){var i=e;return void 0!==this.__min&&i<this.__min?i=this.__min:void 0!==this.__max&&i>this.__max&&(i=this.__max),void 0!==this.__step&&i%this.__step!=0&&(i=Math.round(i/this.__step)*this.__step),Oe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,i)}},{key:"min",value:function(e){return this.__min=e,this}},{key:"max",value:function(e){return this.__max=e,this}},{key:"step",value:function(e){return this.__step=e,this.__impliedStep=e,this.__precision=Ze(e),this}}]),t}();var Qe=function(e){function t(e,i,n){Fe(this,t);var r=Ue(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,n));r.__truncationSuspended=!1;var o=r,s=void 0;function a(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}function l(e){var t=s-e.clientY;o.setValue(o.getValue()+t*o.__impliedStep),s=e.clientY}function d(){We.unbind(window,"mousemove",l),We.unbind(window,"mouseup",d),a()}return r.__input=document.createElement("input"),r.__input.setAttribute("type","text"),We.bind(r.__input,"change",(function(){var e=parseFloat(o.__input.value);ye.isNaN(e)||o.setValue(e)})),We.bind(r.__input,"blur",(function(){a()})),We.bind(r.__input,"mousedown",(function(e){We.bind(window,"mousemove",l),We.bind(window,"mouseup",d),s=e.clientY})),We.bind(r.__input,"keydown",(function(e){13===e.keyCode&&(o.__truncationSuspended=!0,this.blur(),o.__truncationSuspended=!1,a())})),r.updateDisplay(),r.domElement.appendChild(r.__input),r}return Le(t,Je),Be(t,[{key:"updateDisplay",value:function(){var e,i,n;return this.__input.value=this.__truncationSuspended?this.getValue():(e=this.getValue(),i=this.__precision,n=Math.pow(10,i),Math.round(e*n)/n),Oe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}();function qe(e,t,i,n,r){return n+(e-t)/(i-t)*(r-n)}var et=function(e){function t(e,i,n,r,o){Fe(this,t);var s=Ue(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,{min:n,max:r,step:o})),a=s;function l(e){e.preventDefault();var t=a.__background.getBoundingClientRect();return a.setValue(qe(e.clientX,t.left,t.right,a.__min,a.__max)),!1}function d(){We.unbind(window,"mousemove",l),We.unbind(window,"mouseup",d),a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}function h(e){var t=e.touches[0].clientX,i=a.__background.getBoundingClientRect();a.setValue(qe(t,i.left,i.right,a.__min,a.__max))}function u(){We.unbind(window,"touchmove",h),We.unbind(window,"touchend",u),a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}return s.__background=document.createElement("div"),s.__foreground=document.createElement("div"),We.bind(s.__background,"mousedown",(function(e){document.activeElement.blur(),We.bind(window,"mousemove",l),We.bind(window,"mouseup",d),l(e)})),We.bind(s.__background,"touchstart",(function(e){if(1!==e.touches.length)return;We.bind(window,"touchmove",h),We.bind(window,"touchend",u),h(e)})),We.addClass(s.__background,"slider"),We.addClass(s.__foreground,"slider-fg"),s.updateDisplay(),s.__background.appendChild(s.__foreground),s.domElement.appendChild(s.__background),s}return Le(t,Je),Be(t,[{key:"updateDisplay",value:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",Oe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(),tt=function(e){function t(e,i,n){Fe(this,t);var r=Ue(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i)),o=r;return r.__button=document.createElement("div"),r.__button.innerHTML=void 0===n?"Fire":n,We.bind(r.__button,"click",(function(e){return e.preventDefault(),o.fire(),!1})),We.addClass(r.__button,"button"),r.domElement.appendChild(r.__button),r}return Le(t,ze),Be(t,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),t}(),it=function(e){function t(e,i){Fe(this,t);var n=Ue(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i));n.__color=new Ge(n.getValue()),n.__temp=new Ge(0);var r=n;n.domElement=document.createElement("div"),We.makeSelectable(n.domElement,!1),n.__selector=document.createElement("div"),n.__selector.className="selector",n.__saturation_field=document.createElement("div"),n.__saturation_field.className="saturation-field",n.__field_knob=document.createElement("div"),n.__field_knob.className="field-knob",n.__field_knob_border="2px solid ",n.__hue_knob=document.createElement("div"),n.__hue_knob.className="hue-knob",n.__hue_field=document.createElement("div"),n.__hue_field.className="hue-field",n.__input=document.createElement("input"),n.__input.type="text",n.__input_textShadow="0 1px 1px ",We.bind(n.__input,"keydown",(function(e){13===e.keyCode&&u.call(this)})),We.bind(n.__input,"blur",u),We.bind(n.__selector,"mousedown",(function(){We.addClass(this,"drag").bind(window,"mouseup",(function(){We.removeClass(r.__selector,"drag")}))})),We.bind(n.__selector,"touchstart",(function(){We.addClass(this,"drag").bind(window,"touchend",(function(){We.removeClass(r.__selector,"drag")}))}));var o,s=document.createElement("div");function a(e){m(e),We.bind(window,"mousemove",m),We.bind(window,"touchmove",m),We.bind(window,"mouseup",d),We.bind(window,"touchend",d)}function l(e){f(e),We.bind(window,"mousemove",f),We.bind(window,"touchmove",f),We.bind(window,"mouseup",h),We.bind(window,"touchend",h)}function d(){We.unbind(window,"mousemove",m),We.unbind(window,"touchmove",m),We.unbind(window,"mouseup",d),We.unbind(window,"touchend",d),c()}function h(){We.unbind(window,"mousemove",f),We.unbind(window,"touchmove",f),We.unbind(window,"mouseup",h),We.unbind(window,"touchend",h),c()}function u(){var e=De(this.value);!1!==e?(r.__color.__state=e,r.setValue(r.__color.toOriginal())):this.value=r.__color.toString()}function c(){r.__onFinishChange&&r.__onFinishChange.call(r,r.__color.toOriginal())}function m(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=r.__saturation_field.getBoundingClientRect(),i=e.touches&&e.touches[0]||e,n=i.clientX,o=i.clientY,s=(n-t.left)/(t.right-t.left),a=1-(o-t.top)/(t.bottom-t.top);return a>1?a=1:a<0&&(a=0),s>1?s=1:s<0&&(s=0),r.__color.v=a,r.__color.s=s,r.setValue(r.__color.toOriginal()),!1}function f(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=r.__hue_field.getBoundingClientRect(),i=1-((e.touches&&e.touches[0]||e).clientY-t.top)/(t.bottom-t.top);return i>1?i=1:i<0&&(i=0),r.__color.h=360*i,r.setValue(r.__color.toOriginal()),!1}return ye.extend(n.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),ye.extend(n.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:n.__field_knob_border+(n.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),ye.extend(n.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),ye.extend(n.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),ye.extend(s.style,{width:"100%",height:"100%",background:"none"}),rt(s,"top","rgba(0,0,0,0)","#000"),ye.extend(n.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(o=n.__hue_field).style.background="",o.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",o.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",o.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",o.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",o.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",ye.extend(n.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:n.__input_textShadow+"rgba(0,0,0,0.7)"}),We.bind(n.__saturation_field,"mousedown",a),We.bind(n.__saturation_field,"touchstart",a),We.bind(n.__field_knob,"mousedown",a),We.bind(n.__field_knob,"touchstart",a),We.bind(n.__hue_field,"mousedown",l),We.bind(n.__hue_field,"touchstart",l),n.__saturation_field.appendChild(s),n.__selector.appendChild(n.__field_knob),n.__selector.appendChild(n.__saturation_field),n.__selector.appendChild(n.__hue_field),n.__hue_field.appendChild(n.__hue_knob),n.domElement.appendChild(n.__input),n.domElement.appendChild(n.__selector),n.updateDisplay(),n}return Le(t,ze),Be(t,[{key:"updateDisplay",value:function(){var e=De(this.getValue());if(!1!==e){var t=!1;ye.each(Ge.COMPONENTS,(function(i){if(!ye.isUndefined(e[i])&&!ye.isUndefined(this.__color.__state[i])&&e[i]!==this.__color.__state[i])return t=!0,{}}),this),t&&ye.extend(this.__color.__state,e)}ye.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var i=this.__color.v<.5||this.__color.s>.5?255:0,n=255-i;ye.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+i+","+i+","+i+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,rt(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),ye.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+i+","+i+","+i+")",textShadow:this.__input_textShadow+"rgba("+n+","+n+","+n+",.7)"})}}]),t}(),nt=["-moz-","-o-","-webkit-","-ms-",""];function rt(e,t,i,n){e.style.background="",ye.each(nt,(function(r){e.style.cssText+="background: "+r+"linear-gradient("+t+", "+i+" 0%, "+n+" 100%); "}))}var ot=function(e,t){var i=t||document,n=document.createElement("style");n.type="text/css",n.innerHTML=e;var r=i.getElementsByTagName("head")[0];try{r.appendChild(n)}catch(e){}},st='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>',at=function(e,t){var i=e[t];return ye.isArray(arguments[2])||ye.isObject(arguments[2])?new $e(e,t,arguments[2]):ye.isNumber(i)?ye.isNumber(arguments[2])&&ye.isNumber(arguments[3])?ye.isNumber(arguments[4])?new et(e,t,arguments[2],arguments[3],arguments[4]):new et(e,t,arguments[2],arguments[3]):ye.isNumber(arguments[4])?new Qe(e,t,{min:arguments[2],max:arguments[3],step:arguments[4]}):new Qe(e,t,{min:arguments[2],max:arguments[3]}):ye.isString(i)?new Ke(e,t):ye.isFunction(i)?new tt(e,t,""):ye.isBoolean(i)?new Ye(e,t):null};var lt=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},dt=function(){function e(){Fe(this,e),this.backgroundElement=document.createElement("div"),ye.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),We.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),ye.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var t=this;We.bind(this.backgroundElement,"click",(function(){t.hide()}))}return Be(e,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),ye.defer((function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"}))}},{key:"hide",value:function(){var e=this,t=function t(){e.domElement.style.display="none",e.backgroundElement.style.display="none",We.unbind(e.domElement,"webkitTransitionEnd",t),We.unbind(e.domElement,"transitionend",t),We.unbind(e.domElement,"oTransitionEnd",t)};We.bind(this.domElement,"webkitTransitionEnd",t),We.bind(this.domElement,"transitionend",t),We.bind(this.domElement,"oTransitionEnd",t),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-We.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-We.getHeight(this.domElement)/2+"px"}}]),e}(),ht=function(e){if(e&&"undefined"!=typeof window){var t=document.createElement("style");return t.setAttribute("type","text/css"),t.innerHTML=e,document.head.appendChild(t),e}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .cr.function .property-name{width:100%}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n");ot(ht);var ut=function(){try{return!!window.localStorage}catch(e){return!1}}(),ct=void 0,mt=!0,ft=void 0,_t=!1,vt=[],gt=function e(t){var i=this,n=t||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),We.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],n=ye.defaults(n,{closeOnTop:!1,autoPlace:!0,width:e.DEFAULT_WIDTH}),n=ye.defaults(n,{resizable:n.autoPlace,hideable:n.autoPlace}),ye.isUndefined(n.load)?n.load={preset:"Default"}:n.preset&&(n.load.preset=n.preset),ye.isUndefined(n.parent)&&n.hideable&&vt.push(this),n.resizable=ye.isUndefined(n.parent)&&n.resizable,n.autoPlace&&ye.isUndefined(n.scrollable)&&(n.scrollable=!0);var r,o=ut&&"true"===localStorage.getItem(Et(this,"isLocal")),s=void 0,a=void 0;if(Object.defineProperties(this,{parent:{get:function(){return n.parent}},scrollable:{get:function(){return n.scrollable}},autoPlace:{get:function(){return n.autoPlace}},closeOnTop:{get:function(){return n.closeOnTop}},preset:{get:function(){return i.parent?i.getRoot().preset:n.load.preset},set:function(e){i.parent?i.getRoot().preset=e:n.load.preset=e,function(e){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].value===e.preset&&(e.__preset_select.selectedIndex=t)}(this),i.revert()}},width:{get:function(){return n.width},set:function(e){n.width=e,Pt(i,e)}},name:{get:function(){return n.name},set:function(e){n.name=e,a&&(a.innerHTML=n.name)}},closed:{get:function(){return n.closed},set:function(t){n.closed=t,n.closed?We.addClass(i.__ul,e.CLASS_CLOSED):We.removeClass(i.__ul,e.CLASS_CLOSED),this.onResize(),i.__closeButton&&(i.__closeButton.innerHTML=t?e.TEXT_OPEN:e.TEXT_CLOSED)}},load:{get:function(){return n.load}},useLocalStorage:{get:function(){return o},set:function(e){ut&&(o=e,e?We.bind(window,"unload",s):We.unbind(window,"unload",s),localStorage.setItem(Et(i,"isLocal"),e))}}}),ye.isUndefined(n.parent)){if(this.closed=n.closed||!1,We.addClass(this.domElement,e.CLASS_MAIN),We.makeSelectable(this.domElement,!1),ut&&o){i.useLocalStorage=!0;var l=localStorage.getItem(Et(this,"gui"));l&&(n.load=JSON.parse(l))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=e.TEXT_CLOSED,We.addClass(this.__closeButton,e.CLASS_CLOSE_BUTTON),n.closeOnTop?(We.addClass(this.__closeButton,e.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(We.addClass(this.__closeButton,e.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),We.bind(this.__closeButton,"click",(function(){i.closed=!i.closed}))}else{void 0===n.closed&&(n.closed=!0);var d=document.createTextNode(n.name);We.addClass(d,"controller-name"),a=xt(i,d);We.addClass(this.__ul,e.CLASS_CLOSED),We.addClass(a,"title"),We.bind(a,"click",(function(e){return e.preventDefault(),i.closed=!i.closed,!1})),n.closed||(this.closed=!1)}n.autoPlace&&(ye.isUndefined(n.parent)&&(mt&&(ft=document.createElement("div"),We.addClass(ft,"dg"),We.addClass(ft,e.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(ft),mt=!1),ft.appendChild(this.domElement),We.addClass(this.domElement,e.CLASS_AUTO_PLACE)),this.parent||Pt(i,n.width)),this.__resizeHandler=function(){i.onResizeDebounced()},We.bind(window,"resize",this.__resizeHandler),We.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),We.bind(this.__ul,"transitionend",this.__resizeHandler),We.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),n.resizable&&St(this),s=function(){ut&&"true"===localStorage.getItem(Et(i,"isLocal"))&&localStorage.setItem(Et(i,"gui"),JSON.stringify(i.getSaveObject()))},this.saveToLocalStorageIfPossible=s,n.parent||((r=i.getRoot()).width+=1,ye.defer((function(){r.width-=1})))};function xt(e,t,i){var n=document.createElement("li");return t&&n.appendChild(t),i?e.__ul.insertBefore(n,i):e.__ul.appendChild(n),e.onResize(),n}function pt(e){We.unbind(window,"resize",e.__resizeHandler),e.saveToLocalStorageIfPossible&&We.unbind(window,"unload",e.saveToLocalStorageIfPossible)}function At(e,t){var i=e.__preset_select[e.__preset_select.selectedIndex];i.innerHTML=t?i.value+"*":i.value}function Tt(e,t){var i=e.getRoot(),n=i.__rememberedObjects.indexOf(t.object);if(-1!==n){var r=i.__rememberedObjectIndecesToControllers[n];if(void 0===r&&(r={},i.__rememberedObjectIndecesToControllers[n]=r),r[t.property]=t,i.load&&i.load.remembered){var o=i.load.remembered,s=void 0;if(o[e.preset])s=o[e.preset];else{if(!o.Default)return;s=o.Default}if(s[n]&&void 0!==s[n][t.property]){var a=s[n][t.property];t.initialValue=a,t.setValue(a)}}}}function bt(e,t,i,n){if(void 0===t[i])throw new Error('Object "'+t+'" has no property "'+i+'"');var r=void 0;if(n.color)r=new it(t,i);else{var o=[t,i].concat(n.factoryArgs);r=at.apply(e,o)}n.before instanceof ze&&(n.before=n.before.__li),Tt(e,r),We.addClass(r.domElement,"c");var s=document.createElement("span");We.addClass(s,"property-name"),s.innerHTML=r.property;var a=document.createElement("div");a.appendChild(s),a.appendChild(r.domElement);var l=xt(e,a,n.before);return We.addClass(l,gt.CLASS_CONTROLLER_ROW),r instanceof it?We.addClass(l,"color"):We.addClass(l,Ne(r.getValue())),function(e,t,i){if(i.__li=t,i.__gui=e,ye.extend(i,{options:function(t){if(arguments.length>1){var n=i.__li.nextElementSibling;return i.remove(),bt(e,i.object,i.property,{before:n,factoryArgs:[ye.toArray(arguments)]})}if(ye.isArray(t)||ye.isObject(t)){var r=i.__li.nextElementSibling;return i.remove(),bt(e,i.object,i.property,{before:r,factoryArgs:[t]})}},name:function(e){return i.__li.firstElementChild.firstElementChild.innerHTML=e,i},listen:function(){return i.__gui.listen(i),i},remove:function(){return i.__gui.remove(i),i}}),i instanceof et){var n=new Qe(i.object,i.property,{min:i.__min,max:i.__max,step:i.__step});ye.each(["updateDisplay","onChange","onFinishChange","step","min","max"],(function(e){var t=i[e],r=n[e];i[e]=n[e]=function(){var e=Array.prototype.slice.call(arguments);return r.apply(n,e),t.apply(i,e)}})),We.addClass(t,"has-slider"),i.domElement.insertBefore(n.domElement,i.domElement.firstElementChild)}else if(i instanceof Qe){var r=function(t){if(ye.isNumber(i.__min)&&ye.isNumber(i.__max)){var n=i.__li.firstElementChild.firstElementChild.innerHTML,r=i.__gui.__listening.indexOf(i)>-1;i.remove();var o=bt(e,i.object,i.property,{before:i.__li.nextElementSibling,factoryArgs:[i.__min,i.__max,i.__step]});return o.name(n),r&&o.listen(),o}return t};i.min=ye.compose(r,i.min),i.max=ye.compose(r,i.max)}else i instanceof Ye?(We.bind(t,"click",(function(){We.fakeEvent(i.__checkbox,"click")})),We.bind(i.__checkbox,"click",(function(e){e.stopPropagation()}))):i instanceof tt?(We.bind(t,"click",(function(){We.fakeEvent(i.__button,"click")})),We.bind(t,"mouseover",(function(){We.addClass(i.__button,"hover")})),We.bind(t,"mouseout",(function(){We.removeClass(i.__button,"hover")}))):i instanceof it&&(We.addClass(t,"color"),i.updateDisplay=ye.compose((function(e){return t.style.borderLeftColor=i.__color.toString(),e}),i.updateDisplay),i.updateDisplay());i.setValue=ye.compose((function(t){return e.getRoot().__preset_select&&i.isModified()&&At(e.getRoot(),!0),t}),i.setValue)}(e,l,r),e.__controllers.push(r),r}function Et(e,t){return document.location.href+"."+t}function Ct(e,t,i){var n=document.createElement("option");n.innerHTML=t,n.value=t,e.__preset_select.appendChild(n),i&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function wt(e,t){t.style.display=e.useLocalStorage?"block":"none"}function yt(e){var t=e.__save_row=document.createElement("li");We.addClass(e.domElement,"has-save"),e.__ul.insertBefore(t,e.__ul.firstChild),We.addClass(t,"save-row");var i=document.createElement("span");i.innerHTML="&nbsp;",We.addClass(i,"button gears");var n=document.createElement("span");n.innerHTML="Save",We.addClass(n,"button"),We.addClass(n,"save");var r=document.createElement("span");r.innerHTML="New",We.addClass(r,"button"),We.addClass(r,"save-as");var o=document.createElement("span");o.innerHTML="Revert",We.addClass(o,"button"),We.addClass(o,"revert");var s=e.__preset_select=document.createElement("select");if(e.load&&e.load.remembered?ye.each(e.load.remembered,(function(t,i){Ct(e,i,i===e.preset)})):Ct(e,"Default",!1),We.bind(s,"change",(function(){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].innerHTML=e.__preset_select[t].value;e.preset=this.value})),t.appendChild(s),t.appendChild(i),t.appendChild(n),t.appendChild(r),t.appendChild(o),ut){var a=document.getElementById("dg-local-explain"),l=document.getElementById("dg-local-storage");document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(Et(0,"isLocal"))&&l.setAttribute("checked","checked"),wt(e,a),We.bind(l,"change",(function(){e.useLocalStorage=!e.useLocalStorage,wt(e,a)}))}var d=document.getElementById("dg-new-constructor");We.bind(d,"keydown",(function(e){!e.metaKey||67!==e.which&&67!==e.keyCode||ct.hide()})),We.bind(i,"click",(function(){d.innerHTML=JSON.stringify(e.getSaveObject(),void 0,2),ct.show(),d.focus(),d.select()})),We.bind(n,"click",(function(){e.save()})),We.bind(r,"click",(function(){var t=prompt("Enter a new preset name.");t&&e.saveAs(t)})),We.bind(o,"click",(function(){e.revert()}))}function St(e){var t=void 0;function i(i){return i.preventDefault(),e.width+=t-i.clientX,e.onResize(),t=i.clientX,!1}function n(){We.removeClass(e.__closeButton,gt.CLASS_DRAG),We.unbind(window,"mousemove",i),We.unbind(window,"mouseup",n)}function r(r){return r.preventDefault(),t=r.clientX,We.addClass(e.__closeButton,gt.CLASS_DRAG),We.bind(window,"mousemove",i),We.bind(window,"mouseup",n),!1}e.__resize_handle=document.createElement("div"),ye.extend(e.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),We.bind(e.__resize_handle,"mousedown",r),We.bind(e.__closeButton,"mousedown",r),e.domElement.insertBefore(e.__resize_handle,e.domElement.firstElementChild)}function Pt(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function It(e,t){var i={};return ye.each(e.__rememberedObjects,(function(n,r){var o={},s=e.__rememberedObjectIndecesToControllers[r];ye.each(s,(function(e,i){o[i]=t?e.initialValue:e.getValue()})),i[r]=o})),i}function Dt(e){0!==e.length&&lt.call(window,(function(){Dt(e)})),ye.each(e,(function(e){e.updateDisplay()}))}gt.toggleHide=function(){_t=!_t,ye.each(vt,(function(e){e.domElement.style.display=_t?"none":""}))},gt.CLASS_AUTO_PLACE="a",gt.CLASS_AUTO_PLACE_CONTAINER="ac",gt.CLASS_MAIN="main",gt.CLASS_CONTROLLER_ROW="cr",gt.CLASS_TOO_TALL="taller-than-window",gt.CLASS_CLOSED="closed",gt.CLASS_CLOSE_BUTTON="close-button",gt.CLASS_CLOSE_TOP="close-top",gt.CLASS_CLOSE_BOTTOM="close-bottom",gt.CLASS_DRAG="drag",gt.DEFAULT_WIDTH=245,gt.TEXT_CLOSED="Close Controls",gt.TEXT_OPEN="Open Controls",gt._keydownHandler=function(e){"text"===document.activeElement.type||72!==e.which&&72!==e.keyCode||gt.toggleHide()},We.bind(window,"keydown",gt._keydownHandler,!1),ye.extend(gt.prototype,{add:function(e,t){return bt(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return bt(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;ye.defer((function(){t.onResize()}))},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&ft.removeChild(this.domElement);var e=this;ye.each(this.__folders,(function(t){e.removeFolder(t)})),We.unbind(window,"keydown",gt._keydownHandler,!1),pt(this)},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);var i=new gt(t);this.__folders[e]=i;var n=xt(this,i.domElement);return We.addClass(n,"folder"),i},removeFolder:function(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name],pt(e);var t=this;ye.each(e.__folders,(function(t){e.removeFolder(t)})),ye.defer((function(){t.onResize()}))},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=We.getOffset(e.__ul).top,i=0;ye.each(e.__ul.childNodes,(function(t){e.autoPlace&&t===e.__save_row||(i+=We.getHeight(t))})),window.innerHeight-t-20<i?(We.addClass(e.domElement,gt.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-20+"px"):(We.removeClass(e.domElement,gt.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&ye.defer((function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"})),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:ye.debounce((function(){this.onResize()}),50),remember:function(){if(ye.isUndefined(ct)&&((ct=new dt).domElement.innerHTML=st),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;ye.each(Array.prototype.slice.call(arguments),(function(t){0===e.__rememberedObjects.length&&yt(e),-1===e.__rememberedObjects.indexOf(t)&&e.__rememberedObjects.push(t)})),this.autoPlace&&Pt(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=It(this)),e.folders={},ye.each(this.__folders,(function(t,i){e.folders[i]=t.getSaveObject()})),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=It(this),At(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered.Default=It(this,!0)),this.load.remembered[e]=It(this),this.preset=e,Ct(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){ye.each(this.__controllers,(function(t){this.getRoot().load.remembered?Tt(e||this.getRoot(),t):t.setValue(t.initialValue),t.__onFinishChange&&t.__onFinishChange.call(t,t.getValue())}),this),ye.each(this.__folders,(function(e){e.revert(e)})),e||At(this.getRoot(),!1)},listen:function(e){var t=0===this.__listening.length;this.__listening.push(e),t&&Dt(this.__listening)},updateDisplay:function(){ye.each(this.__controllers,(function(e){e.updateDisplay()})),ye.each(this.__folders,(function(e){e.updateDisplay()}))}});var Rt=gt;let Mt;var Nt;Nt=()=>{Mt=new pe,Mt.ready=()=>{!function(){var e,t;null===(e=document.getElementById("message"))||void 0===e||e.classList.add("hidden"),null===(t=document.getElementById("canvasGL"))||void 0===t||t.classList.remove("transparent"),setTimeout((()=>{var e;return null===(e=document.querySelector(".promo"))||void 0===e?void 0:e.classList.remove("transparent")}),4e3),setTimeout((()=>{var e;return null===(e=document.querySelector("#toggleFullscreen"))||void 0===e?void 0:e.classList.remove("transparent")}),1800);const i=new Rt,n={density:100,timeOfDay:"Day",glare:!0,insects:!0};i.add(n,"density",0,100).name("Grass Density").onChange((()=>Mt.density=n.density/100)),i.add(n,"timeOfDay",["Day","Night","Sunrise","Sunset"]).name("Time Of Day").onChange((()=>Mt.timeOfDay=n.timeOfDay)),i.add(n,"glare",!0).name("Sun Glare").onChange((()=>Mt.glare=n.glare)),i.add(n,"insects",!0).name("Ants & Butterflies").onChange((()=>Mt.insects=n.insects)),i.add({iterateCamera:()=>Mt.iterateCamera()},"iterateCamera").name("Next Camera");const r=i.addFolder("Stats");r.add(Mt,"tiles","").name("Tiles visible").listen(),r.add(Mt,"grassInstances","").name("Instances visible").listen()}()},Mt.init("canvasGL",!0);const t=document.getElementById("canvasGL");new be(Mt,{canvas:t,movementSpeed:35,rotationSpeed:.006});const i=new e;document.getElementById("toggleFullscreen").addEventListener("click",(()=>{document.body.classList.contains("fs")?i.exitFullScreen():i.enterFullScreen(),i.addFullScreenListener((function(){i.isFullScreen()?document.body.classList.add("fs"):document.body.classList.remove("fs")}))}))},"loading"!==document.readyState?Nt():document.addEventListener("DOMContentLoaded",Nt);
//# sourceMappingURL=index.min.js.map
